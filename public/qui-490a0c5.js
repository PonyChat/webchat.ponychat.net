var MooTools={version:"1.2.5",build:"008d8f0f2fcc2044e54fdd3635341aaab274e757"},Native=function(a){a=a||{};var b=a.name,c=a.legacy,d=a.protect,e=a.implement,g=a.generics,f=a.initialize,h=a.afterImplement||function(){};a=f||c;g=!1!==g;a.constructor=Native;a.$family={name:"native"};c&&f&&(a.prototype=c.prototype);a.prototype.constructor=a;b&&(b=b.toLowerCase(),a.prototype.$family={name:b},Native.typize(a,b));var k=function(a,b,c,e){d&&!e&&a.prototype[b]||(a.prototype[b]=c);g&&Native.genericize(a,b,
d);h.call(a,b,c);return a};a.alias=function(a,b,c){if("string"==typeof a&&(a=this.prototype[a]))return k(this,b,a,c);for(var d in a)this.alias(d,a[d],b);return this};a.implement=function(a,b,c){if("string"==typeof a)return k(this,a,b,c);for(var d in a)k(this,d,a[d],b);return this};e&&a.implement(e);return a};Native.genericize=function(a,b,c){c&&a[b]||"function"!=typeof a.prototype[b]||(a[b]=function(){var c=Array.prototype.slice.call(arguments);return a.prototype[b].apply(c.shift(),c)})};
Native.implement=function(a,b){for(var c=0,d=a.length;c<d;c++)a[c].implement(b)};Native.typize=function(a,b){a.type||(a.type=function(a){return $type(a)===b})};
(function(){var a={Array:Array,Date:Date,Function:Function,Number:Number,RegExp:RegExp,String:String},b;for(b in a)new Native({name:b,initialize:a[b],protect:!0});b={"boolean":Boolean,"native":Native,object:Object};for(var c in b)Native.typize(b[c],c);c={Array:"concat indexOf join lastIndexOf pop push reverse shift slice sort splice toString unshift valueOf".split(" "),String:"charAt charCodeAt concat indexOf lastIndexOf match replace search slice split substr substring toLowerCase toUpperCase valueOf".split(" ")};
for(var d in c)for(b=c[d].length;b--;)Native.genericize(a[d],c[d][b],!0)})();var Hash=new Native({name:"Hash",initialize:function(a){"hash"==$type(a)&&(a=$unlink(a.getClean()));for(var b in a)this[b]=a[b];return this}});Hash.implement({forEach:function(a,b){for(var c in this)this.hasOwnProperty(c)&&a.call(b,this[c],c,this)},getClean:function(){var a={},b;for(b in this)this.hasOwnProperty(b)&&(a[b]=this[b]);return a},getLength:function(){var a=0,b;for(b in this)this.hasOwnProperty(b)&&a++;return a}});
Hash.alias("forEach","each");Array.implement({forEach:function(a,b){for(var c=0,d=this.length;c<d;c++)a.call(b,this[c],c,this)}});Array.alias("forEach","each");function $A(a){if(a.item){for(var b=a.length,c=Array(b);b--;)c[b]=a[b];return c}return Array.prototype.slice.call(a)}function $arguments(a){return function(){return arguments[a]}}function $chk(a){return!(!a&&0!==a)}function $clear(a){clearTimeout(a);clearInterval(a);return null}function $defined(a){return void 0!=a}
function $each(a,b,c){var d=$type(a);("arguments"==d||"collection"==d||"array"==d?Array:Hash).each(a,b,c)}function $empty(){}function $extend(a,b){for(var c in b||{})a[c]=b[c];return a}function $H(a){return new Hash(a)}function $lambda(a){return"function"==$type(a)?a:function(){return a}}function $merge(){var a=Array.slice(arguments);a.unshift({});return $mixin.apply(null,a)}
function $mixin(a){for(var b=1,c=arguments.length;b<c;b++){var d=arguments[b];if("object"==$type(d))for(var e in d){var g=d[e],f=a[e];a[e]=f&&"object"==$type(g)&&"object"==$type(f)?$mixin(f,g):$unlink(g)}}return a}function $pick(){for(var a=0,b=arguments.length;a<b;a++)if(void 0!=arguments[a])return arguments[a];return null}function $random(a,b){return Math.floor(Math.random()*(b-a+1)+a)}function $splat(a){var b=$type(a);return b?"array"!=b&&"arguments"!=b?[a]:a:[]}var $time=Date.now||function(){return+new Date};
function $try(){for(var a=0,b=arguments.length;a<b;a++)try{return arguments[a]()}catch(c){}return null}function $type(a){if(void 0==a)return!1;if(a.$family)return"number"!=a.$family.name||isFinite(a)?a.$family.name:!1;if(a.nodeName)switch(a.nodeType){case 1:return"element";case 3:return/\S/.test(a.nodeValue)?"textnode":"whitespace"}else if("number"==typeof a.length){if(a.callee)return"arguments";if(a.item)return"collection"}return typeof a}
function $unlink(a){var b;switch($type(a)){case "object":b={};for(var c in a)b[c]=$unlink(a[c]);break;case "hash":b=new Hash(a);break;case "array":b=[];c=0;for(var d=a.length;c<d;c++)b[c]=$unlink(a[c]);break;default:return a}return b}
Array.implement({every:function(a,b){for(var c=0,d=this.length;c<d;c++)if(!a.call(b,this[c],c,this))return!1;return!0},filter:function(a,b){for(var c=[],d=0,e=this.length;d<e;d++)a.call(b,this[d],d,this)&&c.push(this[d]);return c},clean:function(){return this.filter($defined)},indexOf:function(a,b){for(var c=this.length,d=0>b?Math.max(0,c+b):b||0;d<c;d++)if(this[d]===a)return d;return-1},map:function(a,b){for(var c=[],d=0,e=this.length;d<e;d++)c[d]=a.call(b,this[d],d,this);return c},some:function(a,
b){for(var c=0,d=this.length;c<d;c++)if(a.call(b,this[c],c,this))return!0;return!1},associate:function(a){for(var b={},c=Math.min(this.length,a.length),d=0;d<c;d++)b[a[d]]=this[d];return b},link:function(a){for(var b={},c=0,d=this.length;c<d;c++)for(var e in a)if(a[e](this[c])){b[e]=this[c];delete a[e];break}return b},contains:function(a,b){return-1!=this.indexOf(a,b)},extend:function(a){for(var b=0,c=a.length;b<c;b++)this.push(a[b]);return this},getLast:function(){return this.length?this[this.length-
1]:null},getRandom:function(){return this.length?this[$random(0,this.length-1)]:null},include:function(a){this.contains(a)||this.push(a);return this},combine:function(a){for(var b=0,c=a.length;b<c;b++)this.include(a[b]);return this},erase:function(a){for(var b=this.length;b--;b)this[b]===a&&this.splice(b,1);return this},empty:function(){this.length=0;return this},flatten:function(){for(var a=[],b=0,c=this.length;b<c;b++){var d=$type(this[b]);d&&(a=a.concat("array"==d||"collection"==d||"arguments"==
d?Array.flatten(this[b]):this[b]))}return a},hexToRgb:function(a){if(3!=this.length)return null;var b=this.map(function(a){1==a.length&&(a+=a);return a.toInt(16)});return a?b:"rgb("+b+")"},rgbToHex:function(a){if(3>this.length)return null;if(4==this.length&&0==this[3]&&!a)return"transparent";for(var b=[],c=0;3>c;c++){var d=(this[c]-0).toString(16);b.push(1==d.length?"0"+d:d)}return a?b:"#"+b.join("")}});
String.implement({test:function(a,b){return("string"==typeof a?RegExp(a,b):a).test(this)},contains:function(a,b){return b?-1<(b+this+b).indexOf(b+a+b):-1<this.indexOf(a)},trim:function(){return this.replace(/^\s+|\s+$/g,"")},clean:function(){return this.replace(/\s+/g," ").trim()},camelCase:function(){return this.replace(/-\D/g,function(a){return a.charAt(1).toUpperCase()})},hyphenate:function(){return this.replace(/[A-Z]/g,function(a){return"-"+a.charAt(0).toLowerCase()})},capitalize:function(){return this.replace(/\b[a-z]/g,
function(a){return a.toUpperCase()})},escapeRegExp:function(){return this.replace(/([-.*+?^${}()|[\]\/\\])/g,"\\$1")},toInt:function(a){return parseInt(this,a||10)},toFloat:function(){return parseFloat(this)},hexToRgb:function(a){var b=this.match(/^#?(\w{1,2})(\w{1,2})(\w{1,2})$/);return b?b.slice(1).hexToRgb(a):null},rgbToHex:function(a){var b=this.match(/\d{1,3}/g);return b?b.rgbToHex(a):null},stripScripts:function(a){var b="",c=this.replace(/<script[^>]*>([\s\S]*?)<\/script>/gi,function(a,c){b+=
c+"\n";return""});!0===a?$exec(b):"function"==$type(a)&&a(b,c);return c},substitute:function(a,b){return this.replace(b||/\\?\{([^{}]+)\}/g,function(b,d){return"\\"==b.charAt(0)?b.slice(1):void 0!=a[d]?a[d]:""})}});try{delete Function.prototype.bind}catch(e$$13){}
Function.implement({extend:function(a){for(var b in a)this[b]=a[b];return this},create:function(a){var b=this;a=a||{};return function(c){var d=a.arguments,d=void 0!=d?$splat(d):Array.slice(arguments,a.event?1:0);a.event&&(d=[c||window.event].extend(d));var e=function(){return b.apply(a.bind||null,d)};return a.delay?setTimeout(e,a.delay):a.periodical?setInterval(e,a.periodical):a.attempt?$try(e):e()}},run:function(a,b){return this.apply(b,$splat(a))},pass:function(a,b){return this.create({bind:b,arguments:a})},
bind:function(a,b){return this.create({bind:a,arguments:b})},bindWithEvent:function(a,b){return this.create({bind:a,arguments:b,event:!0})},attempt:function(a,b){return this.create({bind:b,arguments:a,attempt:!0})()},delay:function(a,b,c){return this.create({bind:b,arguments:c,delay:a})()},periodical:function(a,b,c){return this.create({bind:b,arguments:c,periodical:a})()}});
Number.implement({limit:function(a,b){return Math.min(b,Math.max(a,this))},round:function(a){a=Math.pow(10,a||0);return Math.round(this*a)/a},times:function(a,b){for(var c=0;c<this;c++)a.call(b,c,this)},toFloat:function(){return parseFloat(this)},toInt:function(a){return parseInt(this,a||10)}});Number.alias("times","each");(function(a){var b={};a.each(function(a){Number[a]||(b[a]=function(){return Math[a].apply(null,[this].concat($A(arguments)))})});Number.implement(b)})("abs acos asin atan atan2 ceil cos exp floor log max min pow sin sqrt tan".split(" "));
Hash.implement({has:Object.prototype.hasOwnProperty,keyOf:function(a){for(var b in this)if(this.hasOwnProperty(b)&&this[b]===a)return b;return null},hasValue:function(a){return null!==Hash.keyOf(this,a)},extend:function(a){Hash.each(a||{},function(a,c){Hash.set(this,c,a)},this);return this},combine:function(a){Hash.each(a||{},function(a,c){Hash.include(this,c,a)},this);return this},erase:function(a){this.hasOwnProperty(a)&&delete this[a];return this},get:function(a){return this.hasOwnProperty(a)?
this[a]:null},set:function(a,b){if(!this[a]||this.hasOwnProperty(a))this[a]=b;return this},empty:function(){Hash.each(this,function(a,b){delete this[b]},this);return this},include:function(a,b){void 0==this[a]&&(this[a]=b);return this},map:function(a,b){var c=new Hash;Hash.each(this,function(d,e){c.set(e,a.call(b,d,e,this))},this);return c},filter:function(a,b){var c=new Hash;Hash.each(this,function(d,e){a.call(b,d,e,this)&&c.set(e,d)},this);return c},every:function(a,b){for(var c in this)if(this.hasOwnProperty(c)&&
!a.call(b,this[c],c))return!1;return!0},some:function(a,b){for(var c in this)if(this.hasOwnProperty(c)&&a.call(b,this[c],c))return!0;return!1},getKeys:function(){var a=[];Hash.each(this,function(b,c){a.push(c)});return a},getValues:function(){var a=[];Hash.each(this,function(b){a.push(b)});return a},toQueryString:function(a){var b=[];Hash.each(this,function(c,d){a&&(d=a+"["+d+"]");var e;switch($type(c)){case "object":e=Hash.toQueryString(c,d);break;case "array":var g={};c.each(function(a,b){g[b]=
a});e=Hash.toQueryString(g,d);break;default:e=d+"="+encodeURIComponent(c)}void 0!=c&&b.push(e)});return b.join("&")}});Hash.alias({keyOf:"indexOf",hasValue:"contains"});
function Class(a){a instanceof Function&&(a={initialize:a});var b=function(){Object.reset(this);if(b._prototyping)return this;this._current=$empty;var a=this.initialize?this.initialize.apply(this,arguments):this;delete this._current;delete this.caller;return a}.extend(this);b.implement(a);b.constructor=Class;return b.prototype.constructor=b}Function.prototype.protect=function(){this._protected=!0;return this};
Object.reset=function(a,b){if(null==b){for(var c in a)Object.reset(a,c);return a}delete a[b];switch($type(a[b])){case "object":c=function(){};c.prototype=a[b];c=new c;a[b]=Object.reset(c);break;case "array":a[b]=$unlink(a[b])}return a};
(new Native({name:"Class",initialize:Class})).extend({instantiate:function(a){a._prototyping=!0;var b=new a;delete a._prototyping;return b},wrap:function(a,b,c){c._origin&&(c=c._origin);return function(){if(c._protected&&null==this._current)throw Error('The method "'+b+'" cannot be called.');var a=this.caller,e=this._current;this.caller=e;this._current=arguments.callee;var g=c.apply(this,arguments);this._current=e;this.caller=a;return g}.extend({_owner:a,_origin:c,_name:b})}});
Class.implement({implement:function(a,b){if("object"==$type(a)){for(var c in a)this.implement(c,a[c]);return this}if(c=Class.Mutators[a])if(b=c.call(this,b),null==b)return this;c=this.prototype;switch($type(b)){case "function":if(b._hidden)break;c[a]=Class.wrap(this,a,b);break;case "object":var d=c[a];"object"==$type(d)?$mixin(d,b):c[a]=$unlink(b);break;case "array":c[a]=$unlink(b);break;default:c[a]=b}return this}});
Class.Mutators={Extends:function(a){this.parent=a;this.prototype=Class.instantiate(a);this.implement("parent",function(){var a=this.caller._name,c=this.caller._owner.parent.prototype[a];if(!c)throw Error('The method "'+a+'" has no parent.');return c.apply(this,arguments)}.protect())},Implements:function(a){$splat(a).each(function(a){a instanceof Function&&(a=Class.instantiate(a));this.implement(a)},this)}};
var Chain=new Class({$chain:[],chain:function(){this.$chain.extend(Array.flatten(arguments));return this},callChain:function(){return this.$chain.length?this.$chain.shift().apply(this,arguments):!1},clearChain:function(){this.$chain.empty();return this}}),Events=new Class({$events:{},addEvent:function(a,b,c){a=Events.removeOn(a);b!=$empty&&(this.$events[a]=this.$events[a]||[],this.$events[a].include(b),c&&(b.internal=!0));return this},addEvents:function(a){for(var b in a)this.addEvent(b,a[b]);return this},
fireEvent:function(a,b,c){a=Events.removeOn(a);if(!this.$events||!this.$events[a])return this;this.$events[a].each(function(a){a.create({bind:this,delay:c,arguments:b})()},this);return this},removeEvent:function(a,b){a=Events.removeOn(a);if(!this.$events[a])return this;b.internal||this.$events[a].erase(b);return this},removeEvents:function(a){var b;if("object"==$type(a)){for(b in a)this.removeEvent(b,a[b]);return this}a&&(a=Events.removeOn(a));for(b in this.$events)if(!a||a==b)for(var c=this.$events[b],
d=c.length;d--;d)this.removeEvent(b,c[d]);return this}});Events.removeOn=function(a){return a.replace(/^on([A-Z])/,function(a,c){return c.toLowerCase()})};
var Options=new Class({setOptions:function(){this.options=$merge.run([this.options].extend(arguments));if(!this.addEvent)return this;for(var a in this.options)"function"==$type(this.options[a])&&/^on[A-Z]/.test(a)&&(this.addEvent(a,this.options[a]),delete this.options[a]);return this}}),Browser=$merge({Engine:{name:"unknown",version:0},Platform:{name:void 0!=window.orientation?"ipod":(navigator.platform.match(/mac|win|linux/i)||["other"])[0].toLowerCase()},Features:{xpath:!!document.evaluate,air:!!window.runtime,
query:!!document.querySelector},Plugins:{},Engines:{presto:function(){return window.opera?arguments.callee.caller?960:document.getElementsByClassName?950:925:!1},trident:function(){return window.ActiveXObject?window.XMLHttpRequest?document.querySelectorAll?6:5:4:!1},webkit:function(){return navigator.taintEnabled?!1:Browser.Features.xpath?Browser.Features.query?525:420:419},gecko:function(){return document.getBoxObjectFor||null!=window.mozInnerScreenX?document.getElementsByClassName?19:18:!1}}},Browser||
{});Browser.Platform[Browser.Platform.name]=!0;Browser.detect=function(){for(var a in this.Engines){var b=this.Engines[a]();if(b){this.Engine={name:a,version:b};this.Engine[a]=this.Engine[a+b]=!0;break}}return{name:a,version:b}};Browser.detect();Browser.Request=function(){return $try(function(){return new XMLHttpRequest},function(){return new ActiveXObject("MSXML2.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")})};Browser.Features.xhr=!!Browser.Request();
Browser.Plugins.Flash=function(){var a=($try(function(){return navigator.plugins["Shockwave Flash"].description},function(){return(new ActiveXObject("ShockwaveFlash.ShockwaveFlash")).GetVariable("$version")})||"0 r0").match(/\d+/g);return{version:parseInt(a[0]||"0."+a[1],10)||0,build:parseInt(a[2],10)||0}}();
function $exec(a){if(!a)return a;if(window.execScript)window.execScript(a);else{var b=document.createElement("script");b.setAttribute("type","text/javascript");b[Browser.Engine.webkit&&420>Browser.Engine.version?"innerText":"text"]=a;document.head.appendChild(b);document.head.removeChild(b)}return a}Native.UID=1;
var $uid=Browser.Engine.trident?function(a){return(a.uid||(a.uid=[Native.UID++]))[0]}:function(a){return a.uid||(a.uid=Native.UID++)},Window=new Native({name:"Window",legacy:Browser.Engine.trident?null:window.Window,initialize:function(a){$uid(a);a.Element||(a.Element=$empty,Browser.Engine.webkit&&a.document.createElement("iframe"),a.Element.prototype=Browser.Engine.webkit?window["[[DOMElement.prototype]]"]:{});a.document.window=a;return $extend(a,Window.Prototype)},afterImplement:function(a,b){window[a]=
Window.Prototype[a]=b}});Window.Prototype={$family:{name:"window"}};new Window(window);
var Document=new Native({name:"Document",legacy:Browser.Engine.trident?null:window.Document,initialize:function(a){$uid(a);a.head=a.getElementsByTagName("head")[0];a.html=a.getElementsByTagName("html")[0];Browser.Engine.trident&&4>=Browser.Engine.version&&$try(function(){a.execCommand("BackgroundImageCache",!1,!0)});Browser.Engine.trident&&a.window.attachEvent("onunload",function(){a.window.detachEvent("onunload",arguments.callee);a.head=a.html=a.window=null});return $extend(a,Document.Prototype)},
afterImplement:function(a,b){document[a]=Document.Prototype[a]=b}});Document.Prototype={$family:{name:"document"}};new Document(document);
var Element=new Native({name:"Element",legacy:window.Element,initialize:function(a,b){var c=Element.Constructors.get(a);return c?c(b):"string"==typeof a?document.newElement(a,b):document.id(a).set(b)},afterImplement:function(a,b){Element.Prototype[a]=b;Array[a]||Elements.implement(a,function(){for(var b=[],d=!0,e=0,g=this.length;e<g;e++){var f=this[e][a].apply(this[e],arguments);b.push(f);d&&(d="element"==$type(f))}return d?new Elements(b):b})}});Element.Prototype={$family:{name:"element"}};
Element.Constructors=new Hash;
var IFrame=new Native({name:"IFrame",generics:!1,initialize:function(){var a=Array.link(arguments,{properties:Object.type,iframe:$defined}),b=a.properties||{},c=document.id(a.iframe),d=b.onload||$empty;delete b.onload;b.id=b.name=$pick(b.id,b.name,c?c.id||c.name:"IFrame_"+$time());var c=new Element(c||"iframe",b),a=function(){var a=$try(function(){return c.contentWindow.location.host});a&&a!=window.location.host||(a=new Window(c.contentWindow),new Document(c.contentWindow.document),$extend(a.Element.prototype,
Element.Prototype));d.call(c.contentWindow,c.contentWindow.document)},e=$try(function(){return c.contentWindow});e&&e.document.body||window.frames[b.id]?a():c.addListener("load",a);return c}}),Elements=new Native({initialize:function(a,b){b=$extend({ddup:!0,cash:!0},b);a=a||[];if(b.ddup||b.cash){for(var c={},d=[],e=0,g=a.length;e<g;e++){var f=document.id(a[e],!b.cash);if(b.ddup){if(c[f.uid])continue;c[f.uid]=!0}f&&d.push(f)}a=d}return b.cash?$extend(a,this):a}});
Elements.implement({filter:function(a,b){return a?new Elements(Array.filter(this,"string"==typeof a?function(b){return b.match(a)}:a,b)):this}});
(function(){var a;try{a="x"==document.createElement("<input name=x>").name}catch(b){}var c=function(a){return(""+a).replace(/&/g,"&amp;").replace(/"/g,"&quot;")};Document.implement({newElement:function(b,e){e&&null!=e.checked&&(e.defaultChecked=e.checked);a&&e&&(b="<"+b,e.name&&(b+=' name="'+c(e.name)+'"'),e.type&&(b+=' type="'+c(e.type)+'"'),b+=">",delete e.name,delete e.type);return this.id(this.createElement(b)).set(e)},newTextNode:function(a){return this.createTextNode(a)},getDocument:function(){return this},
getWindow:function(){return this.window},id:function(){var a={string:function(b,c,f){return(b=f.getElementById(b))?a.element(b,c):null},element:function(a,b){$uid(a);if(!b&&!a.$family&&!/^object|embed$/i.test(a.tagName)){var c=Element.Prototype,d;for(d in c)a[d]=c[d]}return a},object:function(b,c,f){return b.toElement?a.element(b.toElement(f),c):null}};a.textnode=a.whitespace=a.window=a.document=$arguments(0);return function(b,c,f){if(b&&b.$family&&b.uid)return b;var h=$type(b);return a[h]?a[h](b,
c,f||document):null}}()})})();null==window.$&&Window.implement({$:function(a,b){return document.id(a,b,this.document)}});Window.implement({$$:function(a){if(1==arguments.length&&"string"==typeof a)return this.document.getElements(a);for(var b=[],c=Array.flatten(arguments),d=0,e=c.length;d<e;d++){var g=c[d];switch($type(g)){case "element":b.push(g);break;case "string":b.extend(this.document.getElements(g,!0))}}return new Elements(b)},getDocument:function(){return this.document},getWindow:function(){return this}});
Native.implement([Element,Document],{getElement:function(a,b){return document.id(this.getElements(a,!0)[0]||null,b)},getElements:function(a,b){a=a.split(",");var c=[],d=1<a.length;a.each(function(a){a=this.getElementsByTagName(a.trim());d?c.extend(a):c=a},this);return new Elements(c,{ddup:d,cash:!b})}});
(function(){var a={},b={},c={input:"checked",option:"selected",textarea:Browser.Engine.webkit&&420>Browser.Engine.version?"innerHTML":"value"},d=function(c,d){if(c){var e=c.uid;!0!==d&&(d=!1);if(Browser.Engine.trident){if(c.clearAttributes){var g=d&&c.cloneNode(!1);c.clearAttributes();g&&c.mergeAttributes(g)}else c.removeEvents&&c.removeEvents();if(/object/i.test(c.tagName)){for(var f in c)"function"==typeof c[f]&&(c[f]=$empty);Element.dispose(c)}}e&&(a[e]=b[e]=null)}},e=function(a,b,c,d,e,g){a=a[c||
b];for(c=[];a;){if(1==a.nodeType&&(!d||Element.match(a,d))){if(!e)return document.id(a,g);c.push(a)}a=a[b]}return e?new Elements(c,{ddup:!1,cash:!g}):null},g={html:"innerHTML","class":"className","for":"htmlFor",defaultValue:"defaultValue",text:Browser.Engine.trident||Browser.Engine.webkit&&420>Browser.Engine.version?"innerText":"textContent"},f="compact nowrap ismap declare noshade checked disabled readonly multiple selected noresize defer".split(" "),h="value type defaultValue accessKey cellPadding cellSpacing colSpan frameBorder maxLength readOnly rowSpan tabIndex useMap".split(" "),
f=f.associate(f);Hash.extend(g,f);Hash.extend(g,h.associate(h.map(String.toLowerCase)));var k={before:function(a,b){b.parentNode&&b.parentNode.insertBefore(a,b)},after:function(a,b){if(b.parentNode){var c=b.nextSibling;c?b.parentNode.insertBefore(a,c):b.parentNode.appendChild(a)}},bottom:function(a,b){b.appendChild(a)},top:function(a,b){var c=b.firstChild;c?b.insertBefore(a,c):b.appendChild(a)}};k.inside=k.bottom;Hash.each(k,function(a,b){b=b.capitalize();Element.implement("inject"+b,function(b){a(this,
document.id(b,!0));return this});Element.implement("grab"+b,function(b){a(document.id(b,!0),this);return this})});Element.implement({set:function(a,b){switch($type(a)){case "object":for(var c in a)this.set(c,a[c]);break;case "string":(c=Element.Properties.get(a))&&c.set?c.set.apply(this,Array.slice(arguments,1)):this.setProperty(a,b)}return this},get:function(a){var b=Element.Properties.get(a);return b&&b.get?b.get.apply(this,Array.slice(arguments,1)):this.getProperty(a)},erase:function(a){var b=
Element.Properties.get(a);b&&b.erase?b.erase.apply(this):this.removeProperty(a);return this},setProperty:function(a,b){var c=g[a];if(void 0==b)return this.removeProperty(a);c&&f[a]&&(b=!!b);c?this[c]=b:this.setAttribute(a,""+b);return this},setProperties:function(a){for(var b in a)this.setProperty(b,a[b]);return this},getProperty:function(a){var b=g[a],c=b?this[b]:this.getAttribute(a,2);return f[a]?!!c:b?c:c||null},getProperties:function(){var a=$A(arguments);return a.map(this.getProperty,this).associate(a)},
removeProperty:function(a){var b=g[a];b?this[b]=b&&f[a]?!1:"":this.removeAttribute(a);return this},removeProperties:function(){Array.each(arguments,this.removeProperty,this);return this},hasClass:function(a){return this.className.contains(a," ")},addClass:function(a){this.hasClass(a)||(this.className=(this.className+" "+a).clean());return this},removeClass:function(a){this.className=this.className.replace(RegExp("(^|\\s)"+a+"(?:\\s|$)"),"$1");return this},toggleClass:function(a){return this.hasClass(a)?
this.removeClass(a):this.addClass(a)},adopt:function(){Array.flatten(arguments).each(function(a){(a=document.id(a,!0))&&this.appendChild(a)},this);return this},appendText:function(a,b){return this.grab(this.getDocument().newTextNode(a),b)},grab:function(a,b){k[b||"bottom"](document.id(a,!0),this);return this},inject:function(a,b){k[b||"bottom"](this,document.id(a,!0));return this},replaces:function(a){a=document.id(a,!0);a.parentNode.replaceChild(this,a);return this},wraps:function(a,b){a=document.id(a,
!0);return this.replaces(a).grab(a,b)},getPrevious:function(a,b){return e(this,"previousSibling",null,a,!1,b)},getAllPrevious:function(a,b){return e(this,"previousSibling",null,a,!0,b)},getNext:function(a,b){return e(this,"nextSibling",null,a,!1,b)},getAllNext:function(a,b){return e(this,"nextSibling",null,a,!0,b)},getFirst:function(a,b){return e(this,"nextSibling","firstChild",a,!1,b)},getLast:function(a,b){return e(this,"previousSibling","lastChild",a,!1,b)},getParent:function(a,b){return e(this,
"parentNode",null,a,!1,b)},getParents:function(a,b){return e(this,"parentNode",null,a,!0,b)},getSiblings:function(a,b){return this.getParent().getChildren(a,b).erase(this)},getChildren:function(a,b){return e(this,"nextSibling","firstChild",a,!0,b)},getWindow:function(){return this.ownerDocument.window},getDocument:function(){return this.ownerDocument},getElementById:function(a,b){var c=this.ownerDocument.getElementById(a);if(!c)return null;for(var d=c.parentNode;d!=this;d=d.parentNode)if(!d)return null;
return document.id(c,b)},getSelected:function(){return new Elements($A(this.options).filter(function(a){return a.selected}))},getComputedStyle:function(a){if(this.currentStyle)return this.currentStyle[a.camelCase()];var b=this.getDocument().defaultView.getComputedStyle(this,null);return b?b.getPropertyValue([a.hyphenate()]):null},toQueryString:function(){var a=[];this.getElements("input, select, textarea",!0).each(function(b){if(b.name&&!b.disabled&&"submit"!=b.type&&"reset"!=b.type&&"file"!=b.type){var c=
"select"==b.tagName.toLowerCase()?Element.getSelected(b).map(function(a){return a.value}):"radio"!=b.type&&"checkbox"!=b.type||b.checked?b.value:null;$splat(c).each(function(c){"undefined"!=typeof c&&a.push(b.name+"="+encodeURIComponent(c))})}});return a.join("&")},clone:function(a,b){a=!1!==a;var d=this.cloneNode(a),e=function(a,d){b||a.removeAttribute("id");if(Browser.Engine.trident&&(a.clearAttributes(),a.mergeAttributes(d),a.removeAttribute("uid"),a.options))for(var e=a.options,g=d.options,f=
e.length;f--;)e[f].selected=g[f].selected;(e=c[d.tagName.toLowerCase()])&&d[e]&&(a[e]=d[e])};if(a)for(var g=d.getElementsByTagName("*"),f=this.getElementsByTagName("*"),h=g.length;h--;)e(g[h],f[h]);e(d,this);return document.id(d)},destroy:function(){Element.empty(this);Element.dispose(this);d(this,!0);return null},empty:function(){$A(this.childNodes).each(function(a){Element.destroy(a)});return this},dispose:function(){return this.parentNode?this.parentNode.removeChild(this):this},hasChild:function(a){return(a=
document.id(a,!0))?Browser.Engine.webkit&&420>Browser.Engine.version?$A(this.getElementsByTagName(a.tagName)).contains(a):this.contains?this!=a&&this.contains(a):!!(this.compareDocumentPosition(a)&16):!1},match:function(a){return!a||a==this||Element.get(this,"tag")==a}});Native.implement([Element,Window,Document],{addListener:function(b,c){if("unload"==b){var d=c,e=this;c=function(){e.removeListener("unload",c);d()}}else a[this.uid]=this;this.addEventListener?this.addEventListener(b,c,!1):this.attachEvent("on"+
b,c);return this},removeListener:function(a,b){this.removeEventListener?this.removeEventListener(a,b,!1):this.detachEvent("on"+a,b);return this},retrieve:function(a,c){var d=b[this.uid]||(b[this.uid]={}),e=d[a];void 0!=c&&void 0==e&&(e=d[a]=c);return $pick(e)},store:function(a,c){(b[this.uid]||(b[this.uid]={}))[a]=c;return this},eliminate:function(a){delete (b[this.uid]||(b[this.uid]={}))[a];return this}});window.addListener("unload",function(){Hash.each(a,d);Browser.Engine.trident&&$A(document.getElementsByTagName("object")).each(d);
window.CollectGarbage&&CollectGarbage();a=b=null})})();Element.Properties=new Hash;Element.Properties.style={set:function(a){this.style.cssText=a},get:function(){return this.style.cssText},erase:function(){this.style.cssText=""}};Element.Properties.tag={get:function(){return this.tagName.toLowerCase()}};
Element.Properties.html=function(){var a=document.createElement("div"),b={table:[1,"<table>","</table>"],select:[1,"<select>","</select>"],tbody:[2,"<table><tbody>","</tbody></table>"],tr:[3,"<table><tbody><tr>","</tr></tbody></table>"]};b.thead=b.tfoot=b.tbody;var c={set:function(){var c=Array.flatten(arguments).join(""),e=Browser.Engine.trident&&b[this.get("tag")];if(e){var g=a;g.innerHTML=e[1]+c+e[2];for(c=e[0];c--;)g=g.firstChild;this.empty().adopt(g.childNodes)}else this.innerHTML=c}};c.erase=
c.set;return c}();Browser.Engine.webkit&&420>Browser.Engine.version&&(Element.Properties.text={get:function(){if(this.innerText)return this.innerText;var a=this.ownerDocument.newElement("div",{html:this.innerHTML}).inject(this.ownerDocument.body),b=a.innerText;a.destroy();return b}});
(function(){function a(a){return"border-box"==g(a,"-moz-box-sizing")}function b(a){return g(a,"border-top-width").toInt()||0}function c(a){return g(a,"border-left-width").toInt()||0}function d(a){return/^(?:body|html)$/i.test(a.tagName)}function e(a){a=a.getDocument();return a.compatMode&&"CSS1Compat"!=a.compatMode?a.body:a.html}Element.implement({scrollTo:function(a,b){d(this)?this.getWindow().scrollTo(a,b):(this.scrollLeft=a,this.scrollTop=b);return this},getSize:function(){return d(this)?this.getWindow().getSize():
{x:this.offsetWidth,y:this.offsetHeight}},getScrollSize:function(){return d(this)?this.getWindow().getScrollSize():{x:this.scrollWidth,y:this.scrollHeight}},getScroll:function(){return d(this)?this.getWindow().getScroll():{x:this.scrollLeft,y:this.scrollTop}},getScrolls:function(){for(var a=this,b={x:0,y:0};a&&!d(a);)b.x+=a.scrollLeft,b.y+=a.scrollTop,a=a.parentNode;return b},getOffsetParent:function(){var a=this;if(d(a))return null;if(!Browser.Engine.trident)return a.offsetParent;for(;(a=a.parentNode)&&
!d(a);)if("static"!=g(a,"position"))return a;return null},getOffsets:function(){if(this.getBoundingClientRect){var e=this.getBoundingClientRect(),h=document.id(this.getDocument().documentElement),k=h.getScroll(),m=this.getScrolls(),l=this.getScroll(),n="fixed"==g(this,"position");return{x:e.left.toInt()+m.x-l.x+(n?0:k.x)-h.clientLeft,y:e.top.toInt()+m.y-l.y+(n?0:k.y)-h.clientTop}}e=this;h={x:0,y:0};if(d(this))return h;for(;e&&!d(e);)h.x+=e.offsetLeft,h.y+=e.offsetTop,Browser.Engine.gecko?(a(e)||(h.x+=
c(e),h.y+=b(e)),(k=e.parentNode)&&"visible"!=g(k,"overflow")&&(h.x+=c(k),h.y+=b(k))):e!=this&&Browser.Engine.webkit&&(h.x+=c(e),h.y+=b(e)),e=e.offsetParent;Browser.Engine.gecko&&!a(this)&&(h.x-=c(this),h.y-=b(this));return h},getPosition:function(a){if(d(this))return{x:0,y:0};var b=this.getOffsets(),c=this.getScrolls(),e=b.x-c.x,b=b.y-c.y,c=a&&(a=document.id(a))?a.getPosition():{x:0,y:0};return{x:e-c.x,y:b-c.y}},getCoordinates:function(a){if(d(this))return this.getWindow().getCoordinates();a=this.getPosition(a);
var b=this.getSize();a={left:a.x,top:a.y,width:b.x,height:b.y};a.right=a.left+a.width;a.bottom=a.top+a.height;return a},computePosition:function(a){return{left:a.x-(g(this,"margin-left").toInt()||0),top:a.y-(g(this,"margin-top").toInt()||0)}},setPosition:function(a){return this.setStyles(this.computePosition(a))}});Native.implement([Document,Window],{getSize:function(){if(Browser.Engine.presto||Browser.Engine.webkit){var a=this.getWindow();return{x:a.innerWidth,y:a.innerHeight}}a=e(this);return{x:a.clientWidth,
y:a.clientHeight}},getScroll:function(){var a=this.getWindow(),b=e(this);return{x:a.pageXOffset||b.scrollLeft,y:a.pageYOffset||b.scrollTop}},getScrollSize:function(){var a=e(this),b=this.getSize();return{x:Math.max(a.scrollWidth,b.x),y:Math.max(a.scrollHeight,b.y)}},getPosition:function(){return{x:0,y:0}},getCoordinates:function(){var a=this.getSize();return{top:0,left:0,bottom:a.y,right:a.x,height:a.y,width:a.x}}});var g=Element.getComputedStyle})();Element.alias("setPosition","position");
Native.implement([Window,Document,Element],{getHeight:function(){return this.getSize().y},getWidth:function(){return this.getSize().x},getScrollTop:function(){return this.getScroll().y},getScrollLeft:function(){return this.getScroll().x},getScrollHeight:function(){return this.getScrollSize().y},getScrollWidth:function(){return this.getScrollSize().x},getTop:function(){return this.getPosition().y},getLeft:function(){return this.getPosition().x}});
var Event=new Native({name:"Event",initialize:function(a,b){b=b||window;var c=b.document;a=a||b.event;if(a.$extended)return a;this.$extended=!0;for(var d=a.type,e=a.target||a.srcElement;e&&3==e.nodeType;)e=e.parentNode;if(d.test(/key/)){var g=a.which||a.keyCode,f=Event.Keys.keyOf(g);"keydown"==d&&(c=g-111,0<c&&13>c&&(f="f"+c));f=f||String.fromCharCode(g).toLowerCase()}else if(d.match(/(click|mouse|menu)/i)){var c=c.compatMode&&"CSS1Compat"!=c.compatMode?c.body:c.html,h={x:a.pageX||a.clientX+c.scrollLeft,
y:a.pageY||a.clientY+c.scrollTop},k={x:a.pageX?a.pageX-b.pageXOffset:a.clientX,y:a.pageY?a.pageY-b.pageYOffset:a.clientY};if(d.match(/DOMMouseScroll|mousewheel/))var m=a.wheelDelta?a.wheelDelta/120:-(a.detail||0)/3;var l=3==a.which||2==a.button,n=null;if(d.match(/over|out/)){switch(d){case "mouseover":n=a.relatedTarget||a.fromElement;break;case "mouseout":n=a.relatedTarget||a.toElement}(function(){for(;n&&3==n.nodeType;)n=n.parentNode;return!0}).create({attempt:Browser.Engine.gecko})()||(n=!1)}}return $extend(this,
{event:a,type:d,page:h,client:k,rightClick:l,wheel:m,relatedTarget:n,target:e,code:g,key:f,shift:a.shiftKey,control:a.ctrlKey,alt:a.altKey,meta:a.metaKey})}});Event.Keys=new Hash({enter:13,up:38,down:40,left:37,right:39,esc:27,space:32,backspace:8,tab:9,"delete":46});
Event.implement({stop:function(){return this.stopPropagation().preventDefault()},stopPropagation:function(){this.event.stopPropagation?this.event.stopPropagation():this.event.cancelBubble=!0;return this},preventDefault:function(){this.event.preventDefault?this.event.preventDefault():this.event.returnValue=!1;return this}});Element.Properties.events={set:function(a){this.addEvents(a)}};
Native.implement([Element,Window,Document],{addEvent:function(a,b){var c=this.retrieve("events",{});c[a]=c[a]||{keys:[],values:[]};if(c[a].keys.contains(b))return this;c[a].keys.push(b);var d=a,e=Element.Events.get(a),g=b,f=this;e&&(e.onAdd&&e.onAdd.call(this,b),e.condition&&(g=function(a){return e.condition.call(this,a)?b.call(this,a):!0}),d=e.base||d);var h=function(){return b.call(f)},k=Element.NativeEvents[d];k&&(2==k&&(h=function(a){a=new Event(a,f.getWindow());!1===g.call(f,a)&&a.stop()}),this.addListener(d,
h));c[a].values.push(h);return this},removeEvent:function(a,b){var c=this.retrieve("events");if(!c||!c[a])return this;var d=c[a].keys.indexOf(b);if(-1==d)return this;c[a].keys.splice(d,1);c=c[a].values.splice(d,1)[0];if(d=Element.Events.get(a))d.onRemove&&d.onRemove.call(this,b),a=d.base||a;return Element.NativeEvents[a]?this.removeListener(a,c):this},addEvents:function(a){for(var b in a)this.addEvent(b,a[b]);return this},removeEvents:function(a){var b;if("object"==$type(a)){for(b in a)this.removeEvent(b,
a[b]);return this}var c=this.retrieve("events");if(!c)return this;if(!a){for(b in c)this.removeEvents(b);this.eliminate("events")}else if(c[a]){for(;c[a].keys[0];)this.removeEvent(a,c[a].keys[0]);c[a]=null}return this},fireEvent:function(a,b,c){var d=this.retrieve("events");if(!d||!d[a])return this;d[a].keys.each(function(a){a.create({bind:this,delay:c,arguments:b})()},this);return this},cloneEvents:function(a,b){a=document.id(a);var c=a.retrieve("events");if(!c)return this;if(b)c[b]&&c[b].keys.each(function(a){this.addEvent(b,
a)},this);else for(var d in c)this.cloneEvents(a,d);return this}});try{"undefined"!=typeof HTMLElement&&(HTMLElement.prototype.fireEvent=Element.prototype.fireEvent)}catch(e$$15){}
Element.NativeEvents={click:2,dblclick:2,mouseup:2,mousedown:2,contextmenu:2,mousewheel:2,DOMMouseScroll:2,mouseover:2,mouseout:2,mousemove:2,selectstart:2,selectend:2,keydown:2,keypress:2,keyup:2,focus:2,blur:2,change:2,reset:2,select:2,submit:2,load:1,unload:1,beforeunload:2,resize:1,move:1,DOMContentLoaded:1,readystatechange:1,error:1,abort:1,scroll:1};
(function(){var a=function(a){a=a.relatedTarget;return void 0==a?!0:!1===a?!1:"document"!=$type(this)&&a!=this&&"xul"!=a.prefix&&!this.hasChild(a)};Element.Events=new Hash({mouseenter:{base:"mouseover",condition:a},mouseleave:{base:"mouseout",condition:a},mousewheel:{base:Browser.Engine.gecko?"DOMMouseScroll":"mousewheel"}})})();Element.Properties.styles={set:function(a){this.setStyles(a)}};
Element.Properties.opacity={set:function(a,b){b||(0==a?"hidden"!=this.style.visibility&&(this.style.visibility="hidden"):"visible"!=this.style.visibility&&(this.style.visibility="visible"));this.currentStyle&&this.currentStyle.hasLayout||(this.style.zoom=1);Browser.Engine.trident&&(this.style.filter=1==a?"":"alpha(opacity="+100*a+")");this.style.opacity=a;this.store("opacity",a)},get:function(){return this.retrieve("opacity",1)}};
Element.implement({setOpacity:function(a){return this.set("opacity",a,!0)},getOpacity:function(){return this.get("opacity")},setStyle:function(a,b){switch(a){case "opacity":return this.set("opacity",parseFloat(b));case "float":a=Browser.Engine.trident?"styleFloat":"cssFloat"}a=a.camelCase();if("string"!=$type(b)){var c=(Element.Styles.get(a)||"@").split(" ");b=$splat(b).map(function(a,b){return c[b]?"number"==$type(a)?c[b].replace("@",Math.round(a)):a:""}).join(" ")}else b==String(Number(b))&&(b=
Math.round(b));this.style[a]=b;return this},getStyle:function(a){switch(a){case "opacity":return this.get("opacity");case "float":a=Browser.Engine.trident?"styleFloat":"cssFloat"}a=a.camelCase();var b=this.style[a];if(!$chk(b)){var b=[],c;for(c in Element.ShortStyles)if(a==c){for(var d in Element.ShortStyles[c])b.push(this.getStyle(d));return b.join(" ")}b=this.getComputedStyle(a)}b&&(b=String(b),(c=b.match(/rgba?\([\d\s,]+\)/))&&(b=b.replace(c[0],c[0].rgbToHex())));if(Browser.Engine.presto||Browser.Engine.trident&&
!$chk(parseInt(b,10))){if(a.test(/^(height|width)$/)){var e=0;("width"==a?["left","right"]:["top","bottom"]).each(function(a){e+=this.getStyle("border-"+a+"-width").toInt()+this.getStyle("padding-"+a).toInt()},this);return this["offset"+a.capitalize()]-e+"px"}if(Browser.Engine.presto&&String(b).test("px"))return b;if(a.test(/(border(.+)Width|margin|padding)/))return"0px"}return b},setStyles:function(a){for(var b in a)this.setStyle(b,a[b]);return this},getStyles:function(){var a={};Array.flatten(arguments).each(function(b){a[b]=
this.getStyle(b)},this);return a}});
Element.Styles=new Hash({left:"@px",top:"@px",bottom:"@px",right:"@px",width:"@px",height:"@px",maxWidth:"@px",maxHeight:"@px",minWidth:"@px",minHeight:"@px",backgroundColor:"rgb(@, @, @)",backgroundPosition:"@px @px",color:"rgb(@, @, @)",fontSize:"@px",letterSpacing:"@px",lineHeight:"@px",clip:"rect(@px @px @px @px)",margin:"@px @px @px @px",padding:"@px @px @px @px",border:"@px @ rgb(@, @, @) @px @ rgb(@, @, @) @px @ rgb(@, @, @)",borderWidth:"@px @px @px @px",borderStyle:"@ @ @ @",borderColor:"rgb(@, @, @) rgb(@, @, @) rgb(@, @, @) rgb(@, @, @)",
zIndex:"@",zoom:"@",fontWeight:"@",textIndent:"@px",opacity:"@"});Element.ShortStyles={margin:{},padding:{},border:{},borderWidth:{},borderStyle:{},borderColor:{}};
["Top","Right","Bottom","Left"].each(function(a){var b=Element.ShortStyles,c=Element.Styles;["margin","padding"].each(function(d){var e=d+a;b[d][e]=c[e]="@px"});var d="border"+a;b.border[d]=c[d]="@px @ rgb(@, @, @)";var e=d+"Width",g=d+"Style",f=d+"Color";b[d]={};b.borderWidth[e]=b[d][e]=c[e]="@px";b.borderStyle[g]=b[d][g]=c[g]="@";b.borderColor[f]=b[d][f]=c[f]="rgb(@, @, @)"});
var Fx=new Class({Implements:[Chain,Events,Options],options:{fps:50,unit:!1,duration:500,link:"ignore"},initialize:function(a){this.subject=this.subject||this;this.setOptions(a);this.options.duration=Fx.Durations[this.options.duration]||this.options.duration.toInt();!1===this.options.wait&&(this.options.link="cancel")},getTransition:function(){return function(a){return-(Math.cos(Math.PI*a)-1)/2}},step:function(){var a=$time();a<this.time+this.options.duration?(a=this.transition((a-this.time)/this.options.duration),
this.set(this.compute(this.from,this.to,a))):(this.set(this.compute(this.from,this.to,1)),this.complete())},set:function(a){return a},compute:function(a,b,c){return Fx.compute(a,b,c)},check:function(){if(!this.timer)return!0;switch(this.options.link){case "cancel":return this.cancel(),!0;case "chain":this.chain(this.caller.bind(this,arguments))}return!1},start:function(a,b){if(!this.check(a,b))return this;this.from=a;this.to=b;this.time=0;this.transition=this.getTransition();this.startTimer();this.onStart();
return this},complete:function(){if(this.stopTimer())this.onComplete();return this},cancel:function(){if(this.stopTimer())this.onCancel();return this},onStart:function(){this.fireEvent("start",this.subject)},onComplete:function(){this.fireEvent("complete",this.subject);this.callChain()||this.fireEvent("chainComplete",this.subject)},onCancel:function(){this.fireEvent("cancel",this.subject).clearChain()},pause:function(){this.stopTimer();return this},resume:function(){this.startTimer();return this},
stopTimer:function(){if(!this.timer)return!1;this.time=$time()-this.time;this.timer=$clear(this.timer);return!0},startTimer:function(){if(this.timer)return!1;this.time=$time()-this.time;this.timer=this.step.periodical(Math.round(1E3/this.options.fps),this);return!0}});Fx.compute=function(a,b,c){return(b-a)*c+a};Fx.Durations={"short":250,normal:500,"long":1E3};
Fx.CSS=new Class({Extends:Fx,prepare:function(a,b,c){c=$splat(c);$chk(c[1])||(c[1]=c[0],c[0]=a.getStyle(b));a=c.map(this.parse);return{from:a[0],to:a[1]}},parse:function(a){a=$lambda(a)();a="string"==typeof a?a.split(" "):$splat(a);return a.map(function(a){a=String(a);var c=!1;Fx.CSS.Parsers.each(function(d,e){if(!c){var g=d.parse(a);$chk(g)&&(c={value:g,parser:d})}});return c=c||{value:a,parser:Fx.CSS.Parsers.String}})},compute:function(a,b,c){var d=[];Math.min(a.length,b.length).times(function(e){d.push({value:a[e].parser.compute(a[e].value,
b[e].value,c),parser:a[e].parser})});d.$family={name:"fx:css:value"};return d},serve:function(a,b){"fx:css:value"!=$type(a)&&(a=this.parse(a));var c=[];a.each(function(a){c=c.concat(a.parser.serve(a.value,b))});return c},render:function(a,b,c,d){a.setStyle(b,this.serve(c,d))},search:function(a){if(Fx.CSS.Cache[a])return Fx.CSS.Cache[a];var b={};Array.each(document.styleSheets,function(c,d){var e=c.href;e&&e.contains("://")&&!e.contains(document.domain)||Array.each(c.rules||c.cssRules,function(c,d){if(c.style){var e=
c.selectorText?c.selectorText.replace(/^\w+/,function(a){return a.toLowerCase()}):null;e&&e.test("^"+a+"$")&&Element.Styles.each(function(a,d){c.style[d]&&!Element.ShortStyles[d]&&(a=String(c.style[d]),b[d]=a.test(/^rgb/)?a.rgbToHex():a)})}})});return Fx.CSS.Cache[a]=b}});Fx.CSS.Cache={};
Fx.CSS.Parsers=new Hash({Color:{parse:function(a){return a.match(/^#[0-9a-f]{3,6}$/i)?a.hexToRgb(!0):(a=a.match(/(\d+),\s*(\d+),\s*(\d+)/))?[a[1],a[2],a[3]]:!1},compute:function(a,b,c){return a.map(function(d,e){return Math.round(Fx.compute(a[e],b[e],c))})},serve:function(a){return a.map(Number)}},Number:{parse:parseFloat,compute:Fx.compute,serve:function(a,b){return b?a+b:a}},String:{parse:$lambda(!1),compute:$arguments(1),serve:$arguments(0)}});
Fx.Morph=new Class({Extends:Fx.CSS,initialize:function(a,b){this.element=this.subject=document.id(a);this.parent(b)},set:function(a){"string"==typeof a&&(a=this.search(a));for(var b in a)this.render(this.element,b,a[b],this.options.unit);return this},compute:function(a,b,c){var d={},e;for(e in a)d[e]=this.parent(a[e],b[e],c);return d},start:function(a){if(!this.check(a))return this;"string"==typeof a&&(a=this.search(a));var b={},c={},d;for(d in a){var e=this.prepare(this.element,d,a[d]);b[d]=e.from;
c[d]=e.to}return this.parent(b,c)}});Element.Properties.morph={set:function(a){var b=this.retrieve("morph");b&&b.cancel();return this.eliminate("morph").store("morph:options",$extend({link:"cancel"},a))},get:function(a){if(a||!this.retrieve("morph"))!a&&this.retrieve("morph:options")||this.set("morph",a),this.store("morph",new Fx.Morph(this,this.retrieve("morph:options")));return this.retrieve("morph")}};Element.implement({morph:function(a){this.get("morph").start(a);return this}});
Fx.implement({getTransition:function(){var a=this.options.transition||Fx.Transitions.Sine.easeInOut;if("string"==typeof a){var b=a.split(":"),a=Fx.Transitions,a=a[b[0]]||a[b[0].capitalize()];b[1]&&(a=a["ease"+b[1].capitalize()+(b[2]?b[2].capitalize():"")])}return a}});Fx.Transition=function(a,b){b=$splat(b);return $extend(a,{easeIn:function(c){return a(c,b)},easeOut:function(c){return 1-a(1-c,b)},easeInOut:function(c){return 0.5>=c?a(2*c,b)/2:(2-a(2*(1-c),b))/2}})};Fx.Transitions=new Hash({linear:$arguments(0)});
Fx.Transitions.extend=function(a){for(var b in a)Fx.Transitions[b]=new Fx.Transition(a[b])};
Fx.Transitions.extend({Pow:function(a,b){return Math.pow(a,b[0]||6)},Expo:function(a){return Math.pow(2,8*(a-1))},Circ:function(a){return 1-Math.sin(Math.acos(a))},Sine:function(a){return 1-Math.sin((1-a)*Math.PI/2)},Back:function(a,b){b=b[0]||1.618;return Math.pow(a,2)*((b+1)*a-b)},Bounce:function(a){for(var b,c=0,d=1;;c+=d,d/=2)if(a>=(7-4*c)/11){b=d*d-Math.pow((11-6*c-11*a)/4,2);break}return b},Elastic:function(a,b){return Math.pow(2,10*--a)*Math.cos(20*a*Math.PI*(b[0]||1)/3)}});
["Quad","Cubic","Quart","Quint"].each(function(a,b){Fx.Transitions[a]=new Fx.Transition(function(a){return Math.pow(a,[b+2])})});
Fx.Tween=new Class({Extends:Fx.CSS,initialize:function(a,b){this.element=this.subject=document.id(a);this.parent(b)},set:function(a,b){1==arguments.length&&(b=a,a=this.property||this.options.property);this.render(this.element,a,b,this.options.unit);return this},start:function(a,b,c){if(!this.check(a,b,c))return this;var d=Array.flatten(arguments);this.property=this.options.property||d.shift();d=this.prepare(this.element,this.property,d);return this.parent(d.from,d.to)}});
Element.Properties.tween={set:function(a){var b=this.retrieve("tween");b&&b.cancel();return this.eliminate("tween").store("tween:options",$extend({link:"cancel"},a))},get:function(a){if(a||!this.retrieve("tween"))!a&&this.retrieve("tween:options")||this.set("tween",a),this.store("tween",new Fx.Tween(this,this.retrieve("tween:options")));return this.retrieve("tween")}};
Element.implement({tween:function(a,b,c){this.get("tween").start(arguments);return this},fade:function(a){var b=this.get("tween"),c;a=$pick(a,"toggle");switch(a){case "in":b.start("opacity",1);break;case "out":b.start("opacity",0);break;case "show":b.set("opacity",1);break;case "hide":b.set("opacity",0);break;case "toggle":c=this.retrieve("fade:flag",1==this.get("opacity"));b.start("opacity",c?0:1);this.store("fade:flag",!c);c=!0;break;default:b.start("opacity",arguments)}c||this.eliminate("fade:flag");
return this},highlight:function(a,b){b||(b=this.retrieve("highlight:original",this.getStyle("background-color")),b="transparent"==b?"#fff":b);var c=this.get("tween");c.start("background-color",a||"#ffff88",b).chain(function(){this.setStyle("background-color",this.retrieve("highlight:original"));c.callChain()}.bind(this));return this}});
var Request=new Class({Implements:[Chain,Events,Options],options:{url:"",data:"",headers:{"X-Requested-With":"XMLHttpRequest",Accept:"text/javascript, text/html, application/xml, text/xml, */*"},async:!0,format:!1,method:"post",link:"ignore",isSuccess:null,emulation:!0,urlEncoded:!0,encoding:"utf-8",evalScripts:!1,evalResponse:!1,noCache:!1},initialize:function(a){this.xhr=new Browser.Request;this.setOptions(a);this.options.isSuccess=this.options.isSuccess||this.isSuccess;this.headers=new Hash(this.options.headers)},
onStateChange:function(){4==this.xhr.readyState&&this.running&&(this.running=!1,this.status=0,$try(function(){this.status=this.xhr.status}.bind(this)),this.xhr.onreadystatechange=$empty,this.options.isSuccess.call(this,this.status)?(this.response={text:this.xhr.responseText,xml:this.xhr.responseXML},this.success(this.response.text,this.response.xml)):(this.response={text:null,xml:null},this.failure()))},isSuccess:function(){return 200<=this.status&&300>this.status},processScripts:function(a){return this.options.evalResponse||
/(ecma|java)script/.test(this.getHeader("Content-type"))?$exec(a):a.stripScripts(this.options.evalScripts)},success:function(a,b){this.onSuccess(this.processScripts(a),b)},onSuccess:function(){this.fireEvent("complete",arguments).fireEvent("success",arguments).callChain()},failure:function(){this.onFailure()},onFailure:function(){this.fireEvent("complete").fireEvent("failure",this.xhr)},setHeader:function(a,b){this.headers.set(a,b);return this},getHeader:function(a){return $try(function(){return this.xhr.getResponseHeader(a)}.bind(this))},
check:function(){if(!this.running)return!0;switch(this.options.link){case "cancel":return this.cancel(),!0;case "chain":this.chain(this.caller.bind(this,arguments))}return!1},send:function(a){if(!this.check(a))return this;this.running=!0;var b=$type(a);if("string"==b||"element"==b)a={data:a};b=this.options;a=$extend({data:b.data,url:b.url,method:b.method},a);var b=a.data,c=String(a.url);a=a.method.toLowerCase();switch($type(b)){case "element":b=document.id(b).toQueryString();break;case "object":case "hash":b=
Hash.toQueryString(b)}if(this.options.format)var d="format="+this.options.format,b=b?d+"&"+b:d;this.options.emulation&&!["get","post"].contains(a)&&(a="_method="+a,b=b?a+"&"+b:a,a="post");this.options.urlEncoded&&"post"==a&&this.headers.set("Content-type","application/x-www-form-urlencoded"+(this.options.encoding?"; charset="+this.options.encoding:""));this.options.noCache&&(d="noCache="+(new Date).getTime(),b=b?d+"&"+b:d);d=c.lastIndexOf("/");-1<d&&-1<(d=c.indexOf("#"))&&(c=c.substr(0,d));b&&"get"==
a&&(c=c+(c.contains("?")?"&":"?")+b,b=null);this.xhr.open(a.toUpperCase(),c,this.options.async);this.xhr.onreadystatechange=this.onStateChange.bind(this);this.headers.each(function(a,b){try{this.xhr.setRequestHeader(b,a)}catch(c){this.fireEvent("exception",[b,a])}},this);this.fireEvent("request");this.xhr.send(b);if(!this.options.async)this.onStateChange();return this},cancel:function(){if(!this.running)return this;this.running=!1;this.xhr.abort();this.xhr.onreadystatechange=$empty;this.xhr=new Browser.Request;
this.fireEvent("cancel");return this}});(function(){var a={};"get post put delete GET POST PUT DELETE".split(" ").each(function(b){a[b]=function(){var a=Array.link(arguments,{url:String.type,data:$defined});return this.send($extend(a,{method:b}))}});Request.implement(a)})();
Element.Properties.send={set:function(a){var b=this.retrieve("send");b&&b.cancel();return this.eliminate("send").store("send:options",$extend({data:this,link:"cancel",method:this.get("method")||"post",url:this.get("action")},a))},get:function(a){if(a||!this.retrieve("send"))!a&&this.retrieve("send:options")||this.set("send",a),this.store("send",new Request(this.retrieve("send:options")));return this.retrieve("send")}};
Element.implement({send:function(a){var b=this.get("send");b.send({data:this,url:a||b.options.url});return this}});
Request.HTML=new Class({Extends:Request,options:{update:!1,append:!1,evalScripts:!0,filter:!1},processHTML:function(a){var b=a.match(/<body[^>]*>([\s\S]*?)<\/body>/i);a=b?b[1]:a;var c=new Element("div");return $try(function(){var b="<root>"+a+"</root>",e;Browser.Engine.trident?(e=new ActiveXObject("Microsoft.XMLDOM"),e.async=!1,e.loadXML(b)):e=(new DOMParser).parseFromString(b,"text/xml");b=e.getElementsByTagName("root")[0];if(!b)return null;e=0;for(var g=b.childNodes.length;e<g;e++){var f=Element.clone(b.childNodes[e],
!0,!0);f&&c.grab(f)}return c})||c.set("html",a)},success:function(a){var b=this.options,c=this.response;c.html=a.stripScripts(function(a){c.javascript=a});a=this.processHTML(c.html);c.tree=a.childNodes;c.elements=a.getElements("*");b.filter&&(c.tree=c.elements.filter(b.filter));b.update?document.id(b.update).empty().set("html",c.html):b.append&&document.id(b.append).adopt(a.getChildren());b.evalScripts&&$exec(c.javascript);this.onSuccess(c.tree,c.elements,c.html,c.javascript)}});
Element.Properties.load={set:function(a){var b=this.retrieve("load");b&&b.cancel();return this.eliminate("load").store("load:options",$extend({data:this,link:"cancel",update:this,method:"get"},a))},get:function(a){if(a||!this.retrieve("load"))!a&&this.retrieve("load:options")||this.set("load",a),this.store("load",new Request.HTML(this.retrieve("load:options")));return this.retrieve("load")}};
Element.implement({load:function(){this.get("load").send(Array.link(arguments,{data:Object.type,url:String.type}));return this}});
var JSON=(new Hash(this.JSON&&{stringify:JSON.stringify,parse:JSON.parse})).extend({$specialChars:{"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},$replaceChars:function(a){return JSON.$specialChars[a]||"\\u00"+Math.floor(a.charCodeAt()/16).toString(16)+(a.charCodeAt()%16).toString(16)},encode:function(a){switch($type(a)){case "string":return'"'+a.replace(/[\x00-\x1f\\"]/g,JSON.$replaceChars)+'"';case "array":return"["+String(a.map(JSON.encode).clean())+"]";case "object":case "hash":var b=
[];Hash.each(a,function(a,d){var e=JSON.encode(a);e&&b.push(JSON.encode(d)+":"+e)});return"{"+b+"}";case "number":case "boolean":return String(a);case !1:return"null"}return null},decode:function(a,b){return"string"!=$type(a)||!a.length||b&&!/^[,:{}\[\]0-9.\-+Eaeflnr-u \n\r\t]*$/.test(a.replace(/\\./g,"@").replace(/"[^"\\\n\r]*"/g,""))?null:eval("("+a+")")}});
Request.JSON=new Class({Extends:Request,options:{secure:!0},initialize:function(a){this.parent(a);this.headers.extend({Accept:"application/json","X-Request":"JSON"})},success:function(a){this.response.json=JSON.decode(a,this.options.secure);this.onSuccess(this.response.json,a)}});
var Cookie=new Class({Implements:Options,options:{path:!1,domain:!1,duration:!1,secure:!1,document:document},initialize:function(a,b){this.key=a;this.setOptions(b)},write:function(a){a=encodeURIComponent(a);this.options.domain&&(a+="; domain="+this.options.domain);this.options.path&&(a+="; path="+this.options.path);if(this.options.duration){var b=new Date;b.setTime(b.getTime()+864E5*this.options.duration);a+="; expires="+b.toGMTString()}this.options.secure&&(a+="; secure");this.options.document.cookie=
this.key+"="+a;return this},read:function(){var a=this.options.document.cookie.match("(?:^|;)\\s*"+this.key.escapeRegExp()+"=([^;]*)");return a?decodeURIComponent(a[1]):null},dispose:function(){(new Cookie(this.key,$merge(this.options,{duration:-1}))).write("");return this}});Cookie.write=function(a,b,c){return(new Cookie(a,c)).write(b)};Cookie.read=function(a){return(new Cookie(a)).read()};Cookie.dispose=function(a,b){return(new Cookie(a,b)).dispose()};
Element.Events.domready={onAdd:function(a){Browser.loaded&&a.call(this)}};
(function(){var a=function(){Browser.loaded||(Browser.loaded=!0,window.fireEvent("domready"),document.fireEvent("domready"))};window.addEvent("load",a);if(Browser.Engine.trident){var b=document.createElement("div");(function(){$try(function(){b.doScroll();return document.id(b).inject(document.body).set("html","temp").dispose()})?a():arguments.callee.delay(50)})()}else Browser.Engine.webkit&&525>Browser.Engine.version?function(){["loaded","complete"].contains(document.readyState)?a():arguments.callee.delay(50)}():
document.addEvent("DOMContentLoaded",a)})();Native.implement([Document,Element],{getElements:function(a,b){a=a.split(",");for(var c,d={},e=0,g=a.length;e<g;e++){var f=Selectors.Utils.search(this,a[e],d);0!=e&&f.item&&(f=$A(f));c=0==e?f:c.item?$A(c).concat(f):c.concat(f)}return new Elements(c,{ddup:1<a.length,cash:!b})}});
Element.implement({match:function(a){if(!a||a==this)return!0;var b=Selectors.Utils.parseTagAndID(a),c=b[0];return Selectors.Filters.byID(this,b[1])&&Selectors.Filters.byTag(this,c)?(a=Selectors.Utils.parseSelector(a))?Selectors.Utils.filter(this,a,{}):!0:!1}});
var Selectors={Cache:{nth:{},parsed:{}},RegExps:{id:/#([\w-]+)/,tag:/^(\w+|\*)/,quick:/^(\w+|\*)$/,splitter:/\s*([+>~\s])\s*([a-zA-Z#.*:\[])/g,combined:/\.([\w-]+)|\[(\w+)(?:([!*^$~|]?=)(["']?)([^\4]*?)\4)?\]|:([\w-]+)(?:\(["']?(.*?)?["']?\)|$)/g},Utils:{chk:function(a,b){if(!b)return!0;var c=$uid(a);return b[c]?!1:b[c]=!0},parseNthArgument:function(a){if(Selectors.Cache.nth[a])return Selectors.Cache.nth[a];var b=a.match(/^([+-]?\d*)?([a-z]+)?([+-]?\d*)?$/);if(!b)return!1;var c=parseInt(b[1],10),
c=c||0===c?c:1,d=b[2]||!1,b=parseInt(b[3],10)||0;if(0!=c){for(b--;1>b;)b+=c;for(;b>=c;)b-=c}else c=b,d="index";switch(d){case "n":b={a:c,b:b,special:"n"};break;case "odd":b={a:2,b:0,special:"n"};break;case "even":b={a:2,b:1,special:"n"};break;case "first":b={a:0,special:"index"};break;case "last":b={special:"last-child"};break;case "only":b={special:"only-child"};break;default:b={a:c-1,special:"index"}}return Selectors.Cache.nth[a]=b},parseSelector:function(a){if(Selectors.Cache.parsed[a])return Selectors.Cache.parsed[a];
for(var b,c={classes:[],pseudos:[],attributes:[]};b=Selectors.RegExps.combined.exec(a);){var d=b[1],e=b[2],g=b[3],f=b[5],h=b[6];b=b[7];d?c.classes.push(d):h?(d=Selectors.Pseudo.get(h))?c.pseudos.push({parser:d,argument:b}):c.attributes.push({name:h,operator:"=",value:b}):e&&c.attributes.push({name:e,operator:g,value:f})}c.classes.length||delete c.classes;c.attributes.length||delete c.attributes;c.pseudos.length||delete c.pseudos;c.classes||c.attributes||c.pseudos||(c=null);return Selectors.Cache.parsed[a]=
c},parseTagAndID:function(a){var b=a.match(Selectors.RegExps.tag);a=a.match(Selectors.RegExps.id);return[b?b[1]:"*",a?a[1]:!1]},filter:function(a,b,c){var d;if(b.classes)for(d=b.classes.length;d--;d)if(!Selectors.Filters.byClass(a,b.classes[d]))return!1;if(b.attributes)for(d=b.attributes.length;d--;d){var e=b.attributes[d];if(!Selectors.Filters.byAttribute(a,e.name,e.operator,e.value))return!1}if(b.pseudos)for(d=b.pseudos.length;d--;d)if(e=b.pseudos[d],!Selectors.Filters.byPseudo(a,e.parser,e.argument,
c))return!1;return!0},getByTagAndID:function(a,b,c){return c?(a=a.getElementById?a.getElementById(c,!0):Element.getElementById(a,c,!0))&&Selectors.Filters.byTag(a,b)?[a]:[]:a.getElementsByTagName(b)},search:function(a,b,c){var d=[];b=b.trim().replace(Selectors.RegExps.splitter,function(a,b,c){d.push(b);return":)"+c}).split(":)");for(var e,g,f,h=0,k=b.length;h<k;h++)if(g=b[h],0==h&&Selectors.RegExps.quick.test(g))e=a.getElementsByTagName(g);else{f=d[h-1];var m=Selectors.Utils.parseTagAndID(g),l=m[0],
m=m[1];if(0==h)e=Selectors.Utils.getByTagAndID(a,l,m);else{for(var n={},p=[],t=0,y=e.length;t<y;t++)p=Selectors.Getters[f](p,e[t],l,m,n);e=p}if(l=Selectors.Utils.parseSelector(g)){g=[];m=0;for(n=e.length;m<n;m++)f=e[m],Selectors.Utils.filter(f,l,c)&&g.push(f);e=g}}return e}},Getters:{" ":function(a,b,c,d,e){b=Selectors.Utils.getByTagAndID(b,c,d);c=0;for(d=b.length;c<d;c++){var g=b[c];Selectors.Utils.chk(g,e)&&a.push(g)}return a},">":function(a,b,c,d,e){c=Selectors.Utils.getByTagAndID(b,c,d);d=0;for(var g=
c.length;d<g;d++){var f=c[d];f.parentNode==b&&Selectors.Utils.chk(f,e)&&a.push(f)}return a},"+":function(a,b,c,d,e){for(;b=b.nextSibling;)if(1==b.nodeType){Selectors.Utils.chk(b,e)&&Selectors.Filters.byTag(b,c)&&Selectors.Filters.byID(b,d)&&a.push(b);break}return a},"~":function(a,b,c,d,e){for(;b=b.nextSibling;)if(1==b.nodeType){if(!Selectors.Utils.chk(b,e))break;Selectors.Filters.byTag(b,c)&&Selectors.Filters.byID(b,d)&&a.push(b)}return a}},Filters:{byTag:function(a,b){return"*"==b||a.tagName&&a.tagName.toLowerCase()==
b},byID:function(a,b){return!b||a.id&&a.id==b},byClass:function(a,b){return a.className&&a.className.contains&&a.className.contains(b," ")},byPseudo:function(a,b,c,d){return b.call(a,c,d)},byAttribute:function(a,b,c,d){a=Element.prototype.getProperty.call(a,b);if(!a)return"!="==c;if(!c||void 0==d)return!0;switch(c){case "=":return a==d;case "*=":return a.contains(d);case "^=":return a.substr(0,d.length)==d;case "$=":return a.substr(a.length-d.length)==d;case "!=":return a!=d;case "~=":return a.contains(d,
" ");case "|=":return a.contains(d,"-")}return!1}}};
Selectors.Pseudo=new Hash({checked:function(){return this.checked},empty:function(){return!(this.innerText||this.textContent||"").length},not:function(a){return!Element.match(this,a)},contains:function(a){return(this.innerText||this.textContent||"").contains(a)},"first-child":function(){return Selectors.Pseudo.index.call(this,0)},"last-child":function(){for(var a=this;a=a.nextSibling;)if(1==a.nodeType)return!1;return!0},"only-child":function(){for(var a=this;a=a.previousSibling;)if(1==a.nodeType)return!1;
for(a=this;a=a.nextSibling;)if(1==a.nodeType)return!1;return!0},"nth-child":function(a,b){var c=Selectors.Utils.parseNthArgument(void 0==a?"n":a);if("n"!=c.special)return Selectors.Pseudo[c.special].call(this,c.a,b);var d=0;b.positions=b.positions||{};var e=$uid(this);if(!b.positions[e]){for(var g=this;g=g.previousSibling;)if(1==g.nodeType){d++;var f=b.positions[$uid(g)];if(void 0!=f){d=f+d;break}}b.positions[e]=d}return b.positions[e]%c.a==c.b},index:function(a){for(var b=this,c=0;b=b.previousSibling;)if(1==
b.nodeType&&++c>a)return!1;return c==a},even:function(a,b){return Selectors.Pseudo["nth-child"].call(this,"2n+1",b)},odd:function(a,b){return Selectors.Pseudo["nth-child"].call(this,"2n",b)},selected:function(){return this.selected},enabled:function(){return!1===this.disabled}});
var Swiff=new Class({Implements:[Options],options:{id:null,height:1,width:1,container:null,properties:{},params:{quality:"high",allowScriptAccess:"always",wMode:"transparent",swLiveConnect:!0},callBacks:{},vars:{}},toElement:function(){return this.object},initialize:function(a,b){this.instance="Swiff_"+$time();this.setOptions(b);b=this.options;var c=this.id=b.id||this.instance,d=document.id(b.container);Swiff.CallBacks[this.instance]={};var e=b.params,g=b.vars,f=b.callBacks,h=$extend({height:b.height,
width:b.width},b.properties),k=this,m;for(m in f)Swiff.CallBacks[this.instance][m]=function(a){return function(){return a.apply(k.object,arguments)}}(f[m]),g[m]="Swiff.CallBacks."+this.instance+"."+m;e.flashVars=Hash.toQueryString(g);Browser.Engine.trident?(h.classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",e.movie=a):(h.type="application/x-shockwave-flash",h.data=a);var c='<object id="'+c+'"',l;for(l in h)c+=" "+l+'="'+h[l]+'"';var c=c+">",n;for(n in e)e[n]&&(c+='<param name="'+n+'" value="'+
e[n]+'" />');c+="</object>";this.object=(d?d.empty():new Element("div")).set("html",c).firstChild},replaces:function(a){a=document.id(a,!0);a.parentNode.replaceChild(this.toElement(),a);return this},inject:function(a){document.id(a,!0).appendChild(this.toElement());return this},remote:function(){return Swiff.remote.apply(Swiff,[this.toElement()].extend(arguments))}});Swiff.CallBacks={};
Swiff.remote=function(a,b){var c=a.CallFunction('<invoke name="'+b+'" returntype="javascript">'+__flash__argumentsToXML(arguments,2)+"</invoke>");return eval(c)};MooTools.More={version:"1.2.5.1",build:"254884f2b83651bf95260eed5c6cceb838e22d8e"};Class.Mutators.Binds=function(a){return a};Class.Mutators.initialize=function(a){return function(){$splat(this.Binds).each(function(a){var c=this[a];c&&(this[a]=c.bind(this))},this);return a.apply(this,arguments)}};
Element.implement({measure:function(a){if(!this||this.offsetHeight||this.offsetWidth)return a.apply(this);for(var b=this.getParent(),c=[];b&&!b.offsetHeight&&!b.offsetWidth&&b!=document.body;)c.push(b.expose()),b=b.getParent();b=this.expose();a=a.apply(this);b();c.each(function(a){a()});return a},expose:function(){if("none"!=this.getStyle("display"))return $empty;var a=this.style.cssText;this.setStyles({display:"block",position:"absolute",visibility:"hidden"});return function(){this.style.cssText=
a}.bind(this)},getDimensions:function(a){a=$merge({computeSize:!1},a);var b={},c=this.getParent("body");if(c&&"none"==this.getStyle("display"))b=this.measure(function(){return a.computeSize?this.getComputedSize(a):this.getSize()});else if(c)try{b=a.computeSize?this.getComputedSize(a):this.getSize()}catch(d){}else b={x:0,y:0};return $chk(b.x)?$extend(b,{width:b.x,height:b.y}):$extend(b,{x:b.width,y:b.height})},getComputedSize:function(a){a&&a.plains&&(a.planes=a.plains);a=$merge({styles:["padding",
"border"],planes:{height:["top","bottom"],width:["left","right"]},mode:"both"},a);var b={width:0,height:0};switch(a.mode){case "vertical":delete b.width;delete a.planes.width;break;case "horizontal":delete b.height,delete a.planes.height}var c=[];$each(a.planes,function(b,d){b.each(function(b){a.styles.each(function(a){c.push("border"==a?a+"-"+b+"-width":a+"-"+b)})})});var d={};c.each(function(a){d[a]=this.getComputedStyle(a)},this);var e=[];$each(a.planes,function(a,f){var h=f.capitalize();b["total"+
h]=b["computed"+h]=0;a.each(function(a){b["computed"+a.capitalize()]=0;c.each(function(c,g){c.test(a)&&(d[c]=d[c].toInt()||0,b["total"+h]+=d[c],b["computed"+a.capitalize()]=b["computed"+a.capitalize()]+d[c]);c.test(a)&&f!=c&&(c.test("border")||c.test("padding"))&&!e.contains(c)&&(e.push(c),b["computed"+h]-=d[c])})})});["Width","Height"].each(function(a){var c=a.toLowerCase();$chk(b[c])&&(b[c]=b[c]+this["offset"+a]+b["computed"+a],b["total"+a]=b[c]+b["total"+a],delete b["computed"+a])},this);return $extend(d,
b)}});
Fx.Elements=new Class({Extends:Fx.CSS,initialize:function(a,b){this.elements=this.subject=$$(a);this.parent(b)},compute:function(a,b,c){var d={},e;for(e in a){var g=a[e],f=b[e],h=d[e]={},k;for(k in g)h[k]=this.parent(g[k],f[k],c)}return d},set:function(a){for(var b in a)if(this.elements[b]){var c=a[b],d;for(d in c)this.render(this.elements[b],d,c[d],this.options.unit)}return this},start:function(a){if(!this.check(a))return this;var b={},c={},d;for(d in a)if(this.elements[d]){var e=a[d],g=b[d]={},
f=c[d]={},h;for(h in e){var k=this.prepare(this.elements[d],h,e[h]);g[h]=k.from;f[h]=k.to}}return this.parent(b,c)}});
Fx.Accordion=new Class({Extends:Fx.Elements,options:{fixedHeight:!1,fixedWidth:!1,display:0,show:!1,height:!0,width:!1,opacity:!0,alwaysHide:!1,trigger:"click",initialDisplayFx:!0,returnHeightToAuto:!0},initialize:function(){var a=Array.link(arguments,{container:Element.type,options:Object.type,togglers:$defined,elements:$defined});this.parent(a.elements,a.options);this.togglers=$$(a.togglers);this.previous=-1;this.internalChain=new Chain;this.options.alwaysHide&&(this.options.wait=!0);$chk(this.options.show)&&
(this.options.display=!1,this.previous=this.options.show);this.options.start&&(this.options.display=!1,this.options.show=!1);this.effects={};this.options.opacity&&(this.effects.opacity="fullOpacity");this.options.width&&(this.effects.width=this.options.fixedWidth?"fullWidth":"offsetWidth");this.options.height&&(this.effects.height=this.options.fixedHeight?"fullHeight":"scrollHeight");for(var a=0,b=this.togglers.length;a<b;a++)this.addSection(this.togglers[a],this.elements[a]);this.elements.each(function(a,
b){if(this.options.show===b)this.fireEvent("active",[this.togglers[b],a]);else for(var e in this.effects)a.setStyle(e,0)},this);($chk(this.options.display)||!1===this.options.initialDisplayFx)&&this.display(this.options.display,this.options.initialDisplayFx);!1!==this.options.fixedHeight&&(this.options.returnHeightToAuto=!1);this.addEvent("complete",this.internalChain.callChain.bind(this.internalChain))},addSection:function(a,b){a=document.id(a);b=document.id(b);var c=this.togglers.contains(a);this.togglers.include(a);
this.elements.include(b);var d=this.togglers.indexOf(a),d=this.display.bind(this,d);a.store("accordion:display",d);a.addEvent(this.options.trigger,d);this.options.height&&b.setStyles({"padding-top":0,"border-top":"none","padding-bottom":0,"border-bottom":"none"});this.options.width&&b.setStyles({"padding-left":0,"border-left":"none","padding-right":0,"border-right":"none"});b.fullOpacity=1;this.options.fixedWidth&&(b.fullWidth=this.options.fixedWidth);this.options.fixedHeight&&(b.fullHeight=this.options.fixedHeight);
b.setStyle("overflow","hidden");if(!c)for(var e in this.effects)b.setStyle(e,0);return this},removeSection:function(a,b){var c=this.togglers.indexOf(a),d=this.elements[c],e=function(){this.togglers.erase(a);this.elements.erase(d);this.detach(a)}.bind(this);this.now==c||void 0!=b?this.display($pick(b,0<=c-1?c-1:0)).chain(e):e();return this},detach:function(a){var b=function(a){a.removeEvent(this.options.trigger,a.retrieve("accordion:display"))}.bind(this);a?b(a):this.togglers.each(b);return this},
display:function(a,b){if(!this.check(a,b))return this;b=$pick(b,!0);a="element"==$type(a)?this.elements.indexOf(a):a;if(a==this.previous&&!this.options.alwaysHide)return this;if(this.options.returnHeightToAuto){var c=this.elements[this.previous];if(c&&!this.selfHidden)for(var d in this.effects)c.setStyle(d,c[this.effects[d]])}if(this.timer&&this.options.wait||a===this.previous&&!this.options.alwaysHide)return this;this.previous=a;var e={};this.elements.each(function(b,c){e[c]={};var d;c!=a?d=!0:this.options.alwaysHide&&
(0<b.offsetHeight&&this.options.height||0<b.offsetWidth&&this.options.width)&&(this.selfHidden=d=!0);this.fireEvent(d?"background":"active",[this.togglers[c],b]);for(var k in this.effects)e[c][k]=d?0:b[this.effects[k]]},this);this.internalChain.clearChain();this.internalChain.chain(function(){if(this.options.returnHeightToAuto&&!this.selfHidden){var b=this.elements[a];b&&b.setStyle("height","auto")}}.bind(this));return b?this.start(e):this.set(e)}});
var Accordion=new Class({Extends:Fx.Accordion,initialize:function(){this.parent.apply(this,arguments);this.container=Array.link(arguments,{container:Element.type}).container},addSection:function(a,b,c){a=document.id(a);b=document.id(b);var d=this.togglers.contains(a),e=this.togglers.length;!e||d&&!c?this.container&&!d&&(a.inject(this.container),b.inject(this.container)):(c=$pick(c,e-1),a.inject(this.togglers[c],"before"),b.inject(a,"after"));return this.parent.apply(this,arguments)}});
Fx.Scroll=new Class({Extends:Fx,options:{offset:{x:0,y:0},wheelStops:!0},initialize:function(a,b){this.element=this.subject=document.id(a);this.parent(b);var c=this.cancel.bind(this,!1);"element"!=$type(this.element)&&(this.element=document.id(this.element.getDocument().body));var d=this.element;this.options.wheelStops&&(this.addEvent("start",function(){d.addEvent("mousewheel",c)},!0),this.addEvent("complete",function(){d.removeEvent("mousewheel",c)},!0))},set:function(){var a=Array.flatten(arguments);
Browser.Engine.gecko&&(a=[Math.round(a[0]),Math.round(a[1])]);this.element.scrollTo(a[0]+this.options.offset.x,a[1]+this.options.offset.y)},compute:function(a,b,c){return[0,1].map(function(d){return Fx.compute(a[d],b[d],c)})},start:function(a,b){if(!this.check(a,b))return this;var c=this.element.getScrollSize(),d=this.element.getScroll(),e={x:a,y:b},g;for(g in e){var f=c[g];$chk(e[g])?e[g]="number"==$type(e[g])?e[g]:f:e[g]=d[g];e[g]+=this.options.offset[g]}return this.parent([d.x,d.y],[e.x,e.y])},
toTop:function(){return this.start(!1,0)},toLeft:function(){return this.start(0,!1)},toRight:function(){return this.start("right",!1)},toBottom:function(){return this.start(!1,"bottom")},toElement:function(a){a=document.id(a).getPosition(this.element);return this.start(a.x,a.y)},scrollIntoView:function(a,b,c){b=b?$splat(b):["x","y"];var d={};a=document.id(a);var e=a.getPosition(this.element);a=a.getSize();var g=this.element.getScroll(),f=this.element.getSize(),h={x:e.x+a.x,y:e.y+a.y};["x","y"].each(function(a){b.contains(a)&&
(h[a]>g[a]+f[a]&&(d[a]=h[a]-f[a]),e[a]<g[a]&&(d[a]=e[a]));null==d[a]&&(d[a]=g[a]);c&&c[a]&&(d[a]+=c[a])},this);d.x==g.x&&d.y==g.y||this.start(d.x,d.y);return this},scrollToCenter:function(a,b,c){b=b?$splat(b):["x","y"];a=$(a);var d={},e=a.getPosition(this.element),g=a.getSize(),f=this.element.getScroll(),h=this.element.getSize();["x","y"].each(function(a){b.contains(a)&&(d[a]=e[a]-(h[a]-g[a])/2);null==d[a]&&(d[a]=f[a]);c&&c[a]&&(d[a]+=c[a])},this);d.x==f.x&&d.y==f.y||this.start(d.x,d.y);return this}});
Fx.Slide=new Class({Extends:Fx,options:{mode:"vertical",wrapper:!1,hideOverflow:!0,resetHeight:!1},initialize:function(a,b){this.addEvent("complete",function(){(this.open=0!=this.wrapper["offset"+this.layout.capitalize()])&&this.options.resetHeight&&this.wrapper.setStyle("height","");this.open&&Browser.Engine.webkit419&&this.element.dispose().inject(this.wrapper)},!0);this.element=this.subject=document.id(a);this.parent(b);var c=this.element.retrieve("wrapper"),d=this.element.getStyles("margin","position",
"overflow");this.options.hideOverflow&&(d=$extend(d,{overflow:"hidden"}));this.options.wrapper&&(c=document.id(this.options.wrapper).setStyles(d));this.wrapper=c||(new Element("div",{styles:d})).wraps(this.element);this.element.store("wrapper",this.wrapper).setStyle("margin",0);this.now=[];this.open=!0},vertical:function(){this.margin="margin-top";this.layout="height";this.offset=this.element.offsetHeight},horizontal:function(){this.margin="margin-left";this.layout="width";this.offset=this.element.offsetWidth},
set:function(a){this.element.setStyle(this.margin,a[0]);this.wrapper.setStyle(this.layout,a[1]);return this},compute:function(a,b,c){return[0,1].map(function(d){return Fx.compute(a[d],b[d],c)})},start:function(a,b){if(!this.check(a,b))return this;this[b||this.options.mode]();var c=this.element.getStyle(this.margin).toInt(),d=this.wrapper.getStyle(this.layout).toInt(),e=[[c,d],[0,this.offset]],c=[[c,d],[-this.offset,0]],g;switch(a){case "in":g=e;break;case "out":g=c;break;case "toggle":g=0==d?e:c}return this.parent(g[0],
g[1])},slideIn:function(a){return this.start("in",a)},slideOut:function(a){return this.start("out",a)},hide:function(a){this[a||this.options.mode]();this.open=!1;return this.set([-this.offset,0])},show:function(a){this[a||this.options.mode]();this.open=!0;return this.set([0,this.offset])},toggle:function(a){return this.start("toggle",a)}});
Element.Properties.slide={set:function(a){var b=this.retrieve("slide");b&&b.cancel();return this.eliminate("slide").store("slide:options",$extend({link:"cancel"},a))},get:function(a){if(a||!this.retrieve("slide"))!a&&this.retrieve("slide:options")||this.set("slide",a),this.store("slide",new Fx.Slide(this,this.retrieve("slide:options")));return this.retrieve("slide")}};
Element.implement({slide:function(a,b){a=a||"toggle";var c=this.get("slide"),d;switch(a){case "hide":c.hide(b);break;case "show":c.show(b);break;case "toggle":d=this.retrieve("slide:flag",c.open);c[d?"slideOut":"slideIn"](b);this.store("slide:flag",!d);d=!0;break;default:c.start(a,b)}d||this.eliminate("slide:flag");return this}});
var SmoothScroll=Fx.SmoothScroll=new Class({Extends:Fx.Scroll,initialize:function(a,b){b=b||document;this.doc=b.getDocument();var c=b.getWindow();this.parent(this.doc,a);this.links=$$(this.options.links||this.doc.links);var d=c.location.href.match(/^[^#]*/)[0]+"#";this.links.each(function(a){if(0==a.href.indexOf(d)){var b=a.href.substr(d.length);b&&this.useLink(a,b)}},this);Browser.Engine.webkit419||this.addEvent("complete",function(){c.location.hash=this.anchor},!0)},useLink:function(a,b){var c;
a.addEvent("click",function(d){!1===c||c||(c=document.id(b)||this.doc.getElement("a[name="+b+"]"));c&&(d.preventDefault(),this.anchor=b,this.toElement(c).chain(function(){this.fireEvent("scrolledTo",[a,c])}.bind(this)),a.blur())}.bind(this))}}),Drag=new Class({Implements:[Events,Options],options:{snap:6,unit:"px",grid:!1,style:!0,limit:!1,handle:!1,invert:!1,preventDefault:!1,stopPropagation:!1,modifiers:{x:"left",y:"top"}},initialize:function(){var a=Array.link(arguments,{options:Object.type,element:$defined});
this.element=document.id(a.element);this.document=this.element.getDocument();this.setOptions(a.options||{});a=$type(this.options.handle);this.handles=("array"==a||"collection"==a?$$(this.options.handle):document.id(this.options.handle))||this.element;this.mouse={now:{},pos:{}};this.value={start:{},now:{}};this.selection=Browser.Engine.trident?"selectstart":"mousedown";this.bound={start:this.start.bind(this),check:this.check.bind(this),drag:this.drag.bind(this),stop:this.stop.bind(this),cancel:this.cancel.bind(this),
eventStop:$lambda(!1)};this.attach()},attach:function(){this.handles.addEvent("mousedown",this.bound.start);return this},detach:function(){this.handles.removeEvent("mousedown",this.bound.start);return this},start:function(a){if(!a.rightClick){this.options.preventDefault&&a.preventDefault();this.options.stopPropagation&&a.stopPropagation();this.mouse.start=a.page;this.fireEvent("beforeStart",this.element);var b=this.options.limit;this.limit={x:[],y:[]};var c=this.element.getStyles("left","right","top",
"bottom");this._invert={x:"left"==this.options.modifiers.x&&"auto"==c.left&&!isNaN(c.right.toInt())&&(this.options.modifiers.x="right"),y:"top"==this.options.modifiers.y&&"auto"==c.top&&!isNaN(c.bottom.toInt())&&(this.options.modifiers.y="bottom")};var d,e;for(d in this.options.modifiers)if(this.options.modifiers[d]&&((c=this.element.getStyle(this.options.modifiers[d]))&&!c.match(/px$/)&&(e||(e=this.element.getCoordinates(this.element.getOffsetParent())),c=e[this.options.modifiers[d]]),this.value.now[d]=
this.options.style?(c||0).toInt():this.element[this.options.modifiers[d]],this.options.invert&&(this.value.now[d]*=-1),this._invert[d]&&(this.value.now[d]*=-1),this.mouse.pos[d]=a.page[d]-this.value.now[d],b&&b[d]))for(c=2;c--;c)$chk(b[d][c])&&(this.limit[d][c]=$lambda(b[d][c])());"number"==$type(this.options.grid)&&(this.options.grid={x:this.options.grid,y:this.options.grid});this.document.addEvents({mousemove:this.bound.check,mouseup:this.bound.cancel});this.document.addEvent(this.selection,this.bound.eventStop)}},
check:function(a){this.options.preventDefault&&a.preventDefault();Math.round(Math.sqrt(Math.pow(a.page.x-this.mouse.start.x,2)+Math.pow(a.page.y-this.mouse.start.y,2)))>this.options.snap&&(this.cancel(),this.document.addEvents({mousemove:this.bound.drag,mouseup:this.bound.stop}),this.fireEvent("start",[this.element,a]).fireEvent("snap",this.element))},drag:function(a){this.options.preventDefault&&a.preventDefault();this.mouse.now=a.page;for(var b in this.options.modifiers)this.options.modifiers[b]&&
(this.value.now[b]=this.mouse.now[b]-this.mouse.pos[b],this.options.invert&&(this.value.now[b]*=-1),this._invert[b]&&(this.value.now[b]*=-1),this.options.limit&&this.limit[b]&&($chk(this.limit[b][1])&&this.value.now[b]>this.limit[b][1]?this.value.now[b]=this.limit[b][1]:$chk(this.limit[b][0])&&this.value.now[b]<this.limit[b][0]&&(this.value.now[b]=this.limit[b][0])),this.options.grid[b]&&(this.value.now[b]-=(this.value.now[b]-(this.limit[b][0]||0))%this.options.grid[b]),this.options.style?this.element.setStyle(this.options.modifiers[b],
this.value.now[b]+this.options.unit):this.element[this.options.modifiers[b]]=this.value.now[b]);this.fireEvent("drag",[this.element,a])},cancel:function(a){this.document.removeEvent("mousemove",this.bound.check);this.document.removeEvent("mouseup",this.bound.cancel);a&&(this.document.removeEvent(this.selection,this.bound.eventStop),this.fireEvent("cancel",this.element))},stop:function(a){this.document.removeEvent(this.selection,this.bound.eventStop);this.document.removeEvent("mousemove",this.bound.drag);
this.document.removeEvent("mouseup",this.bound.stop);a&&this.fireEvent("complete",[this.element,a])}});Element.implement({makeResizable:function(a){var b=new Drag(this,$merge({modifiers:{x:"width",y:"height"}},a));this.store("resizer",b);return b.addEvent("drag",function(){this.fireEvent("resize",b)}.bind(this))}});
Drag.Move=new Class({Extends:Drag,options:{droppables:[],container:!1,precalculate:!1,includeMargins:!0,checkDroppables:!0},initialize:function(a,b){this.parent(a,b);a=this.element;this.droppables=$$(this.options.droppables);(this.container=document.id(this.options.container))&&"element"!=$type(this.container)&&(this.container=document.id(this.container.getDocument().body));if(this.options.style){if("left"==this.options.modifiers.x&&"top"==this.options.modifiers.y){var c,d=document.id(a.getOffsetParent());
d&&(c=d.getStyles("border-top-width","border-left-width"));var e=a.getStyles("left","top");!d||"auto"!=e.left&&"auto"!=e.top||(d=a.getPosition(d),d.x-=c["border-left-width"]?c["border-left-width"].toInt():0,d.y-=c["border-top-width"]?c["border-top-width"].toInt():0,a.setPosition(d))}"static"==a.getStyle("position")&&a.setStyle("position","absolute")}this.addEvent("start",this.checkDroppables,!0);this.overed=null},start:function(a){this.container&&(this.options.limit=this.calculateLimit());this.options.precalculate&&
(this.positions=this.droppables.map(function(a){return a.getCoordinates()}));this.parent(a)},calculateLimit:function(){var a=document.id(this.element.getOffsetParent())||document.body,b=this.container.getCoordinates(a),c={},d={},e={},g={},f={};["top","right","bottom","left"].each(function(b){c[b]=this.container.getStyle("border-"+b).toInt();this.element.getStyle("border-"+b).toInt();d[b]=this.element.getStyle("margin-"+b).toInt();e[b]=this.container.getStyle("margin-"+b).toInt();f[b]=a.getStyle("padding-"+
b).toInt();g[b]=a.getStyle("border-"+b).toInt()},this);var h=0,k=0,m=b.right-c.right-(this.element.offsetWidth+d.left+d.right),l=b.bottom-c.bottom-(this.element.offsetHeight+d.top+d.bottom);this.options.includeMargins?(h+=d.left,k+=d.top):(m+=d.right,l+=d.bottom);"relative"==this.element.getStyle("position")?(b=this.element.getCoordinates(a),b.left-=this.element.getStyle("left").toInt(),b.top-=this.element.getStyle("top").toInt(),h+=c.left-b.left,k+=c.top-b.top,m+=d.left-b.left,l+=d.top-b.top,this.container!=
a&&(h+=e.left+f.left,k+=(Browser.Engine.trident4?0:e.top)+f.top)):(h-=d.left,k-=d.top,this.container==a?(m-=c.left,l-=c.top):(h+=b.left+c.left-g.left,k+=b.top+c.top-g.top,m-=g.left,l-=g.top));return{x:[h,m],y:[k,l]}},checkAgainst:function(a,b){a=this.positions?this.positions[b]:a.getCoordinates();var c=this.mouse.now;return c.x>a.left&&c.x<a.right&&c.y<a.bottom&&c.y>a.top},checkDroppables:function(){var a=this.droppables.filter(this.checkAgainst,this).getLast();this.overed!=a&&(this.overed&&this.fireEvent("leave",
[this.element,this.overed]),a&&this.fireEvent("enter",[this.element,a]),this.overed=a)},drag:function(a){this.parent(a);this.options.checkDroppables&&this.droppables.length&&this.checkDroppables()},stop:function(a){this.checkDroppables();this.fireEvent("drop",[this.element,this.overed,a]);this.overed=null;return this.parent(a)}});Element.implement({makeDraggable:function(a){a=new Drag.Move(this,a);this.store("dragger",a);return a}});
var Slider=new Class({Implements:[Events,Options],Binds:["clickedElement","draggedKnob","scrolledElement"],options:{onTick:function(a){this.options.snap&&(a=this.toPosition(this.step));this.knob.setStyle(this.property,a)},initialStep:0,snap:!1,offset:0,range:!1,wheel:!1,steps:100,mode:"horizontal"},initialize:function(a,b,c){this.setOptions(c);this.element=document.id(a);this.knob=document.id(b);this.previousChange=this.previousEnd=this.step=-1;var d;a={};b={x:!1,y:!1};switch(this.options.mode){case "vertical":this.axis=
"y";this.property="top";d="offsetHeight";break;case "horizontal":this.axis="x",this.property="left",d="offsetWidth"}this.full=this.element.measure(function(){this.half=this.knob[d]/2;return this.element[d]-this.knob[d]+2*this.options.offset}.bind(this));this.setRange(this.options.range);this.knob.setStyle("position","relative").setStyle(this.property,-this.options.offset);b[this.axis]=this.property;a[this.axis]=[-this.options.offset,this.full-this.options.offset];a={snap:0,limit:a,modifiers:b,onDrag:this.draggedKnob,
onStart:this.draggedKnob,onBeforeStart:function(){this.isDragging=!0}.bind(this),onCancel:function(){this.isDragging=!1}.bind(this),onComplete:function(){this.isDragging=!1;this.draggedKnob();this.end()}.bind(this)};this.options.snap&&(a.grid=Math.ceil(this.stepWidth),a.limit[this.axis][1]=this.full);this.drag=new Drag(this.knob,a);this.attach();null!=this.options.initialStep&&this.set(this.options.initialStep)},attach:function(){this.element.addEvent("mousedown",this.clickedElement);this.options.wheel&&
this.element.addEvent("mousewheel",this.scrolledElement);this.drag.attach();return this},detach:function(){this.element.removeEvent("mousedown",this.clickedElement);this.element.removeEvent("mousewheel",this.scrolledElement);this.drag.detach();return this},set:function(a){0<this.range^a<this.min||(a=this.min);0<this.range^a>this.max||(a=this.max);this.step=Math.round(a);this.checkStep();this.fireEvent("tick",this.toPosition(this.step));this.end();return this},setRange:function(a,b){this.min=$pick(a[0],
0);this.max=$pick(a[1],this.options.steps);this.range=this.max-this.min;this.steps=this.options.steps||this.full;this.stepSize=Math.abs(this.range)/this.steps;this.stepWidth=this.stepSize*this.full/Math.abs(this.range);this.set($pick(b,this.step).floor(this.min).max(this.max));return this},clickedElement:function(a){if(!this.isDragging&&a.target!=this.knob){var b=0>this.range?-1:1;a=a.page[this.axis]-this.element.getPosition()[this.axis]-this.half;a=a.limit(-this.options.offset,this.full-this.options.offset);
this.step=Math.round(this.min+b*this.toStep(a));this.checkStep();this.fireEvent("tick",a);this.end()}},scrolledElement:function(a){this.set(("horizontal"==this.options.mode?0>a.wheel:0<a.wheel)?this.step-this.stepSize:this.step+this.stepSize);a.stop()},draggedKnob:function(){var a=0>this.range?-1:1,b=this.drag.value.now[this.axis],b=b.limit(-this.options.offset,this.full-this.options.offset);this.step=Math.round(this.min+a*this.toStep(b));this.checkStep()},checkStep:function(){this.previousChange!=
this.step&&(this.previousChange=this.step,this.fireEvent("change",this.step))},end:function(){this.previousEnd!==this.step&&(this.previousEnd=this.step,this.fireEvent("complete",this.step+""))},toStep:function(a){a=(a+this.options.offset)*this.stepSize/this.full*this.steps;return this.options.steps?Math.round(a-a%this.stepSize):a},toPosition:function(a){return this.full*Math.abs(this.min-a)/(this.steps*this.stepSize)-this.options.offset}}),Sortables=new Class({Implements:[Events,Options],options:{snap:4,
opacity:1,clone:!1,revert:!1,handle:!1,constrain:!1,preventDefault:!1},initialize:function(a,b){this.setOptions(b);this.elements=[];this.lists=[];this.idle=!0;this.addLists($$(document.id(a)||a));this.options.clone||(this.options.revert=!1);this.options.revert&&(this.effect=new Fx.Morph(null,$merge({duration:250,link:"cancel"},this.options.revert)))},attach:function(){this.addLists(this.lists);return this},detach:function(){this.lists=this.removeLists(this.lists);return this},addItems:function(){Array.flatten(arguments).each(function(a){this.elements.push(a);
var b=a.retrieve("sortables:start",this.start.bindWithEvent(this,a));(this.options.handle?a.getElement(this.options.handle)||a:a).addEvent("mousedown",b)},this);return this},addLists:function(){Array.flatten(arguments).each(function(a){this.lists.push(a);this.addItems(a.getChildren())},this);return this},removeItems:function(){return $$(Array.flatten(arguments).map(function(a){this.elements.erase(a);var b=a.retrieve("sortables:start");(this.options.handle?a.getElement(this.options.handle)||a:a).removeEvent("mousedown",
b);return a},this))},removeLists:function(){return $$(Array.flatten(arguments).map(function(a){this.lists.erase(a);this.removeItems(a.getChildren());return a},this))},getClone:function(a,b){if(!this.options.clone)return(new Element(b.tagName)).inject(document.body);if("function"==$type(this.options.clone))return this.options.clone.call(this,a,b,this.list);var c=b.clone(!0).setStyles({margin:"0px",position:"absolute",visibility:"hidden",width:b.getStyle("width")});c.get("html").test("radio")&&c.getElements("input[type=radio]").each(function(a,
c){a.set("name","clone_"+c);a.get("checked")&&b.getElements("input[type=radio]")[c].set("checked",!0)});return c.inject(this.list).setPosition(b.getPosition(b.getOffsetParent()))},getDroppables:function(){var a=this.list.getChildren();this.options.constrain||(a=this.lists.concat(a).erase(this.list));return a.erase(this.clone).erase(this.element)},insert:function(a,b){var c="inside";this.lists.contains(b)?(this.list=b,this.drag.droppables=this.getDroppables()):c=this.element.getAllPrevious().contains(b)?
"before":"after";this.element.inject(b,c);this.fireEvent("sort",[this.element,this.clone])},start:function(a,b){!this.idle||a.rightClick||["button","input"].contains(document.id(a.target).get("tag"))||(this.idle=!1,this.element=b,this.opacity=b.get("opacity"),this.list=b.getParent(),this.clone=this.getClone(a,b),this.drag=new Drag.Move(this.clone,{preventDefault:this.options.preventDefault,snap:this.options.snap,container:this.options.constrain&&this.element.getParent(),droppables:this.getDroppables(),
onSnap:function(){a.stop();this.clone.setStyle("visibility","visible");this.element.set("opacity",this.options.opacity||0);this.fireEvent("start",[this.element,this.clone])}.bind(this),onEnter:this.insert.bind(this),onCancel:this.reset.bind(this),onComplete:this.end.bind(this)}),this.clone.inject(this.element,"before"),this.drag.start(a))},end:function(){this.drag.detach();this.element.set("opacity",this.opacity);if(this.effect){var a=this.element.getStyles("width","height"),b=this.clone.computePosition(this.element.getPosition(this.clone.getOffsetParent()));
this.effect.element=this.clone;this.effect.start({top:b.top,left:b.left,width:a.width,height:a.height,opacity:0.25}).chain(this.reset.bind(this))}else this.reset()},reset:function(){this.idle=!0;this.clone.destroy();this.fireEvent("complete",this.element)},serialize:function(){var a=Array.link(arguments,{modifier:Function.type,index:$defined}),b=this.lists.map(function(b){return b.getChildren().map(a.modifier||function(a){return a.get("id")},this)},this),c=a.index;1==this.lists.length&&(c=0);return $chk(c)&&
0<=c&&c<this.lists.length?b[c]:b}}),Asset={javascript:function(a,b){b=$extend({onload:$empty,document:document,check:$lambda(!0)},b);b.onLoad&&(b.onload=b.onLoad,delete b.onLoad);var c=new Element("script",{src:a,type:"text/javascript"}),d=b.onload.bind(c),e=b.check,g=b.document;delete b.onload;delete b.check;delete b.document;c.addEvents({load:d,readystatechange:function(){["loaded","complete"].contains(this.readyState)&&d()}}).set(b);if(Browser.Engine.webkit419)var f=function(){$try(e)&&($clear(f),
d())}.periodical(50);return c.inject(g.head)},css:function(a,b){b=b||{};var c=b.onload||b.onLoad;c&&(b.events=b.events||{},b.events.load=c,delete b.onload,delete b.onLoad);return(new Element("link",$merge({rel:"stylesheet",media:"screen",type:"text/css",href:a},b))).inject(document.head)},image:function(a,b){b=$merge({onload:$empty,onabort:$empty,onerror:$empty},b);var c=new Image,d=document.id(c)||new Element("img");["load","abort","error"].each(function(a){var g="on"+a,f=a.capitalize();b["on"+f]&&
(b[g]=b["on"+f],delete b["on"+f]);var h=b[g];delete b[g];c[g]=function(){c&&(d.parentNode||(d.width=c.width,d.height=c.height),c=c.onload=c.onabort=c.onerror=null,h.delay(1,d,d),d.fireEvent(a,d,1))}});c.src=d.src=a;c&&c.complete&&c.onload.delay(1);return d.set(b)},images:function(a,b){b=$merge({onComplete:$empty,onProgress:$empty,onError:$empty,properties:{}},b);a=$splat(a);var c=0;return new Elements(a.map(function(d,e){return Asset.image(d,$extend(b.properties,{onload:function(){b.onProgress.call(this,
c,e);c++;if(c==a.length)b.onComplete()},onerror:function(){b.onError.call(this,c,e);c++;if(c==a.length)b.onComplete()}}))}))}},Color=new Native({initialize:function(a,b){3<=arguments.length?(b="rgb",a=Array.slice(arguments,0,3)):"string"==typeof a&&(a=a.match(/rgb/)?a.rgbToHex().hexToRgb(!0):a.match(/hsb/)?a.hsbToRgb():a.hexToRgb(!0));switch(b||"rgb"){case "hsb":var c=a;a=a.hsbToRgb();a.hsb=c;break;case "hex":a=a.hexToRgb(!0)}a.rgb=a.slice(0,3);a.hsb=a.hsb||a.rgbToHsb();a.hex=a.rgbToHex();return $extend(a,
this)}});
Color.implement({mix:function(){var a=Array.slice(arguments),b="number"==$type(a.getLast())?a.pop():50,c=this.slice();a.each(function(a){a=new Color(a);for(var e=0;3>e;e++)c[e]=Math.round(c[e]/100*(100-b)+a[e]/100*b)});return new Color(c,"rgb")},invert:function(){return new Color(this.map(function(a){return 255-a}))},setHue:function(a){return new Color([a,this.hsb[1],this.hsb[2]],"hsb")},setSaturation:function(a){return new Color([this.hsb[0],a,this.hsb[2]],"hsb")},setBrightness:function(a){return new Color([this.hsb[0],this.hsb[1],
a],"hsb")}});var $RGB=function(a,b,c){return new Color([a,b,c],"rgb")},$HSB=function(a,b,c){return new Color([a,b,c],"hsb")},$HEX=function(a){return new Color(a,"hex")};
Array.implement({rgbToHsb:function(){var a=this[0],b=this[1],c=this[2],d=0,e=Math.max(a,b,c),g=Math.min(a,b,c),f=e-g,g=e/255,h=0!=e?f/e:0;if(0!=h){var d=(e-a)/f,k=(e-b)/f,c=(e-c)/f,d=(a==e?c-k:b==e?2+d-c:4+k-d)/6;0>d&&d++}return[Math.round(360*d),Math.round(100*h),Math.round(100*g)]},hsbToRgb:function(){var a=Math.round(this[2]/100*255);if(0==this[1])return[a,a,a];var b=this[0]%360,c=b%60,d=Math.round(this[2]*(100-this[1])/1E4*255),e=Math.round(this[2]*(6E3-this[1]*c)/6E5*255),c=Math.round(this[2]*
(6E3-this[1]*(60-c))/6E5*255);switch(Math.floor(b/60)){case 0:return[a,c,d];case 1:return[e,a,d];case 2:return[d,a,c];case 3:return[d,e,a];case 4:return[c,d,a];case 5:return[a,d,e]}return!1}});String.implement({rgbToHsb:function(){var a=this.match(/\d{1,3}/g);return a?a.rgbToHsb():null},hsbToRgb:function(){var a=this.match(/\d{1,3}/g);return a?a.hsbToRgb():null}});
var Group=new Class({initialize:function(){this.instances=Array.flatten(arguments);this.events={};this.checker={}},addEvent:function(a,b){this.checker[a]=this.checker[a]||{};this.events[a]=this.events[a]||[];if(this.events[a].contains(b))return!1;this.events[a].push(b);this.instances.each(function(b,d){b.addEvent(a,this.check.bind(this,[a,b,d]))},this);return this},check:function(a,b,c){this.checker[a][c]=!0;this.instances.every(function(b,c){return this.checker[a][c]||!1},this)&&(this.checker[a]=
{},this.events[a].each(function(a){a.call(this,this.instances,b)},this))}});Hash.Cookie=new Class({Extends:Cookie,options:{autoSave:!0},initialize:function(a,b){this.parent(a,b);this.load()},save:function(){var a=JSON.encode(this.hash);if(!a||4096<a.length)return!1;"{}"==a?this.dispose():this.write(a);return!0},load:function(){this.hash=new Hash(JSON.decode(this.read(),!0));return this}});
Hash.each(Hash.prototype,function(a,b){"function"==typeof a&&Hash.Cookie.implement(b,function(){var b=a.apply(this.hash,arguments);this.options.autoSave&&this.save();return b})});
var Scroller=new Class({Implements:[Events,Options],options:{area:20,velocity:1,onChange:function(a,b){this.element.scrollTo(a,b)},fps:50},initialize:function(a,b){this.setOptions(b);this.element=document.id(a);this.docBody=document.id(this.element.getDocument().body);this.listener="element"!=$type(this.element)?this.docBody:this.element;this.timer=null;this.bound={attach:this.attach.bind(this),detach:this.detach.bind(this),getCoords:this.getCoords.bind(this)}},start:function(){this.listener.addEvents({mouseenter:this.bound.attach,
mouseleave:this.bound.detach})},stop:function(){this.listener.removeEvents({mouseenter:this.bound.attach,mouseleave:this.bound.detach});this.detach();this.timer=$clear(this.timer)},attach:function(){this.listener.addEvent("mousemove",this.bound.getCoords)},detach:function(){this.listener.removeEvent("mousemove",this.bound.getCoords);this.timer=$clear(this.timer)},getCoords:function(a){this.page="body"==this.listener.get("tag")?a.client:a.page;this.timer||(this.timer=this.scroll.periodical(Math.round(1E3/
this.options.fps),this))},scroll:function(){var a=this.element.getSize(),b=this.element.getScroll(),c=this.element!=this.docBody?this.element.getOffsets():{x:0,y:0},d=this.element.getScrollSize(),e={x:0,y:0},g=this.options.area.top||this.options.area,f=this.options.area.bottom||this.options.area,h;for(h in this.page)this.page[h]<g+c[h]&&0!=b[h]?e[h]=(this.page[h]-g-c[h])*this.options.velocity:this.page[h]+f>a[h]+c[h]&&b[h]+a[h]!=d[h]&&(e[h]=(this.page[h]-a[h]+f-c[h])*this.options.velocity),e[h]=e[h].round();
(e.y||e.x)&&this.fireEvent("change",[b.x+e.x,b.y+e.y])}});
(function(){this.Tips=new Class({Implements:[Events,Options],options:{onShow:function(){this.tip.setStyle("display","block")},onHide:function(){this.tip.setStyle("display","none")},title:"title",text:function(a){return a.get("rel")||a.get("href")},showDelay:100,hideDelay:100,className:"tip-wrap",offset:{x:16,y:16},windowPadding:{x:0,y:0},fixed:!1},initialize:function(){var a=Array.link(arguments,{options:Object.type,elements:$defined});this.setOptions(a.options);a.elements&&this.attach(a.elements);
this.container=new Element("div",{"class":"tip"})},toElement:function(){return this.tip?this.tip:this.tip=(new Element("div",{"class":this.options.className,styles:{position:"absolute",top:0,left:0}})).adopt(new Element("div",{"class":"tip-top"}),this.container,new Element("div",{"class":"tip-bottom"}))},attach:function(a){$$(a).each(function(a){var c=this.options.title?"function"==$type(this.options.title)?(0,this.options.title)(a):a.get(this.options.title):"",d=this.options.text?"function"==$type(this.options.text)?
(0,this.options.text)(a):a.get(this.options.text):"";a.erase("title").store("tip:native",c).retrieve("tip:title",c);a.retrieve("tip:text",d);this.fireEvent("attach",[a]);c=["enter","leave"];this.options.fixed||c.push("move");c.each(function(c){var d=a.retrieve("tip:"+c);d||(d=this["element"+c.capitalize()].bindWithEvent(this,a));a.store("tip:"+c,d).addEvent("mouse"+c,d)},this)},this);return this},detach:function(a){$$(a).each(function(a){["enter","leave","move"].each(function(c){a.removeEvent("mouse"+
c,a.retrieve("tip:"+c)).eliminate("tip:"+c)});this.fireEvent("detach",[a]);if("title"==this.options.title){var c=a.retrieve("tip:native");c&&a.set("title",c)}},this);return this},elementEnter:function(a,b){this.container.empty();["title","text"].each(function(a){var d=b.retrieve("tip:"+a);d&&this.fill((new Element("div",{"class":"tip-"+a})).inject(this.container),d)},this);$clear(this.timer);this.timer=function(){this.show(b);this.position(this.options.fixed?{page:b.getPosition()}:a)}.delay(this.options.showDelay,
this)},elementLeave:function(a,b){$clear(this.timer);this.timer=this.hide.delay(this.options.hideDelay,this,b);this.fireForParent(a,b)},fireForParent:function(a,b){(b=b.getParent())&&b!=document.body&&(b.retrieve("tip:enter")?b.fireEvent("mouseenter",a):this.fireForParent(a,b))},elementMove:function(a,b){this.position(a)},position:function(a){this.tip||document.id(this);var b=window.getSize(),c=window.getScroll(),d={x:this.tip.offsetWidth,y:this.tip.offsetHeight},e={x:"left",y:"top"},g={},f;for(f in e)g[e[f]]=
a.page[f]+this.options.offset[f],g[e[f]]+d[f]-c[f]>b[f]-this.options.windowPadding[f]&&(g[e[f]]=a.page[f]-this.options.offset[f]-d[f]);this.tip.setStyles(g)},fill:function(a,b){"string"==typeof b?a.set("html",b):a.adopt(b)},show:function(a){this.tip||document.id(this);this.tip.getParent()||this.tip.inject(document.body);this.fireEvent("show",[this.tip,a])},hide:function(a){this.tip||document.id(this);this.fireEvent("hide",[this.tip,a])}})})();var qwebirc={ui:{themes:{},style:{}},irc:{},util:{crypto:{}},config:{},options:{},auth:{},sound:{},connected:!1},conf=null,ui=null;"undefined"!=typeof QWEBIRC_BUILD?(qwebirc.BUILD=QWEBIRC_BUILD,qwebirc.FILE_SUFFIX="-"+QWEBIRC_BUILD):(qwebirc.BUILD=null,qwebirc.FILE_SUFFIX="");qwebirc.config.load=function(a){a.frontend.initial_nick_default=a.frontend.initial_nick;a.frontend.initial_chans_default=a.frontend.initial_chans;a.frontend.prompt_default=a.frontend.prompt;a.ui.fg_color_default=a.ui.fg_color;a.ui.fg_sec_color_default=a.ui.fg_sec_color;a.ui.bg_color_default=a.ui.bg_color;qwebirc.config.loadCookieSettings(a);var b=String(document.location),c=qwebirc.util.parseURI(b);$defined(c.nick)&&!$defined(c.initial_nick)&&(c.initial_nick=c.nick);$defined(c.channels)&&!$defined(c.initial_chans)&&
(c.initial_chans=c.channels);-1!=b.splitMax("/",4)[3].indexOf("?")&&(c.chan_list_on_start="0");$defined(c.initial_nick)&&(a.frontend.initial_nick=c.initial_nick,a.frontend.chan_prompt=!1);$defined(c.url)&&(b=qwebirc.config.parseIRCURL(c.url))&&(a.frontend.initial_chans=b,a.frontend.chan_prompt=!1);$defined(c.initial_chans)&&(a.frontend.initial_chans=c.initial_chans);$defined(c.prompt)&&(a.frontend.prompt=1==c.prompt?!0:!1);$defined(c.chan_prompt)&&(a.frontend.chan_prompt=1==c.chan_prompt?!0:!1);$defined(c.chan_list_on_start)&&
(a.atheme.chan_list_on_start=1==c.chan_list_on_start?!0:!1);$defined(c.fg_color)&&(a.ui.fg_color=c.fg_color,a.ui.fg_sec_color=c.fg_color);$defined(c.fg_sec_color)&&(a.ui.fg_sec_color=c.fg_sec_color);$defined(c.bg_color)&&(a.ui.bg_color=c.bg_color);-1!=a.frontend.initial_nick.indexOf(".")?(a.frontend.initial_nick=qwebirc.config.randSub(a.frontend.initial_nick),a.frontend.initial_nick_rand=!0):a.frontend.initial_nick_rand=!1;if(a.frontend.initial_chans){for(var c=a.frontend.initial_chans.split(" "),
b=c[0].split(" ")[0].split(","),d=0;d<b.length;d++)"#"!=b[d].charAt(0)&&(b[d]="#"+b[d]);c[0]=b.join(",");a.frontend.initial_chans=c.join(" ")}return a};qwebirc.config.loadCookieSettings=function(a){for(var b=new Hash.Cookie("iris-settings",{duration:3650,autoSave:!1}),c=0;c<qwebirc.options.Options.length;c++){var d=qwebirc.options.Options[c].category,e=qwebirc.options.Options[c].option,g=d+"."+e;$defined(b.get(g))&&(a[d][e]=b.get(g))}};
qwebirc.config.saveUserSettings=function(a){var b=new Hash.Cookie("iris-settings",{duration:3650,autoSave:!1});b.erase();for(var b=new Hash.Cookie("iris-settings",{duration:3650,autoSave:!1}),c=0;c<qwebirc.options.Options.length;c++){var d=qwebirc.options.Options[c].category,e=qwebirc.options.Options[c].option;b.set(d+"."+e,a[d][e])}b.save()};qwebirc.config.randSub=function(a){return a.split("").map(function(a){return"."==a?Math.floor(10*Math.random()):a}).join("")};
qwebirc.config.parseIRCURL=function(a){if(0!=a.indexOf(":")){var b=a.splitMax(":",2);if("irc"!=b[0].toLowerCase()&&"ircs"!=b[0].toLowerCase())alert("Bad IRC URL scheme.");else if(0!=a.indexOf("/")&&(a=a.splitMax("/",4),!(4>a.length||""==a[3]))){var c;-1<a[3].indexOf("?")?(c=qwebirc.util.parseURI(a[3]),a=a[3].splitMax("?",2)[0]):a=a[3];a=a.split(",");b=a[0];"#"!=b.charAt(0)&&(b="#"+b);for(var d=[],e=!1,g,f=1;f<a.length;f++){var h=a[f];"needkey"==h?e=!0:d.push(h)}if($defined(c))for(var k in c)h=c[k],
"key"==k?(g=h,e=!0):d.push(k);e&&($defined(g)||(g=prompt("Please enter the password for channel "+b+":")),$defined(g)&&(b=b+" "+g));0<d.length&&alert("The following IRC URL components were not accepted: "+d.join(", ")+".");return b}}};qwebirc.util.crypto.getARC4Stream=function(a,b){for(var c=[],d=[],e=0;e<a.length;e++)d.push(a.charCodeAt(e));for(e=0;256>e;e++)c[e]=e;for(var g=0,e=0;256>e;e++){var g=g+c[e]+d[e%a.length]&255,f=c[e];c[e]=c[g];c[g]=f}for(var d=[],h=g=e=0;h<b;h++)e=e+1&255,g=g+c[e]&255,f=c[e],c[e]=c[g],c[g]=f,d.push(c[c[e]+c[g]&255]);return d};qwebirc.util.crypto.xorStreams=function(a,b){if(a.length==b.length){for(var c=[],d=0;d<a.length;d++)c.push(String.fromCharCode(a.charCodeAt(d)^b[d]));return c.join("")}};
qwebirc.util.crypto.ARC4=function(a,b){var c=qwebirc.util.crypto.getARC4Stream(a,b.length+1024),c=c.slice(1024);return qwebirc.util.crypto.xorStreams(b,c)};Array.prototype.indexFromEnd=function(a){return 0>a?this[this.length+a]:this[a]};qwebirc.util.dictCopy=function(a){var b={},c;for(c in a)b[c]=a[c];return b};String.prototype.replaceAll=function(a,b){for(var c=this.indexOf(a),d=this;-1<c;)d=d.replace(a,b),c=d.indexOf(a);return d};String.prototype.splitMax=function(a,b){var c=this.split(a),d=c.slice(0,b-1);c.length>=b&&d.push(c.slice(b-1).join(a));return d};
qwebirc.util.parseURI=function(a){var b={},c=a.indexOf("?");if(-1==c)return b;a=a.substring(c+1).split("&");for(c=0;c<a.length;c++){var d=a[c].splitMax("=",2);2>d.length||(b[unescape(d[0])]=unescape(d[1]))}return b};qwebirc.util.DaysOfWeek={0:"Sun",1:"Mon",2:"Tue",3:"Wed",4:"Thu",5:"Fri",6:"Sat"};qwebirc.util.MonthsOfYear={0:"Jan",1:"Feb",2:"Mar",3:"Apr",4:"May",5:"Jun",6:"Jul",7:"Aug",8:"Sep",9:"Oct",10:"Nov",11:"Dec"};
qwebirc.util.longtoduration=function(a){return Math.floor(a/86400)+" days "+Math.floor(a%86400/3600)+" hours "+Math.floor(a%3600/60)+" minutes "+a%60+" seconds"};qwebirc.util.pad=function(a){a=""+a;return 1==a.length?"0"+a:a};RegExp.escape=function(a){arguments.callee.sRE||(arguments.callee.sRE=RegExp("(\\/|\\.|\\*|\\+|\\?|\\||\\(|\\)|\\[|\\]|\\{|\\}|\\\\)","g"));return a.replace(arguments.callee.sRE,"\\$1")};
qwebirc.ui.insertAt=function(a,b,c){!b.childNodes||a>=b.childNodes.length?b.appendChild(c):b.insertBefore(c,b.childNodes[a])};qwebirc.util.setCaretPos=function(a,b){if($defined(a.selectionStart))a.focus(),a.setSelectionRange(b,b);else if(a.createTextRange){var c=a.createTextRange();c.move("character",b);c.select()}};qwebirc.util.setAtEnd=function(a){qwebirc.util.setCaretPos(a.value.length)};
qwebirc.util.getCaretPos=function(a){if($defined(a.selectionStart))return a.selectionStart;if(document.selection){a.focus();var b=document.selection.createRange();b.moveStart("character",-a.value.length);return b.text.length}};qwebirc.util.browserVersion=function(){return navigator.userAgent};
qwebirc.util.getEnclosedWord=function(a,b){var c=a.split("");if(""!=a){var d=b-1;if(0>d)d=0;else for(;0<=d;d--)if(" "==c[d]){d+=1;break}0>d&&(d=0);var c=a.substring(d),e=c.indexOf(" ");-1!=e&&(c=c.substring(0,e));return[d,c]}};String.prototype.startsWith=function(a){return this.substring(0,a.length)==a};qwebirc.util.randHexString=function(a){for(var b=[],c=0;c<a;c++)b.push((256*(1+Math.random())|0).toString(16).substring(1));return b.join("")};
qwebirc.util.importJS=function(a,b,c){var d=document.createElement("script");d.type="text/javascript";d.src=a;if(Browser.Engine.trident){var e=function(){"undefined"!=eval("typeof "+b)?c():e.delay(100)};e()}else d.onload=c;document.getElementsByTagName("head")[0].appendChild(d)};
qwebirc.util.createInput=function(a,b,c,d,e){var g;if(Browser.Engine.trident){c=c?' name="'+escape(c)+'"':"";e=e?' id="'+escape(e)+'"':"";try{return $(document.createElement('<input type="'+a+'"'+c+e+" "+(d?" checked":"")+"/>"))}catch(f){}}g=new Element("input");g.type=a;c&&(g.name=c);e&&(g.id=e);d&&(g.checked=!0);b.appendChild(g);return g};qwebirc.util.b64Table="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";
qwebirc.util.b64Encode=function(a){for(var b=[],c=qwebirc.util.b64Table,d=0;d<a.length;){var e=a.charCodeAt(d++),g=a.charCodeAt(d++),f=a.charCodeAt(d++),h=e>>2,e=(e&3)<<4|g>>4,k=(g&15)<<2|f>>6,m=f&63;isNaN(g)?k=m=64:isNaN(f)&&(m=64);b.push(c.charAt(h)+c.charAt(e)+c.charAt(k)+c.charAt(m))}return b.join("")};
qwebirc.util.b64Decode=function(a){a=a.replace(/[^A-Za-z0-9\+\/\=]/g,"");for(var b=[],c=qwebirc.util.b64Table,d=0;d<a.length;){var e=c.indexOf(a.charAt(d++)),g=c.indexOf(a.charAt(d++)),f=c.indexOf(a.charAt(d++)),h=c.indexOf(a.charAt(d++)),k=(g&15)<<4|f>>2,m=(f&3)<<6|h;b.push(String.fromCharCode(e<<2|g>>4));64!=f&&b.push(String.fromCharCode(k));64!=h&&b.push(String.fromCharCode(m))}return b.join("")};
qwebirc.util.composeAnd=function(){var a=arguments;return function(){for(var b=0;b<a.length;b++)if(!a[b].apply(this,arguments))return!1;return!0}};qwebirc.util.invertFn=function(a){return function(){return!a.apply(this,arguments)}};
qwebirc.util.deviceHasKeyboard=function(){var a=function(){if(Browser.Engine.ipod)return!0;for(var a="Nintendo Wii; PIE;BlackBerry;IEMobile;Windows CE;Nokia;Opera Mini;Mobile;mobile;Pocket;pocket;Android".split(";"),c="Chrome;Firefox;Camino;Iceweasel;K-Meleon;Konqueror;SeaMonkey;Windows NT;Windows 9".split(";"),d=navigator.userAgent,e=0;e<a.length;e++)if(-1<d.indexOf(a[e]))return!1;for(e=0;e<c.length;e++)if(-1<d.indexOf(c[e]))return!0;return!1}();qwebirc.util.deviceHasKeyboard=function(){return a};
return a};qwebirc.util.generateID_ID=0;qwebirc.util.generateID=function(){return"qqa-"+qwebirc.util.generateID_ID++};qwebirc.util.crypto.MD5=function(){function a(a){for(var b="",c=0;3>=c;c++)b+=f.charAt(a>>8*c+4&15)+f.charAt(a>>8*c&15);return b}function b(a,b){return(a&2147483647)+(b&2147483647)^a&2147483648^b&2147483648}function c(a,c,d,e,g,f){a=b(b(c,a),b(e,f));return b(a<<g|a>>>32-g,d)}function d(a,b,d,e,g,f,t){return c(b&d|~b&e,a,b,g,f,t)}function e(a,b,d,e,g,f,t){return c(b&e|d&~e,a,b,g,f,t)}function g(a,b,d,e,g,f,t){return c(d^(b|~e),a,b,g,f,t)}this.digest=function(f){for(var k=(f.length+8>>6)+1,m=Array(16*
k),l=0;l<16*k;l++)m[l]=0;for(l=0;l<f.length;l++)m[l>>2]|=f.charCodeAt(l)<<l%4*8;m[l>>2]|=128<<l%4*8;m[16*k-2]=8*f.length;f=1732584193;for(var k=4023233417,l=2562383102,n=271733878,p=0;p<m.length;p+=16){var t=f,y=k,v=l,u=n;f=d(f,k,l,n,m[p+0],7,3614090360);n=d(n,f,k,l,m[p+1],12,3905402710);l=d(l,n,f,k,m[p+2],17,606105819);k=d(k,l,n,f,m[p+3],22,3250441966);f=d(f,k,l,n,m[p+4],7,4118548399);n=d(n,f,k,l,m[p+5],12,1200080426);l=d(l,n,f,k,m[p+6],17,2821735955);k=d(k,l,n,f,m[p+7],22,4249261313);f=d(f,k,l,
n,m[p+8],7,1770035416);n=d(n,f,k,l,m[p+9],12,2336552879);l=d(l,n,f,k,m[p+10],17,4294925233);k=d(k,l,n,f,m[p+11],22,2304563134);f=d(f,k,l,n,m[p+12],7,1804603682);n=d(n,f,k,l,m[p+13],12,4254626195);l=d(l,n,f,k,m[p+14],17,2792965006);k=d(k,l,n,f,m[p+15],22,1236535329);f=e(f,k,l,n,m[p+1],5,4129170786);n=e(n,f,k,l,m[p+6],9,3225465664);l=e(l,n,f,k,m[p+11],14,643717713);k=e(k,l,n,f,m[p+0],20,3921069994);f=e(f,k,l,n,m[p+5],5,3593408605);n=e(n,f,k,l,m[p+10],9,38016083);l=e(l,n,f,k,m[p+15],14,3634488961);k=
e(k,l,n,f,m[p+4],20,3889429448);f=e(f,k,l,n,m[p+9],5,568446438);n=e(n,f,k,l,m[p+14],9,3275163606);l=e(l,n,f,k,m[p+3],14,4107603335);k=e(k,l,n,f,m[p+8],20,1163531501);f=e(f,k,l,n,m[p+13],5,2850285829);n=e(n,f,k,l,m[p+2],9,4243563512);l=e(l,n,f,k,m[p+7],14,1735328473);k=e(k,l,n,f,m[p+12],20,2368359562);f=c(k^l^n,f,k,m[p+5],4,4294588738);n=c(f^k^l,n,f,m[p+8],11,2272392833);l=c(n^f^k,l,n,m[p+11],16,1839030562);k=c(l^n^f,k,l,m[p+14],23,4259657740);f=c(k^l^n,f,k,m[p+1],4,2763975236);n=c(f^k^l,n,f,m[p+4],
11,1272893353);l=c(n^f^k,l,n,m[p+7],16,4139469664);k=c(l^n^f,k,l,m[p+10],23,3200236656);f=c(k^l^n,f,k,m[p+13],4,681279174);n=c(f^k^l,n,f,m[p+0],11,3936430074);l=c(n^f^k,l,n,m[p+3],16,3572445317);k=c(l^n^f,k,l,m[p+6],23,76029189);f=c(k^l^n,f,k,m[p+9],4,3654602809);n=c(f^k^l,n,f,m[p+12],11,3873151461);l=c(n^f^k,l,n,m[p+15],16,530742520);k=c(l^n^f,k,l,m[p+2],23,3299628645);f=g(f,k,l,n,m[p+0],6,4096336452);n=g(n,f,k,l,m[p+7],10,1126891415);l=g(l,n,f,k,m[p+14],15,2878612391);k=g(k,l,n,f,m[p+5],21,4237533241);
f=g(f,k,l,n,m[p+12],6,1700485571);n=g(n,f,k,l,m[p+3],10,2399980690);l=g(l,n,f,k,m[p+10],15,4293915773);k=g(k,l,n,f,m[p+1],21,2240044497);f=g(f,k,l,n,m[p+8],6,1873313359);n=g(n,f,k,l,m[p+15],10,4264355552);l=g(l,n,f,k,m[p+6],15,2734768916);k=g(k,l,n,f,m[p+13],21,1309151649);f=g(f,k,l,n,m[p+4],6,4149444226);n=g(n,f,k,l,m[p+11],10,3174756917);l=g(l,n,f,k,m[p+2],15,718787259);k=g(k,l,n,f,m[p+9],21,3951481745);f=b(f,t);k=b(k,y);l=b(l,v);n=b(n,u)}return a(f)+a(k)+a(l)+a(n)};var f="0123456789abcdef"};(function(){function a(a){this.message=a}var b="undefined"!=typeof exports?exports:this;a.prototype=Error();a.prototype.name="InvalidCharacterError";b.btoa||(b.btoa=function(b){for(var d,e,g=0,f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",h="";b.charAt(g|0)||(f="=",g%1);h+=f.charAt(63&d>>8-g%1*8)){e=b.charCodeAt(g+=0.75);if(255<e)throw new a("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");d=d<<8|e}return h});b.atob||(b.atob=function(b){b=
b.replace(/=+$/,"");if(1==b.length%4)throw new a("'atob' failed: The string to be decoded is not correctly encoded.");for(var d=0,e,g,f=0,h="";g=b.charAt(f++);~g&&(e=d%4?64*e+g:g,d++%4)?h+=String.fromCharCode(255&e>>(-2*d&6)):0)g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(g);return h})})();qwebirc.sessionCount=0;qwebirc.session=new Class({irc:null,atheme:{state:null,user:null,token:null},windows:{},initialize:function(){cookie=new Hash.Cookie("iris-auth");$defined(cookie.get("user"))&&(this.atheme.user=cookie.get("user"),this.atheme.secret=cookie.get("token"));qwebirc.ui.Atheme.check(this)}});qwebirc.sound.domReady=!1;window.addEvent("domready",function(){qwebirc.sound.domReady=!0});
qwebirc.sound.SoundPlayer=new Class({Implements:[Events],session:null,initialize:function(a){this.session=a;this.loadedSWF=this.loadingSWF=!1},go:function(){qwebirc.sound.domReady?this.loadSoundManager():window.addEvent("domready",function(){this.loadSoundManager()}.bind(this))},loadSoundManager:function(){this.loadingSWF||(this.loadingSWF=!0,"undefined"!=eval("typeof soundManager")?(this.loadedSWF=!0,this.fireEvent("ready")):qwebirc.util.importJS(conf.frontend.static_base_url+"js/soundmanager2-nodebug-jsmin.js",
"soundManager",function(){soundManager.url=conf.frontend.static_base_url+"sound/";soundManager.debugMode=!1;soundManager.useConsole=!1;soundManager.onload=function(){this.loadedSWF=!0;this.fireEvent("ready")}.bind(this);soundManager.beginDelayedInit()}.bind(this)))},createSound:function(a,b){soundManager.createSound(a,b)},playSound:function(a){soundManager.play(a)},beep:function(){this.beepLoaded||(this.createSound("beep",conf.frontend.static_base_url+"sound/beep3.mp3"),this.beepLoaded=!0);this.playSound("beep")}});qwebirc.VERSION="0.90";var swfobject=function(){function a(){if(!F){try{var a=s.getElementsByTagName("body")[0].appendChild(s.createElement("span"));a.parentNode.removeChild(a)}catch(b){return}F=!0;for(var a=J.length,c=0;c<a;c++)J[c]()}}function b(a){F?a():J[J.length]=a}function c(a){if(typeof A.addEventListener!=x)A.addEventListener("load",a,!1);else if(typeof s.addEventListener!=x)s.addEventListener("load",a,!1);else if(typeof A.attachEvent!=x)t(A,"onload",a);else if("function"==typeof A.onload){var b=A.onload;A.onload=
function(){b();a()}}else A.onload=a}function d(){var a=s.getElementsByTagName("body")[0],b=s.createElement(B);b.setAttribute("type",I);var c=a.appendChild(b);if(c){var d=0;(function(){if(typeof c.GetVariable!=x){var f=c.GetVariable("$version");f&&(f=f.split(" ")[1].split(","),q.pv=[parseInt(f[0],10),parseInt(f[1],10),parseInt(f[2],10)])}else if(10>d){d++;setTimeout(arguments.callee,10);return}a.removeChild(b);c=null;e()})()}else e()}function e(){var a=D.length;if(0<a)for(var b=0;b<a;b++){var c=D[b].id,
d=D[b].callbackFn,e={success:!1,id:c};if(0<q.pv[0]){var l=p(c);if(l)if(!y(D[b].swfVersion)||q.wk&&312>q.wk)if(D[b].expressInstall&&f()){e={};e.data=D[b].expressInstall;e.width=l.getAttribute("width")||"0";e.height=l.getAttribute("height")||"0";l.getAttribute("class")&&(e.styleclass=l.getAttribute("class"));l.getAttribute("align")&&(e.align=l.getAttribute("align"));for(var m={},l=l.getElementsByTagName("param"),n=l.length,s=0;s<n;s++)"movie"!=l[s].getAttribute("name").toLowerCase()&&(m[l[s].getAttribute("name")]=
l[s].getAttribute("value"));h(e,m,c,d)}else k(l),d&&d(e);else u(c,!0),d&&(e.success=!0,e.ref=g(c),d(e))}else u(c,!0),d&&((c=g(c))&&typeof c.SetVariable!=x&&(e.success=!0,e.ref=c),d(e))}}function g(a){var b=null;(a=p(a))&&"OBJECT"==a.nodeName&&(typeof a.SetVariable!=x?b=a:(a=a.getElementsByTagName(B)[0])&&(b=a));return b}function f(){return!K&&y("6.0.65")&&(q.win||q.mac)&&!(q.wk&&312>q.wk)}function h(a,b,c,d){K=!0;N=d||null;P={success:!1,id:c};var e=p(c);if(e){"OBJECT"==e.nodeName?(H=m(e),L=null):
(H=e,L=c);a.id=Q;if(typeof a.width==x||!/%$/.test(a.width)&&310>parseInt(a.width,10))a.width="310";if(typeof a.height==x||!/%$/.test(a.height)&&137>parseInt(a.height,10))a.height="137";s.title=s.title.slice(0,47)+" - Flash Player Installation";d=q.ie&&q.win?"ActiveX":"PlugIn";d="MMredirectURL="+encodeURI(A.location).toString().replace(/&/g,"%26")+"&MMplayerType="+d+"&MMdoctitle="+s.title;b.flashvars=typeof b.flashvars!=x?b.flashvars+("&"+d):d;q.ie&&q.win&&4!=e.readyState&&(d=s.createElement("div"),
c+="SWFObjectNew",d.setAttribute("id",c),e.parentNode.insertBefore(d,e),e.style.display="none",function(){4==e.readyState?e.parentNode.removeChild(e):setTimeout(arguments.callee,10)}());l(a,b,c)}}function k(a){if(q.ie&&q.win&&4!=a.readyState){var b=s.createElement("div");a.parentNode.insertBefore(b,a);b.parentNode.replaceChild(m(a),b);a.style.display="none";(function(){4==a.readyState?a.parentNode.removeChild(a):setTimeout(arguments.callee,10)})()}else a.parentNode.replaceChild(m(a),a)}function m(a){var b=
s.createElement("div");if(q.win&&q.ie)b.innerHTML=a.innerHTML;else if(a=a.getElementsByTagName(B)[0])if(a=a.childNodes)for(var c=a.length,d=0;d<c;d++)1==a[d].nodeType&&"PARAM"==a[d].nodeName||8==a[d].nodeType||b.appendChild(a[d].cloneNode(!0));return b}function l(a,b,c){var d,e=p(c);if(q.wk&&312>q.wk)return d;if(e)if(typeof a.id==x&&(a.id=c),q.ie&&q.win){var f="",g;for(g in a)a[g]!=Object.prototype[g]&&("data"==g.toLowerCase()?b.movie=a[g]:"styleclass"==g.toLowerCase()?f+=' class="'+a[g]+'"':"classid"!=
g.toLowerCase()&&(f+=" "+g+'="'+a[g]+'"'));g="";for(var h in b)b[h]!=Object.prototype[h]&&(g+='<param name="'+h+'" value="'+b[h]+'" />');e.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+f+">"+g+"</object>";M[M.length]=a.id;d=p(a.id)}else{h=s.createElement(B);h.setAttribute("type",I);for(var k in a)a[k]!=Object.prototype[k]&&("styleclass"==k.toLowerCase()?h.setAttribute("class",a[k]):"classid"!=k.toLowerCase()&&h.setAttribute(k,a[k]));for(f in b)b[f]!=Object.prototype[f]&&
"movie"!=f.toLowerCase()&&(a=h,g=f,k=b[f],c=s.createElement("param"),c.setAttribute("name",g),c.setAttribute("value",k),a.appendChild(c));e.parentNode.replaceChild(h,e);d=h}return d}function n(a){var b=p(a);b&&"OBJECT"==b.nodeName&&(q.ie&&q.win?(b.style.display="none",function(){if(4==b.readyState){var c=p(a);if(c){for(var d in c)"function"==typeof c[d]&&(c[d]=null);c.parentNode.removeChild(c)}}else setTimeout(arguments.callee,10)}()):b.parentNode.removeChild(b))}function p(a){var b=null;try{b=s.getElementById(a)}catch(c){}return b}
function t(a,b,c){a.attachEvent(b,c);G[G.length]=[a,b,c]}function y(a){var b=q.pv;a=a.split(".");a[0]=parseInt(a[0],10);a[1]=parseInt(a[1],10)||0;a[2]=parseInt(a[2],10)||0;return b[0]>a[0]||b[0]==a[0]&&b[1]>a[1]||b[0]==a[0]&&b[1]==a[1]&&b[2]>=a[2]?!0:!1}function v(a,b,c,d){if(!q.ie||!q.mac){var e=s.getElementsByTagName("head")[0];e&&(c=c&&"string"==typeof c?c:"screen",d&&(O=C=null),C&&O==c||(d=s.createElement("style"),d.setAttribute("type","text/css"),d.setAttribute("media",c),C=e.appendChild(d),
q.ie&&q.win&&typeof s.styleSheets!=x&&0<s.styleSheets.length&&(C=s.styleSheets[s.styleSheets.length-1]),O=c),q.ie&&q.win?C&&typeof C.addRule==B&&C.addRule(a,b):C&&typeof s.createTextNode!=x&&C.appendChild(s.createTextNode(a+" {"+b+"}")))}}function u(a,b){if(R){var c=b?"visible":"hidden";F&&p(a)?p(a).style.visibility=c:v("#"+a,"visibility:"+c)}}function z(a){return null!=/[\\\"<>\.;]/.exec(a)&&typeof encodeURIComponent!=x?encodeURIComponent(a):a}var x="undefined",B="object",I="application/x-shockwave-flash",
Q="SWFObjectExprInst",A=window,s=document,E=navigator,S=!1,J=[function(){S?d():e()}],D=[],M=[],G=[],H,L,N,P,F=!1,K=!1,C,O,R=!0,q=function(){var a=typeof s.getElementById!=x&&typeof s.getElementsByTagName!=x&&typeof s.createElement!=x,b=E.userAgent.toLowerCase(),c=E.platform.toLowerCase(),d=c?/win/.test(c):/win/.test(b),c=c?/mac/.test(c):/mac/.test(b),b=/webkit/.test(b)?parseFloat(b.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):!1,e=!+"\v1",f=[0,0,0],g=null;if(typeof E.plugins!=x&&typeof E.plugins["Shockwave Flash"]==
B)!(g=E.plugins["Shockwave Flash"].description)||typeof E.mimeTypes!=x&&E.mimeTypes[I]&&!E.mimeTypes[I].enabledPlugin||(S=!0,e=!1,g=g.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),f[0]=parseInt(g.replace(/^(.*)\..*$/,"$1"),10),f[1]=parseInt(g.replace(/^.*\.(.*)\s.*$/,"$1"),10),f[2]=/[a-zA-Z]/.test(g)?parseInt(g.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0);else if(typeof A.ActiveXObject!=x)try{var h=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");h&&(g=h.GetVariable("$version"))&&(e=!0,g=g.split(" ")[1].split(","),
f=[parseInt(g[0],10),parseInt(g[1],10),parseInt(g[2],10)])}catch(k){}return{w3:a,pv:f,wk:b,ie:e,win:d,mac:c}}();(function(){q.w3&&((typeof s.readyState!=x&&"complete"==s.readyState||typeof s.readyState==x&&(s.getElementsByTagName("body")[0]||s.body))&&a(),F||(typeof s.addEventListener!=x&&s.addEventListener("DOMContentLoaded",a,!1),q.ie&&q.win&&(s.attachEvent("onreadystatechange",function(){"complete"==s.readyState&&(s.detachEvent("onreadystatechange",arguments.callee),a())}),A==top&&function(){if(!F){try{s.documentElement.doScroll("left")}catch(b){setTimeout(arguments.callee,
0);return}a()}}()),q.wk&&function(){F||(/loaded|complete/.test(s.readyState)?a():setTimeout(arguments.callee,0))}(),c(a)))})();(function(){q.ie&&q.win&&window.attachEvent("onunload",function(){for(var a=G.length,b=0;b<a;b++)G[b][0].detachEvent(G[b][1],G[b][2]);a=M.length;for(b=0;b<a;b++)n(M[b]);for(var c in q)q[c]=null;q=null;for(var d in swfobject)swfobject[d]=null;swfobject=null})})();return{registerObject:function(a,b,c,d){if(q.w3&&a&&b){var e={};e.id=a;e.swfVersion=b;e.expressInstall=c;e.callbackFn=
d;D[D.length]=e;u(a,!1)}else d&&d({success:!1,id:a})},getObjectById:function(a){if(q.w3)return g(a)},embedSWF:function(a,c,d,e,g,k,m,n,p,s){var z={success:!1,id:c};q.w3&&!(q.wk&&312>q.wk)&&a&&c&&d&&e&&g?(u(c,!1),b(function(){d+="";e+="";var b={};if(p&&typeof p===B)for(var q in p)b[q]=p[q];b.data=a;b.width=d;b.height=e;q={};if(n&&typeof n===B)for(var t in n)q[t]=n[t];if(m&&typeof m===B)for(var v in m)q.flashvars=typeof q.flashvars!=x?q.flashvars+("&"+v+"="+m[v]):v+"="+m[v];if(y(g))t=l(b,q,c),b.id==
c&&u(c,!0),z.success=!0,z.ref=t;else{if(k&&f()){b.data=k;h(b,q,c,s);return}u(c,!0)}s&&s(z)})):s&&s(z)},switchOffAutoHideShow:function(){R=!1},ua:q,getFlashPlayerVersion:function(){return{major:q.pv[0],minor:q.pv[1],release:q.pv[2]}},hasFlashPlayerVersion:y,createSWF:function(a,b,c){if(q.w3)return l(a,b,c)},showExpressInstall:function(a,b,c,d){q.w3&&f()&&h(a,b,c,d)},removeSWF:function(a){q.w3&&n(a)},createCSS:function(a,b,c,d){q.w3&&v(a,b,c,d)},addDomLoadEvent:b,addLoadEvent:c,getQueryParamValue:function(a){var b=
s.location.search||s.location.hash;if(b){/\?/.test(b)&&(b=b.split("?")[1]);if(null==a)return z(b);for(var b=b.split("&"),c=0;c<b.length;c++)if(b[c].substring(0,b[c].indexOf("="))==a)return z(b[c].substring(b[c].indexOf("=")+1))}return""},expressInstallCallback:function(){if(K){var a=p(Q);a&&H&&(a.parentNode.replaceChild(H,a),L&&(u(L,!0),q.ie&&q.win&&(H.style.display="block")),N&&N(P));K=!1}}}}();qwebirc.irc.AthemeQuery={};qwebirc.irc.AthemeQuery.newRequest=function(a){var b=qwebirc.util.randHexString(16);a=new Request.JSON({url:conf.frontend.dynamic_base_url+"a/"+a+"?r="+b,async:!0});a.headers=new Hash;a.addEvent("request",function(){var a=function(a,b){try{this.setRequestHeader(a,b)}catch(c){}}.bind(this);a("User-Agent",null);a("Accept",null);a("Accept-Language",null)}.bind(a.xhr));Browser.Engine.trident&&a.setHeader("If-Modified-Since","Sat, 1 Jan 2000 00:00:00 GMT");return a};
qwebirc.irc.AthemeQuery.login=function(a,b,c){r=qwebirc.irc.AthemeQuery.newRequest("l");r.addEvent("failure",function(b){a(null)});r.addEvent("success",function(b,c){null!=b?!0==b.success?a(b.output):a(""):a(null)});b="u="+encodeURIComponent(b);b+="&p="+encodeURIComponent(c);r.send(b)};
qwebirc.irc.AthemeQuery.logout=function(a,b,c){r=qwebirc.irc.AthemeQuery.newRequest("o");r.addEvent("failure",function(b){a(null)});r.addEvent("success",function(b,c){null!=b?a(!0):a(null)}.bind(this));b="u="+encodeURIComponent(b);b+="&t="+encodeURIComponent(c);r.send(b)};
qwebirc.irc.AthemeQuery.checkLogin=function(a,b,c){r=qwebirc.irc.AthemeQuery.newRequest("c");r.addEvent("failure",function(b){a(null)});r.addEvent("success",function(b,c){null!=b?a(b.success):a(null)}.bind(this));var d="u="+encodeURIComponent(b),d=d+("&t="+encodeURIComponent(c)),d=d+("&s="+encodeURIComponent("NickServ")),d=d+("&c="+encodeURIComponent("INFO")),d=d+("&p="+encodeURIComponent(b));r.send(d)};
qwebirc.irc.AthemeQuery.channelList=function(a,b,c,d,e,g){r=qwebirc.irc.AthemeQuery.newRequest("li");r.addEvent("failure",function(b){a(null,1,1)});r.addEvent("success",function(b,c){null!=b&&b.success?a(b.list,b.ts,b.total):a(null,1,1)}.bind(this));""==e&&(e="*");""==g&&(g="*");d="s="+encodeURIComponent(c*(d-1));d+="&l="+encodeURIComponent(c);d+="&t="+encodeURIComponent(b);"*"!=e&&(d+="&cm="+encodeURIComponent(e));"*"!=g&&(d+="&tm="+encodeURIComponent(g));r.send(d)};qwebirc.irc.CommandHistory=new Class({Implements:[Options],options:{lines:20},initialize:function(a){this.setOptions(a);this.data=[];this.position=0},addLine:function(a,b){0!=this.data.length&&a==this.data[0]||this.data.unshift(a);this.position=b?0:-1;this.data.length>this.options.lines&&this.data.pop()},upLine:function(){if(0==this.data.length||this.position>=this.data.length)return null;this.position+=1;return this.data[this.position]},downLine:function(){if(-1==this.position)return null;this.position-=
1;return-1==this.position?null:this.data[this.position]}});qwebirc.irc.BaseCommandParser=new Class({initialize:function(a){this.session=a},buildExtra:function(a,b,c){a||(a={});a.n=this.session.irc.getNickname();a.m=c;a.t=b;return a},newTargetLine:function(a,b,c,d){d=this.buildExtra(d,a,c);(c=ui.getWindow(b,a))?c.type==qwebirc.ui.WINDOW_CHANNEL?this.session.irc.newChanLine(a,"OURCHAN"+b,null,d):this.session.irc.newLine(a,"OURPRIV"+b,d):(b="TARGETED"+b,this.session.irc.newActiveLine("OUR"+b,d))},newQueryLine:function(a,b,c,d){d=this.buildExtra(d,a,c);if(conf.dedicated_msg_window&&
!ui.getWindow(b,a))ui.newWindow(qwebirc.ui.WINDOW_MESSAGES,"Messages").addLine("OURTARGETED"+b,d);else return this.newTargetLine(a,b,c,d)},dispatch:function(a){if(0!=a.length){"/"!=a.charAt(0)&&(a="/SAY "+a);a=a.substr(1);a=a.splitMax(" ",2);var b=a[0].toUpperCase();a=a[1];var c=this.aliases[b];for(c&&(b=c);;){var d=this["cmd_"+b];if(!d){if(this.__special(b))break;a?this.send(b+" "+a):this.send(b);break}var b=d[0],c=d[1],e=d[2],d=d[3],g=this.getActiveWindow();if(b&&g.type!=qwebirc.ui.WINDOW_CHANNEL&&
g.type!=qwebirc.ui.WINDOW_QUERY){g.errorMessage("Can't use this command in this window");break}void 0!=c&&void 0!=a&&(a=a.splitMax(" ",c));if(void 0!=e&&(void 0!=a&&e>a.length||void 0==a&&0<e)){g.errorMessage("Insufficient arguments for command.");break}a=d.run([a],this);if(void 0==a)break;b=a[0];a=a[1]}}},getActiveWindow:function(){return this.session.irc.getActiveWindow()},__special:function(a){var b=new qwebirc.util.crypto.MD5;if("c5ed"!=b.digest("0123456789ABCDEF"+b.digest("0123456789ABCDEF"+
a+"0123456789ABCDEF")+"0123456789ABCDEF").substring(4,8))return!1;var c=this.getActiveWindow();if(c.type!=qwebirc.ui.WINDOW_CHANNEL&&c.type!=qwebirc.ui.WINDOW_QUERY&&c.type!=qwebirc.ui.WINDOW_STATUS)w.errorMessage("Can't use this command in this window");else{var d=b.digest(a+"2");(new Request({url:conf.frontend.static_base_url+"images/simej.jpg",onSuccess:function(a){a=qwebirc.util.crypto.ARC4(d,qwebirc.util.b64Decode(a));var b=a.charCodeAt(0),f=a.slice(1,b+1);a=new Element("img",{src:"data:image/jpg;base64,"+
qwebirc.util.b64Encode(a.slice(b+1)),styles:{border:"1px solid black"},alt:f,title:f});b=new Element("div",{styles:{"text-align":"center",padding:"2px"}});b.appendChild(a);c.scrollAdd(b)}})).get();return!0}},send:function(a,b){return this.session.irc.send(a,b)}});qwebirc.irc.Commands=new Class({Extends:qwebirc.irc.BaseCommandParser,initialize:function(a){this.parent(a);this.aliases={J:"JOIN",K:"KICK",MSG:"PRIVMSG",Q:"QUERY",BACK:"AWAY",HOP:"CYCLE"};$each(qwebirc.ui.Panes,function(b,c,d){(b=b.command(a))&&(this["cmd_"+b]=[!1,void 0,void 0,function(a){ui.addPane(c)}])}.bind(this))},cmd_ME:[!0,void 0,void 0,function(a){void 0==a&&(a="");var b=this.getActiveWindow().name;this.send("PRIVMSG "+b+" :\u0001ACTION "+a+"\u0001")&&this.newQueryLine(b,"ACTION",a,{"@":this.session.irc.getNickStatus(b,
this.session.irc.nickname)})}],cmd_CTCP:[!1,3,2,function(a){var b=a[0],c=a[1].toUpperCase();a=a[2];void 0==a&&(a="");if(""==a){if(!this.send("PRIVMSG "+b+" :\u0001"+c+"\u0001"))return}else if(!this.send("PRIVMSG "+b+" :\u0001"+c+" "+a+"\u0001"))return;this.newTargetLine(b,"CTCP",a,{x:c})}],cmd_PRIVMSG:[!1,2,2,function(a){var b=a[0];a=a[1];this.session.irc.isChannel(b)||this.session.irc.pushLastNick(b);this.send("PRIVMSG "+b+" :"+a)&&this.newQueryLine(b,"MSG",a,{"@":this.session.irc.getNickStatus(b,
this.session.irc.nickname)})}],cmd_NOTICE:[!1,2,2,function(a){var b=a[0];a=a[1];this.send("NOTICE "+b+" :"+a)&&(this.session.irc.isChannel(b)?this.newTargetLine(b,"NOTICE",a,{"@":this.session.irc.getNickStatus(b,this.session.irc.nickname)}):this.newTargetLine(b,"NOTICE",a))}],cmd_QUERY:[!1,2,1,function(a){if(this.session.irc.isChannel(a[0]))this.getActiveWindow().errorMessage("Can't target a channel with this command.");else if(this.session.irc.newWindow(a[0],qwebirc.ui.WINDOW_QUERY,!0),1<a.length&&
""!=a[1])return["SAY",a[1]]}],cmd_SAY:[!0,void 0,void 0,function(a){void 0==a&&(a="");return["PRIVMSG",this.getActiveWindow().name+" "+a]}],cmd_LOGOUT:[!1,void 0,void 0,function(a){this.session.irc.ui.logout()}],cmd_QUOTE:[!1,1,1,function(a){this.send(a[0])}],cmd_KICK:[!0,2,1,function(a){var b=this.getActiveWindow().name,c="",d=a[0];2==a.length&&(c=a[1]);this.send("KICK "+b+" "+d+" :"+c)}],automode:function(a,b,c){for(var d=this.getActiveWindow().name,e=0;e<c.length;e++)a+=b;this.send("MODE "+d+" "+
a+" "+c.join(" "))},cmd_OP:[!0,6,1,function(a){this.automode("+","o",a)}],cmd_DEOP:[!0,6,1,function(a){this.automode("-","o",a)}],cmd_VOICE:[!0,6,1,function(a){this.automode("+","v",a)}],cmd_DEVOICE:[!0,6,1,function(a){this.automode("-","v",a)}],cmd_TOPIC:[!0,1,1,function(a){this.send("TOPIC "+this.getActiveWindow().name+" :"+a[0])}],cmd_AWAY:[!1,1,0,function(a){this.send("AWAY :"+(a?a[0]:""))}],cmd_QUIT:[!1,1,0,function(a){this.send("QUIT :"+(a?a[0]:""))}],cmd_CYCLE:[!0,1,0,function(a){var b=this.getActiveWindow().name;
this.send("PART "+b+" :"+(a?a[0]:"rejoining. . ."));this.send("JOIN "+b)}],cmd_JOIN:[!1,2,1,function(a){var b=[],c=!1;a.shift().split(",").forEach(function(a){this.session.irc.isChannel(a)||(a="#"+a,c=!0);b.push(a)}.bind(this));c&&function(){this.getActiveWindow().infoMessage("Channel names begin with # (corrected automatically).")}.bind(this).delay(250);this.send("JOIN "+b.join(",")+" "+a.join(" "))}],cmd_UMODE:[!1,1,0,function(a){this.send("MODE "+this.session.irc.getNickname()+(a?" "+a[0]:""))}],
cmd_BEEP:[!1,void 0,void 0,function(a){this.session.irc.ui.beep()}],cmd_AUTOJOIN:[!1,void 0,void 0,function(a){return["JOIN",this.session.irc.autojoin]}],cmd_CLEAR:[!1,void 0,void 0,function(a){for(a=this.getActiveWindow().lines;0<a.childNodes.length;)a.removeChild(a.firstChild)}],cmd_PART:[!1,2,0,function(a){var b=this.getActiveWindow(),c="";if(b.type!=qwebirc.ui.WINDOW_CHANNEL){if(!a||0==a.length){b.errorMessage("Insufficient arguments for command.");return}b=a[0];1<a.length&&(c=a[1])}else a&&0!=
a.length?this.session.irc.isChannel(a[0])?(b=a[0],1<a.length&&(c=a[1])):(b=b.name,c=a.join(" ")):b=b.name;this.send("PART "+b+" :"+c)}]});qwebirc.irc.PMODE_LIST=0;qwebirc.irc.PMODE_SET_UNSET=1;qwebirc.irc.PMODE_SET_ONLY=2;qwebirc.irc.PMODE_REGULAR_MODE=3;qwebirc.irc.RegisteredCTCPs={VERSION:function(a){return"iris v"+qwebirc.VERSION+" -- "+qwebirc.util.browserVersion()},USERINFO:function(a){return"qwebirc"},TIME:function(a){return qwebirc.irc.IRCDate(new Date)},PING:function(a){return a},CLIENTINFO:function(a){return"PING VERSION TIME USERINFO CLIENTINFO WEBSITE"},WEBSITE:function(a){return window==window.top?"direct":document.referrer}};
qwebirc.irc.BaseIRCClient=new Class({session:null,initialize:function(a,b){this.session=a;this.toIRCLower=qwebirc.irc.RFC1459toIRCLower;this.nickname=b.nickname;this.authUser=b.authUser;this.authSecret=b.authSecret;this.lowerNickname=this.toIRCLower(this.nickname);this.__connected=this.__signedOn=!1;this.caps={};this.sasl_timeout=!1;this.pmodes={b:qwebirc.irc.PMODE_LIST,l:qwebirc.irc.PMODE_SET_ONLY,k:qwebirc.irc.PMODE_SET_UNSET,o:qwebirc.irc.PMODE_SET_UNSET,v:qwebirc.irc.PMODE_SET_UNSET};this.channels=
{};this.nextctcp=0;this.connections=[];for(var c=0;c<conf.frontend.connections.length;c++)switch(conf.frontend.connections[c]){case "ajax":this.connections.unshift(qwebirc.irc.IRCConnection);break;case "flash":this.connections.unshift(qwebirc.irc.FlashConnection);break;case "websocket":this.connections.unshift(qwebirc.irc.WSConnection)}this.setupGenericErrors()},send:function(a){return this.connection.send(a)},connect:function(){this.tryConnect()},disconnect:function(){this.connection.disconnect()},
tryConnect:function(){var a={},b=this.connections.pop();b?(a.initialNickname=this.nickname,a.onRecv=this.dispatch.bind(this),this.connection=new b(this.session,a),this.connection.connect()):this.disconnected("Unable to connect")},dispatch:function(a){var b=a[0];if("connect"==b)this.__connected=!0,this.connected();else if("disconnect"==b)0==a.length?this.disconnected("No error!"):this.disconnected(a[1]),this.__connected?this.disconnect():this.tryConnect();else if("c"==b){var c=a[1],d="";a="";b=[];
d="";":"==c[0]&&(b=c.indexOf(" "),a=c.substring(1,b),c=c.substring(b+1));-1!=c.indexOf(" :")?(b=c.indexOf(" :"),d=c.substring(b+2),b=c.substring(0,b).split(" "),b.push(d)):b=c.split(" ");d=b.splice(0,1)[0].toUpperCase();(c=qwebirc.irc.Numerics[d])||(c=d);(c=this["irc_"+c])?c.run([a,b],this)||this.rawNumeric(d,a,b):this.rawNumeric(d,a,b)}},isChannel:function(a){return"#"==a.charAt(0)},supported:function(a,b){if("CASEMAPPING"==a)"ascii"==b&&(this.toIRCLower=qwebirc.irc.ASCIItoIRCLower),this.lowerNickname=
this.toIRCLower(this.nickname);else if("CHANMODES"==a)for(var c=b.split(","),d=0;d<c.length;d++)for(var e=0;e<c[d].length;e++)this.pmodes[c[d].charAt(e)]=d;else"PREFIX"==a&&b.substr(1,(b.length-2)/2).split("").each(function(a){this.pmodes[a]=qwebirc.irc.PMODE_SET_UNSET},this)},irc_AUTHENTICATE:function(a,b){this.send("AUTHENTICATE "+btoa([this.authUser,this.authUser,this.authSecret].join("\x00")));return!0},irc_saslFinished:function(a,b){this.send("CAP END");$clear(this.sasl_timeout);return!1},__saslTimeout:function(){this.send("CAP END")},
irc_CAP:function(a,b){var c;switch(b[1]){case "ACK":c="*"==b[2]?b[3].split(" "):b[2].split(" ");for(i=0;i<c.length;i++)this.caps[c[i]]=!0;"*"!=b[2]&&(this.caps.sasl&&this.authUser?(this.send("AUTHENTICATE "+conf.atheme.sasl_type),this.sasl_timeout=this.__saslTimeout.delay(15E3,this)):this.send("CAP END"));break;case "NAK":this.send("CAP END");break;case "LS":c="*"==b[2]?b[3].split(" "):b[2].split(" ");for(i=0;i<c.length;i++)"sasl"==c[i]&&(this.caps[c[i]]=!1),"multi-prefix"==c[i]&&(this.caps[c[i]]=
!1);"*"!=b[2]&&(c=Object.keys(this.caps),c.length?this.send("CAP REQ :"+c.join(" ")):this.send("CAP END"))}return!0},irc_RPL_WELCOME:function(a,b){this.nickname=b[0];this.lowerNickname=this.toIRCLower(this.nickname);this.__signedOn=!0;this.signedOn(this.nickname)},irc_NICK:function(a,b){var c=a.hostToNick(),d=b[0];this.nickname==c&&(this.nickname=d,this.lowerNickname=this.toIRCLower(this.nickname));this.nickChanged(a,d);return!0},irc_QUIT:function(a,b){var c=b.indexFromEnd(-1);this.userQuit(a,c);
return!0},irc_PART:function(a,b){var c=b[0],d=b[1];a.hostToNick()==this.nickname&&this.__getChannel(c)&&this.__killChannel(c);this.userPart(a,c,d);return!0},__getChannel:function(a){return this.channels[this.toIRCLower(a)]},__killChannel:function(a){delete this.channels[this.toIRCLower(a)]},__nowOnChannel:function(a){this.channels[this.toIRCLower(a)]=1},irc_KICK:function(a,b){var c=b[0],d=b[1],e=b[2];d==this.nickname&&this.__getChannel(c)&&this.__killChannel(c);this.userKicked(a,c,d,e);return!0},
irc_PING:function(a,b){this.send("PONG :"+b.indexFromEnd(-1));return!0},irc_JOIN:function(a,b){var c=b[0];a.hostToNick()==this.nickname&&this.__nowOnChannel(c);this.userJoined(a,c);return!0},irc_TOPIC:function(a,b){var c=b[0],d=b.indexFromEnd(-1);this.channelTopic(a,c,d);return!0},processCTCP:function(a){if("\u0001"==a.charAt(0))return a="\u0001"==a.charAt(a.length-1)?a.substr(1,a.length-2):a.substr(1),a.splitMax(" ",2)},irc_PRIVMSG:function(a,b){var c=b[0],d=b.indexFromEnd(-1),e=this.processCTCP(d);
if(e){var d=e[0].toUpperCase(),g=qwebirc.irc.RegisteredCTCPs[d];if(g){var f=(new Date).getTime()/1E3;f>this.nextctcp&&this.send("NOTICE "+a.hostToNick()+" :\u0001"+d+" "+g(e[1])+"\u0001");this.nextctcp=f+5}c==this.nickname?this.userCTCP(a,d,e[1]):this.channelCTCP(a,c,d,e[1])}else c==this.nickname?this.userPrivmsg(a,d):this.channelPrivmsg(a,c,d);return!0},irc_NOTICE:function(a,b){var c=b[0],d=b.indexFromEnd(-1);"$"==c[0]?""!=a?this.userNotice(a,d):this.serverNotice(a,d):c!=this.nickname&&this.__signedOn?
this.channelNotice(a,c,d):""==a||-1==a.indexOf("!")?this.serverNotice(a,d):(c=this.processCTCP(d))?this.userCTCPReply(a,c[0],c[1]):this.userNotice(a,d);return!0},irc_INVITE:function(a,b){var c=b.indexFromEnd(-1);this.userInvite(a,c);return!0},irc_ERROR:function(a,b){var c=b.indexFromEnd(-1);this.serverError(c);return!0},irc_MODE:function(a,b){var c=b[0],d=b.slice(1);if(c==this.nickname)this.userMode(d);else{var e=d[0].split(""),g=d.slice(1),f=[],h=0,k="+";e.each(function(a){if("+"==a||"-"==a)k=a;
else{var b=this.pmodes[a];a=b==qwebirc.irc.PMODE_LIST||b==qwebirc.irc.PMODE_SET_UNSET||"+"==k&&b==qwebirc.irc.PMODE_SET_ONLY?[k,a,g[h++]]:[k,a];f.push(a)}},this);this.channelMode(a,c,f,d)}return!0},irc_RPL_ISUPPORT:function(a,b){for(var c=b.slice(1,-1),d={},e=0;e<c.length;e++){var g=c[e].splitMax("=",2);d[g[0]]=!0}d.CHANMODES&&d.PREFIX&&(this.pmodes={});for(e=0;e<c.length;e++)g=c[e].splitMax("=",2),this.supported(g[0],g[1])},irc_RPL_NAMREPLY:function(a,b){this.channelNames(b[2],b[3].split(" "));return!0},
irc_RPL_ENDOFNAMES:function(a,b){this.channelNames(b[1],[]);return!0},irc_RPL_NOTOPIC:function(a,b){var c=b[1];if(this.__getChannel(c))return this.initialTopic(c,""),!0},irc_RPL_TOPIC:function(a,b){var c=b[1],d=b.indexFromEnd(-1);if(this.__getChannel(c))return this.initialTopic(c,d),!0},irc_RPL_TOPICWHOTIME:function(a,b){return!0},irc_RPL_WHOISUSER:function(a,b){var c=b[1];this.whoisNick=c;return this.whois(c,"user",{ident:b[2],hostname:b[3],realname:b.indexFromEnd(-1)})},irc_RPL_WHOISSERVER:function(a,
b){var c=b[1];b.indexFromEnd(-1);return this.whois(c,"server",{server:b[2],serverdesc:b.indexFromEnd(-1)})},irc_RPL_WHOISOPERATOR:function(a,b){var c=b[1];b.indexFromEnd(-1);return this.whois(c,"oper",{opertext:b.indexFromEnd(-1)})},irc_RPL_WHOISIDLE:function(a,b){return this.whois(b[1],"idle",{idle:b[2],connected:b[3]})},irc_RPL_WHOISCHANNELS:function(a,b){return this.whois(b[1],"channels",{channels:b.indexFromEnd(-1)})},irc_RPL_WHOISACCOUNT:function(a,b){return this.whois(b[1],"account",{account:b[2]})},
irc_RPL_WHOISACTUALLY:function(a,b){return this.whois(b[1],"actually",{hostmask:b[2],ip:b[3]})},irc_RPL_WHOISOPERNAME:function(a,b){return this.whois(b[1],"opername",{opername:b[2]})},irc_RPL_WHOISAVAILHELP:function(a,b){return this.whois(b[1],"availhelp",{})},irc_RPL_WHOISREGGED:function(a,b){return this.whois(b[1],"regged",{})},irc_RPL_WHOISMODES:function(a,b){var c=b[1],d=b.indexFromEnd(-1).split(" ").slice(3).join(" ");return this.whois(c,"modes",{modes:d})},irc_RPL_WHOISREALHOST:function(a,b){var c=
b[1],d=b.indexFromEnd(-1),e=d.split(" ")[3],d=d.split(" ")[4];return this.whois(c,"realhost",{hostname:e,ip:d})},irc_RPL_WHOISGENERICTEXT:function(a,b){var c=b[1],d=b.indexFromEnd(-1);return this.whois(c,"generictext",{text:d})},irc_RPL_WHOISWEBIRC:function(a,b){var c=b[1],d=b.indexFromEnd(-1);return this.whois(c,"generictext",{text:d})},irc_RPL_WHOISSECURE:function(a,b){var c=b[1],d=b.indexFromEnd(-1);return this.whois(c,"generictext",{text:d})},irc_RPL_ENDOFWHOIS:function(a,b){var c=b[1];b.indexFromEnd(-1);
this.whoisNick=null;return this.whois(c,"end",{})},irc_genericError:function(a,b){var c=b[1],d=b.indexFromEnd(-1);this.genericError(c,d);return!0},irc_genericQueryError:function(a,b){var c=b[1],d=b.indexFromEnd(-1);this.genericQueryError(c,d);return!0},irc_genericNickInUse:function(a,b){this.genericError(b[1],b.indexFromEnd(-1).replace("in use.","in use"));if(this.__signedOn)return!0;var c=b[1]+"_";c==this.lastnick&&(c="iris"+Math.floor(1048576*Math.random()));this.send("NICK "+c);this.lastnick=c;
return!0},setupGenericErrors:function(){this.irc_ERR_CHANOPPRIVSNEEDED=this.irc_ERR_CANNOTSENDTOCHAN=this.irc_genericError;this.irc_ERR_NOSUCHNICK=this.irc_genericQueryError;this.irc_ERR_NICKNAMEINUSE=this.irc_ERR_UNAVAILRESOURCE=this.irc_genericNickInUse;this.irc_ERR_SASLABORTED=this.irc_ERR_SASLALREADY=this.irc_ERR_SASLFAIL=this.irc_ERR_SASLTOOLONG=this.irc_RPL_LOGGEDIN=this.irc_ERR_NICKLOCKED=this.irc_saslFinished;return!0},irc_RPL_AWAY:function(a,b){var c=b[1],d=b.indexFromEnd(-1);if(this.whoisNick&&
this.whoisNick==c)return this.whois(c,"away",{away:d});this.awayMessage(c,d);return!0},irc_RPL_NOWAWAY:function(a,b){this.awayStatus(!0,b.indexFromEnd(-1));return!0},irc_RPL_UNAWAY:function(a,b){this.awayStatus(!1,b.indexFromEnd(-1));return!0},irc_WALLOPS:function(a,b){var c=b.indexFromEnd(-1);this.wallops(a,c);return!0},irc_RPL_CREATIONTIME:function(a,b){this.channelCreationTime(b[1],b[2]);return!0},irc_RPL_CHANNELMODEIS:function(a,b){var c=b[1],d=b.slice(2);this.channelModeIs(c,d);return!0}});qwebirc.irc.IRCClient=new Class({Extends:qwebirc.irc.BaseIRCClient,session:null,initialize:function(a,b){this.parent(a,b);this.prefixes="@+";this.modeprefixes="ov";this.autojoin=b.autojoin;this.commandparser=new qwebirc.irc.Commands(a);this.exec=this.commandparser.dispatch.bind(this.commandparser);this.hilightController=new qwebirc.ui.HilightController(a);this.statusWindow=ui.newClient();this.lastNicks=[];this.inviteChanList=[];this.tracker=new qwebirc.irc.IRCTracker(this)},newLine:function(a,b,c){c||
(c={});(a=ui.getWindow(b,a))?a.addLine(b,c):this.statusWindow.addLine(b,c)},newChanLine:function(a,b,c,d){d||(d={});$defined(c)&&(d.n=c.hostToNick(),d.h=c.hostToHost());d.c=a;d["-"]=this.nickname;conf.ui.nick_status||delete d["@"];this.newLine(a,b,d)},newServerLine:function(a,b){this.statusWindow.addLine(a,b)},newActiveLine:function(a,b){this.getActiveWindow().addLine(a,b)},newTargetOrActiveLine:function(a,b,c){ui.getWindow(b,a)?this.newLine(a,b,c):this.newActiveLine(b,c)},updateNickList:function(a){var b=
this.tracker.getChannel(a),c=[],d=String.fromCharCode(255),e={},g;for(g in b){var f=b[g];if(0<f.prefixes.length){var h=f.prefixes.charAt(0),f=String.fromCharCode(this.prefixes.indexOf(h))+this.toIRCLower(g);e[f]=h+g}else f=d+this.toIRCLower(g),e[f]=g;c.push(f)}c.sort();var k=[];c.each(function(a){k.push(e[a])});(a=ui.getWindow(qwebirc.ui.WINDOW_CHANNEL,a))&&a.updateNickList(k)},newWindow:function(a,b,c){var d=ui.getWindow(b,a);d||(d=ui.newWindow(b,a));c&&ui.selectWindow(d);return d},newQueryWindow:function(a,
b){if(!ui.getWindow(qwebirc.ui.WINDOW_QUERY,a))return b?this.newPrivmsgQueryWindow(a):this.newNoticeQueryWindow(a)},newPrivmsgQueryWindow:function(a){if(conf.ui.dedicated_msg_window){if(!ui.getWindow(qwebirc.ui.WINDOW_MESSAGES,"Messages"))return ui.newWindow(qwebirc.ui.WINDOW_MESSAGES,"Messages")}else return this.newWindow(a,qwebirc.ui.WINDOW_QUERY,!1)},newNoticeQueryWindow:function(a){if(conf.ui.dedicated_notice_window&&!ui.getWindow(qwebirc.ui.WINDOW_MESSAGES,"Messages"))return ui.newWindow(qwebirc.ui.WINDOW_MESSAGES,
"Messages")},newQueryLine:function(a,b,c,d,e){if(ui.getWindow(qwebirc.ui.WINDOW_QUERY,a))return this.newLine(a,b,c);var g=ui.getWindow(qwebirc.ui.WINDOW_MESSAGES,"Messages");return(d?conf.ui.dedicated_msg_window:conf.ui.dedicated_notice_window)&&g?g.addLine(b,c):e?this.newActiveLine(b,c):this.newLine(a,b,c)},newQueryOrActiveLine:function(a,b,c,d){this.newQueryLine(a,b,c,d,!0)},getActiveWindow:function(){return ui.getActiveIRCWindow()},getNickname:function(){return this.nickname},addPrefix:function(a,
b){for(var c=a.prefixes+b,d=[],e=0;e<this.prefixes.length;e++){var g=this.prefixes.charAt(e);-1!=c.indexOf(g)&&d.push(g)}a.prefixes=d.join("")},stripPrefix:function(a){var b=a.charAt(0);return b?-1!=this.prefixes.indexOf(b)?a.substring(1):a:a},removePrefix:function(a,b){a.prefixes=a.prefixes.replaceAll(b,"")},rawNumeric:function(a,b,c){this.newServerLine("RAW",{n:"numeric",m:c.slice(1).join(" ")})},signedOn:function(a){this.tracker=new qwebirc.irc.IRCTracker(this);this.nickname=a;this.newServerLine("SIGNON");
this.autojoin&&this.exec("/AUTOJOIN")},userJoined:function(a,b){var c=a.hostToNick();a.hostToHost();c!=this.nickname||ui.getWindow(qwebirc.ui.WINDOW_CHANNEL,b)||this.newWindow(b,qwebirc.ui.WINDOW_CHANNEL,!0);this.tracker.addNickToChannel(c,b);c==this.nickname?this.newChanLine(b,"OURJOIN",a):conf.ui.hide_joinparts||this.newChanLine(b,"JOIN",a);this.updateNickList(b)},userPart:function(a,b,c){var d=a.hostToNick();a.hostToHost();d==this.nickname?(this.tracker.removeChannel(b),(a=ui.getWindow(qwebirc.ui.WINDOW_CHANNEL,
b))&&ui.closeWindow(a)):(this.tracker.removeNickFromChannel(d,b),conf.ui.hide_joinparts||this.newChanLine(b,"PART",a,{m:c}),this.updateNickList(b))},userKicked:function(a,b,c,d){if(c==this.nickname){this.tracker.removeChannel(b);var e=ui.getWindow(qwebirc.ui.WINDOW_CHANNEL,b);e&&ui.closeWindow(e)}else this.tracker.removeNickFromChannel(c,b),this.updateNickList(b);this.newChanLine(b,"KICK",a,{v:c,m:d})},channelMode:function(a,b,c,d){c.each(function(a){var c=a[0],d=this.modeprefixes.indexOf(a[1]);-1!=
d&&(a=a[2],d=this.prefixes.charAt(d),a=this.tracker.getOrCreateNickOnChannel(a,b),"-"==c?this.removePrefix(a,d):this.addPrefix(a,d))},this);this.newChanLine(b,"MODE",a,{m:d.join(" ")});this.updateNickList(b)},userQuit:function(a,b){var c=a.hostToNick(),d=this.tracker.getNick(c),e=[],g;for(g in d)e.push(g),conf.ui.hide_joinparts||this.newChanLine(g,"QUIT",a,{m:b});this.tracker.removeNick(c);e.each(function(a){this.updateNickList(a)},this)},nickChanged:function(a,b){var c=a.hostToNick();c==this.nickname&&
(this.nickname=b);this.tracker.renameNick(c,b);var c=this.tracker.getNick(b),d=!1,e;for(e in c)d=!0,this.newChanLine(e,"NICK",a,{w:b}),this.updateNickList(e);d||this.newServerLine("NICK",{w:b,n:a.hostToNick(),h:a.hostToHost(),"-":this.nickname})},channelTopic:function(a,b,c){this.newChanLine(b,"TOPIC",a,{m:c});ui.getWindow(qwebirc.ui.WINDOW_CHANNEL,b).updateTopic(c)},initialTopic:function(a,b){ui.getWindow(qwebirc.ui.WINDOW_CHANNEL,a).updateTopic(b)},channelCTCP:function(a,b,c,d){void 0==d&&(d="");
var e=a.hostToNick();"ACTION"==c?(this.tracker.updateLastSpoke(e,b,(new Date).getTime()),this.newChanLine(b,"CHANACTION",a,{m:d,c:b,"@":this.getNickStatus(b,e)})):this.newChanLine(b,"CHANCTCP",a,{x:c,m:d,c:b,"@":this.getNickStatus(b,e)})},userCTCP:function(a,b,c){var d=a.hostToNick();a=a.hostToHost();void 0==c&&(c="");"ACTION"==b?(this.newQueryWindow(d,!0),this.newQueryLine(d,"PRIVACTION",{m:c,x:b,h:a,n:d},!0)):this.newTargetOrActiveLine(d,"PRIVCTCP",{m:c,x:b,h:a,n:d,"-":this.nickname})},userCTCPReply:function(a,
b,c){var d=a.hostToNick();a=a.hostToHost();void 0==c&&(c="");this.newTargetOrActiveLine(d,"CTCPREPLY",{m:c,x:b,h:a,n:d,"-":this.nickname})},getNickStatus:function(a,b){var c=this.tracker.getNickOnChannel(b,a);return $defined(c)&&0!=c.prefixes.length?c.prefixes.charAt(0):""},channelPrivmsg:function(a,b,c){var d=a.hostToNick();this.tracker.updateLastSpoke(d,b,(new Date).getTime());this.newChanLine(b,"CHANMSG",a,{m:c,"@":this.getNickStatus(b,d)})},channelNotice:function(a,b,c){this.newChanLine(b,"CHANNOTICE",
a,{m:c,"@":this.getNickStatus(b,a.hostToNick())})},userPrivmsg:function(a,b){var c=a.hostToNick(),d=a.hostToHost();this.newQueryWindow(c,!0);this.pushLastNick(c);this.newQueryLine(c,"PRIVMSG",{m:b,h:d,n:c},!0)},serverNotice:function(a,b){""==a?this.newServerLine("SERVERNOTICE",{m:b}):this.newServerLine("PRIVNOTICE",{m:b,n:a})},userNotice:function(a,b){var c=a.hostToNick(),d=a.hostToHost();conf.ui.dedicated_notice_window?(this.newQueryWindow(c,!1),this.newQueryOrActiveLine(c,"PRIVNOTICE",{m:b,h:d,
n:c},!1)):this.newTargetOrActiveLine(c,"PRIVNOTICE",{m:b,h:d,n:c})},__joinInvited:function(){this.exec("/JOIN "+this.inviteChanList.join(","));this.inviteChanList=[]},userInvite:function(a,b){var c=a.hostToNick(),d=a.hostToHost();this.newServerLine("INVITE",{c:b,h:d,n:c})},userMode:function(a){this.newServerLine("UMODE",{m:a,n:this.nickname})},channelNames:function(a,b){0==b.length?this.updateNickList(a):b.each(function(b){var d=[];b.split("").every(function(a,e){if(-1==this.prefixes.indexOf(a))return b=
b.substr(e),!1;d.push(a);return!0},this);var e=this.tracker.addNickToChannel(b,a);d.each(function(a){this.addPrefix(e,a)},this)},this)},disconnected:function(a){for(var b in session.windows){var c=session.windows[b];c.type==qwebirc.ui.WINDOW_CHANNEL&&ui.closeWindow(c)}this.tracker=void 0;qwebirc.connected=!1;this.newServerLine("DISCONNECT",{m:a})},nickOnChanHasPrefix:function(a,b,c){a=this.tracker.getNickOnChannel(a,b);return $defined(a)?-1!=a.prefixes.indexOf(c):!1},nickOnChanHasAtLeastPrefix:function(a,
b,c,d){a=this.tracker.getNickOnChannel(a,b);if(!$defined(a))return!1;c=this.prefixes.indexOf(c);if(-1==c)return!1;d||(c+=1);var e={};this.prefixes.slice(0,c).split("").each(function(a){e[a]=!0});d=a.prefixes;for(c=0;c<d.length;c++)if(e[d.charAt(c)])return!0;return!1},supported:function(a,b){if("PREFIX"==a){var c=(b.length-2)/2;this.modeprefixes=b.substr(1,c);this.prefixes=b.substr(c+2,c)}this.parent(a,b)},connected:function(){qwebirc.connected=!0;this.newServerLine("CONNECT")},serverError:function(a){this.newServerLine("ERROR",
{m:a})},quit:function(a){this.send("QUIT :"+a,!0);this.disconnect()},awayMessage:function(a,b){this.newQueryLine(a,"AWAY",{n:a,m:b},!0)},whois:function(a,b,c){var d={n:a},e,g=function(){this.newTargetOrActiveLine(a,"WHOIS"+e,d)}.bind(this);if("user"==b)e="USER",d.h=c.ident+"@"+c.hostname,g(),e="REALNAME",d.m=c.realname;else if("server"==b)e="SERVER",d.x=c.server,d.m=c.serverdesc;else if("oper"==b)e="OPER";else if("idle"==b)e="IDLE",d.x=qwebirc.util.longtoduration(c.idle),d.m=qwebirc.irc.IRCDate(new Date(1E3*
c.connected));else if("channels"==b)e="CHANNELS",d.m=c.channels;else if("account"==b)e="ACCOUNT",d.m=c.account;else if("away"==b)e="AWAY",d.m=c.away;else if("opername"==b)e="OPERNAME",d.m=c.opername;else if("actually"==b)e="ACTUALLY",d.m=c.hostname,d.x=c.ip;else if("availhelp"==b)e="AVAILHELP";else if("regged"==b)e="REGGED";else if("modes"==b)e="MODES",d.m=c.modes;else if("realhost"==b)e="REALHOST",d.m=c.hostname,d.x=c.ip;else if("generictext"==b)e="GENERICTEXT",d.m=c.text;else if("end"==b)e="END";
else return!1;g();return!0},genericError:function(a,b){this.newTargetOrActiveLine(a,"GENERICERROR",{m:b,t:a})},genericQueryError:function(a,b){this.newQueryOrActiveLine(a,"GENERICERROR",{m:b,t:a},!0)},awayStatus:function(a,b){this.newActiveLine("GENERICMESSAGE",{m:b})},pushLastNick:function(a){var b=this.lastNicks.indexOf(a);-1!=b?this.lastNicks.splice(b,1):10==this.lastNicks.length&&this.lastNicks.pop();this.lastNicks.unshift(a)},wallops:function(a,b){var c=a.hostToNick(),d=a.hostToHost();this.newServerLine("WALLOPS",
{t:b,n:c,h:d})},channelModeIs:function(a,b){this.newTargetOrActiveLine(a,"CHANNELMODEIS",{c:a,m:b.join(" ")})},channelCreationTime:function(a,b){this.newTargetOrActiveLine(a,"CHANNELCREATIONTIME",{c:a,m:qwebirc.irc.IRCDate(new Date(1E3*b))})}});qwebirc.irc.IRCConnection=new Class({Implements:[Events,Options],session:null,options:{initialNickname:"ircconnX",timeout:45E3,floodInterval:200,floodMax:10,floodReset:5E3,errorAlert:!0,maxRetries:5,serverPassword:null},initialize:function(a,b){this.session=a;this.setOptions(b);this.initialNickname=this.options.initialNickname;this.counter=0;this.disconnected=!1;this.__retryAttempts=this.__floodLastFlood=this.__floodCounter=this.__floodLastRequest=0;this.__activeRequest=this.__lastActiveRequest=this.__timeoutId=
null;this.__sendQueue=[];this.__sendQueueActive=!1},__error:function(a){this.fireEvent("error",a);this.options.errorAlert&&alert(a)},newRequest:function(a,b,c){if(this.disconnected)return null;b&&!this.disconnected&&this.__isFlooding()&&(this.disconnect(),this.__error("BUG: uncontrolled flood detected -- disconnected."));b=!0;c&&(b=!1);a=new Request.JSON({url:conf.frontend.dynamic_base_url+"e/"+a+"?r="+this.cacheAvoidance+"&t="+this.counter++,async:b});a.headers=new Hash;a.addEvent("request",function(){var a=
function(a,b){try{this.setRequestHeader(a,b)}catch(c){}}.bind(this);a("User-Agent",null);a("Accept",null);a("Accept-Language",null)}.bind(a.xhr));Browser.Engine.trident&&a.setHeader("If-Modified-Since","Sat, 1 Jan 2000 00:00:00 GMT");return a},__isFlooding:function(){var a=(new Date).getTime();if(a-this.__floodLastRequest<this.options.floodInterval&&(0!=this.__floodLastFlood&&a-this.__floodLastFlood>this.options.floodReset&&(this.__floodCounter=0),this.__floodLastFlood=a,this.__floodCounter++>=this.options.floodMax))return!0;
this.__floodLastRequest=a;return!1},send:function(a,b){if(this.disconnected)return!1;b?this.__send(a,!1):(this.__sendQueue.push(a),this.__processSendQueue());return!0},__processSendQueue:function(){this.__sendQueueActive||0==this.__sendQueue.length||(this.sendQueueActive=!0,this.__send(this.__sendQueue.shift(),!0))},__send:function(a,b){var c=this.newRequest("p",!1,!b);null!==c&&(c.addEvent("complete",function(a){b&&(this.__sendQueueActive=!1);if(!a||!1==a[0])return this.__sendQueue=[],this.disconnected||
(this.disconnected=!0,this.__error("An error occured: "+a[1])),!1;this.__processSendQueue()}.bind(this)),c.send("s="+this.sessionid+"&c="+encodeURIComponent(a)))},__processData:function(a){if(!1==a[0])return this.disconnected||(this.disconnected=!0,this.__error("An error occured: "+a[1])),!1;this.__retryAttempts=0;a.each(function(a){this.fireEvent("recv",[a])},this);return!0},__scheduleTimeout:function(){this.options.timeout&&(this.__timeoutId=this.__timeoutEvent.delay(this.options.timeout,this))},
__cancelTimeout:function(){$defined(this.__timeoutId)&&($clear(this.__timeoutId),this.__timeoutId=null)},__timeoutEvent:function(){this.__timeoutId=null;$defined(this.__activeRequest)&&(this.__checkRetries()?(this.__lastActiveRequest&&this.__lastActiveRequest.cancel(),this.__activeRequest.__replaced=!0,this.__lastActiveRequest=this.__activeRequest,this.recv()):this.__cancelRequests())},__checkRetries:function(){return this.__retryAttempts++>=this.options.maxRetries&&!this.disconnected?(this.disconnect(),
this.__error("Error: connection closed after several requests failed."),!1):!0},recv:function(){var a=this.newRequest("s",!0);$defined(a)&&(this.__activeRequest=a,a.__replaced=!1,a.addEvent("complete",function(b){a.__replaced?(this.__lastActiveRequest=null,b&&this.__processData(b)):(this.__activeRequest=null,this.__cancelTimeout(),b?this.__processData(b)&&this.recv():this.disconnected||this.__checkRetries()&&this.recv())}.bind(this)),this.__scheduleTimeout(),a.send("s="+this.sessionid))},connect:function(){this.cacheAvoidance=
qwebirc.util.randHexString(16);var a=this.newRequest("n");a.addEvent("complete",function(a){a?!1==a[0]?(this.disconnect(),this.__error("An error occured: "+a[1])):(this.sessionid=a[1],this.recv()):(this.disconnected=!0,this.__error("Couldn't connect to remote server."))}.bind(this));var b="nick="+encodeURIComponent(this.initialNickname);$defined(this.options.serverPassword)&&(b+="&password="+encodeURIComponent(this.options.serverPassword));a.send(b)},__cancelRequests:function(){$defined(this.__lastActiveRequest)&&
(this.__lastActiveRequest.cancel(),this.__lastActiveRequest=null);$defined(this.__activeRequest)&&(this.__activeRequest.cancel(),this.__activeRequest=null)},disconnect:function(){this.disconnected=!0;this.__cancelTimeout();this.__cancelRequests()}});qwebirc.irc.FlashConnection=new Class({Implements:[Events,Options],options:{initialNickname:"ircconnX",server:"irc.example.com",port:6667,xmlport:8430,timeout:45E3,maxRetries:5,serverPassword:null},initialize:function(a,b){this.setOptions(b,conf.flash)},connect:function(){this.raw_buffer=[];this.buffer="";FlashSocket.connect?(FlashSocket.state=this.__state.bind(this),FlashSocket.connect(this.options.server,this.options.port,this.options.xmlport)):this.fireEvent("recv",[["disconnect","No Flash support"]])},
connected:function(){this.send("CAP LS");this.send("USER "+this.options.initialNickname+" 0 * :qwebirc");this.options.serverPassword&&this.send("PASS :"+this.options.serverPassword);this.send("NICK "+this.options.initialNickname);this.fireEvent("recv",[["connect"]])},disconnect:function(){FlashSocket.disconnect()},disconnected:function(a){this.fireEvent("recv",[["disconnect",a||"Connection Closed"]])},send:function(a,b){FlashSocket.write(String(a)+"\r\n");return!0},recv:function(a){var b=0,c=[];for(a=
this.raw_buffer.concat(a);;){var d=0==(a[b]&128)?1:192==(a[b]&224)?2:224==(a[b]&240)?3:240==(a[b]&248)?4:1;if(d>a.length-b)break;var e=a.slice(b,b+d),g=c,f=0;switch(e.length){case 1:f=e[0];break;case 2:f=(e[0]&31)<<6;f|=e[1]&63;break;case 3:f=(e[0]&15)<<12;f|=(e[1]&63)<<6;f|=e[2]&63;break;case 4:f=(e[0]&7)<<18,f|=(e[1]&63)<<12,f|=(e[2]&63)<<6,f|=e[3]&63}65536<=f?(f-=65536,g.push((f>>10)+55296,f%1024+56320)):g.push(f);b+=d}this.raw_buffer=a.splice(b);this.buffer+=String.fromCharCode.apply(null,c);
for(b=this.buffer.split("\r\n");1<b.length;)this.fireEvent("recv",[["c",b.shift()]]);this.buffer=b[0]},__state:function(a,b){1==a&&this.connected();3==a&&this.disconnected();4==a&&this.disconnected(b);5==a&&this.recv(JSON.parse(b))}});qwebirc.irc.WSConnection=new Class({Implements:[Events,Options],options:{initialNickname:"ircconnX",url:"ws://irc.example.com/",timeout:45E3,maxRetries:5,serverPassword:null},initialize:function(a,b){this.setOptions(b,conf.websocket)},connect:function(){window.WebSocket?(this.socket=new WebSocket(this.options.url,"irc"),this.socket.onopen=this.connected.bind(this),this.socket.onclose=this.disconnected.bind(this),this.socket.onmessage=this.recv.bind(this)):this.fireEvent("recv",[["disconnect","No WebSocket Support"]])},
connected:function(a){this.send("CAP LS");this.send("USER "+this.options.initialNickname+" 0 * :qwebirc");this.options.serverPassword&&this.send("PASS :"+this.options.serverPassword);this.send("NICK "+this.options.initialNickname);this.fireEvent("recv",[["connect"]])},disconnect:function(){this.socket.close()},disconnected:function(a){this.fireEvent("recv",[["disconnect",a.reason?a.reason:"Unknown reason"]])},send:function(a,b){this.socket.send(String(a));return!0},recv:function(a){this.fireEvent("recv",
[["c",a.data]])}});qwebirc.irc.IRCLowerTable="\x00\u0001\u0002\u0003\u0004\u0005\u0006\u0007\b\t\n\x0B\f\r\u000e\u000f\u0010\u0011\u0012\u0013\u0014\u0015\u0016\u0017\u0018\u0019\u001a\u001b\u001c\u001d\u001e\u001f !\"#$%&'()*+,-./0123456789:;<=>?@abcdefghijklmnopqrstuvwxyz{|}~_`abcdefghijklmnopqrstuvwxyz{|}~\u007f\u0080\u0081\u0082\u0083\u0084\u0085\u0086\u0087\u0088\u0089\u008a\u008b\u008c\u008d\u008e\u008f\u0090\u0091\u0092\u0093\u0094\u0095\u0096\u0097\u0098\u0099\u009a\u009b\u009c\u009d\u009e\u009f\u00a0\u00a1\u00a2\u00a3\u00a4\u00a5\u00a6\u00a7\u00a8\u00a9\u00aa\u00ab\u00ac\u00ad\u00ae\u00af\u00b0\u00b1\u00b2\u00b3\u00b4\u00b5\u00b6\u00b7\u00b8\u00b9\u00ba\u00bb\u00bc\u00bd\u00be\u00bf\u00e0\u00e1\u00e2\u00e3\u00e4\u00e5\u00e6\u00e7\u00e8\u00e9\u00ea\u00eb\u00ec\u00ed\u00ee\u00ef\u00f0\u00f1\u00f2\u00f3\u00f4\u00f5\u00f6\u00d7\u00f8\u00f9\u00fa\u00fb\u00fc\u00fd\u00fe\u00df\u00e0\u00e1\u00e2\u00e3\u00e4\u00e5\u00e6\u00e7\u00e8\u00e9\u00ea\u00eb\u00ec\u00ed\u00ee\u00ef\u00f0\u00f1\u00f2\u00f3\u00f4\u00f5\u00f6\u00f7\u00f8\u00f9\u00fa\u00fb\u00fc\u00fd\u00fe\u00ff".split("");
qwebirc.irc.RFC1459toIRCLower=function(a){for(var b=[],c=0;c<a.length;c++){var d=a.charCodeAt(c);b.push(qwebirc.irc.IRCLowerTable[d])}return b.join("")};qwebirc.irc.ASCIItoIRCLower=function(a){return a.toLowerCase()};String.prototype.hostToNick=function(){return this.split("!",1)[0]};String.prototype.hostToHost=function(){return this.split("!",2)[1]};qwebirc.irc.IRCTimestamp=function(a){return"["+qwebirc.util.pad(a.getHours())+":"+qwebirc.util.pad(a.getMinutes())+"]"};
qwebirc.irc.IRCDate=function(a){var b=qwebirc.util.pad;return qwebirc.util.DaysOfWeek[a.getDay()]+" "+qwebirc.util.MonthsOfYear[a.getMonth()]+" "+b(a.getDate())+" "+b(a.getHours())+":"+b(a.getMinutes())+":"+b(a.getSeconds())+" "+a.getFullYear()};qwebirc.irc.toIRCCompletion=function(a,b){return a.irc.toIRCLower(b).replace(/[^\w]+/g,"")};qwebirc.irc.NickChanEntry=function(){this.prefixes="";this.lastSpoke=0};
qwebirc.irc.IRCTracker=new Class({initialize:function(a){this.channels={};this.nicknames={};this.owner=a},toIRCLower:function(a){return this.owner.toIRCLower(a)},isEmpty:function(a){for(var b in a)return!1;return!0},getNick:function(a){return this.nicknames[a]},getOrCreateNick:function(a){var b=this.getNick(a);b||(b=this.nicknames[a]={});return b},getChannel:function(a){return this.channels[this.toIRCLower(a)]},getOrCreateChannel:function(a){var b=this.getChannel(a);b||(b=this.channels[this.toIRCLower(a)]=
{});return b},getOrCreateNickOnChannel:function(a,b){var c=this.getOrCreateNick(a)[this.toIRCLower(b)];return c?c:this.addNickToChannel(a,b)},getNickOnChannel:function(a,b){var c=this.getNick(a);if(c)return c[this.toIRCLower(b)]},addNickToChannel:function(a,b){var c=new qwebirc.irc.NickChanEntry;this.getOrCreateNick(a)[this.toIRCLower(b)]=c;return this.getOrCreateChannel(b)[a]=c},removeNick:function(a){var b=this.getNick(a);if(b){for(var c in b){var b=this.toIRCLower(c),d=this.channels[b];delete d[a];
this.isEmpty(d)&&delete this.channels[b]}delete this.nicknames[a]}},removeChannel:function(a){var b=this.getChannel(a);if(b){a=this.toIRCLower(a);for(var c in b)b=this.nicknames[c],delete b[a],this.isEmpty(b)&&delete this.nicknames[c];delete this.channels[a]}},removeNickFromChannel:function(a,b){var c=this.toIRCLower(b),d=this.getNick(a),e=this.getChannel(c);d&&e&&(delete d[c],delete e[a],this.isEmpty(d)&&delete this.nicknames[a],this.isEmpty(e)&&delete this.channels[c])},renameNick:function(a,b){var c=
this.getNick(a);if(c){for(var d in c)c=this.toIRCLower(d),this.channels[c][b]=this.channels[c][a],delete this.channels[c][a];this.nicknames[b]=this.nicknames[a];delete this.nicknames[a]}},updateLastSpoke:function(a,b,c){a=this.getNickOnChannel(a,b);$defined(a)&&(a.lastSpoke=c)},getSortedByLastSpoke:function(a){var b=function(a,b){return b[1].lastSpoke-a[1].lastSpoke},c=this.getChannel(a);if(c){a=[];for(var d in c)a.push([d,c[d]]);a.sort(b);b=[];for(d=0;d<a.length;d++)b.push(a[d][0]);return b}}});qwebirc.irc.Numerics={"001":"RPL_WELCOME",433:"ERR_NICKNAMEINUSE",437:"ERR_UNAVAILRESOURCE","004":"RPL_MYINFO","005":"RPL_ISUPPORT",353:"RPL_NAMREPLY",366:"RPL_ENDOFNAMES",331:"RPL_NOTOPIC",332:"RPL_TOPIC",333:"RPL_TOPICWHOTIME",311:"RPL_WHOISUSER",312:"RPL_WHOISSERVER",313:"RPL_WHOISOPERATOR",317:"RPL_WHOISIDLE",671:"RPL_WHOISSECURE",318:"RPL_ENDOFWHOIS",319:"RPL_WHOISCHANNELS",330:"RPL_WHOISACCOUNT",338:"RPL_WHOISACTUALLY",343:"RPL_WHOISOPERNAME",320:"RPL_WHOISGENERICTEXT",310:"RPL_WHOISAVAILHELP",
307:"RPL_WHOISREGGED",378:"RPL_WHOISREALHOST",379:"RPL_WHOISMODES",325:"RPL_WHOISWEBIRC",301:"RPL_AWAY",401:"ERR_NOSUCHNICK",404:"ERR_CANNOTSENDTOCHAN",482:"ERR_CHANOPPRIVSNEEDED",305:"RPL_UNAWAY",306:"RPL_NOWAWAY",324:"RPL_CHANNELMODEIS",329:"RPL_CREATIONTIME",900:"RPL_LOGGEDIN",901:"RPL_LOGGEDOUT",902:"ERR_NICKLOCKED",903:"RPL_SASLSUCCESS",904:"ERR_SASLFAIL",905:"ERR_SASLTOOLONG",906:"ERR_SASLABORTED",907:"ERR_SASLALREADY",908:"RPL_SASLMECHS"};qwebirc.ui.Atheme={};qwebirc.ui.Atheme.handleLogin=function(a,b,c){a.atheme.state=!0;a.atheme.user=b;a.atheme.secret=c;cookie=new Hash.Cookie("iris-auth");cookie.set("user",a.atheme.user);cookie.set("token",a.atheme.secret);cookie.save()};qwebirc.ui.Atheme.handleLogout=function(){this.state=!1};
qwebirc.ui.Atheme.check=function(a){$defined(a.atheme.user)&&$defined(a.atheme.secret)&&"AUTHCOOKIE"==conf.atheme.sasl_type?qwebirc.irc.AthemeQuery.checkLogin(function(b){null==b?a.atheme.state=null:b?this.handleLogin(a,a.atheme.user,a.atheme.secret):this.handleLogout()}.bind(this),a.atheme.user,a.atheme.secret):this.handleLogout(a)};qwebirc.ui.WINDOW_STATUS=1;qwebirc.ui.WINDOW_QUERY=2;qwebirc.ui.WINDOW_CHANNEL=4;qwebirc.ui.WINDOW_MESSAGES=8;qwebirc.ui.WINDOW_CUSTOM=16;
qwebirc.ui.BaseUI=new Class({initialize:function(a,b,c,d){this.session=a;this.parentElement=b;this.windowClass=c;this.windowArray=[];this.parentElement.addClass("qwebirc");this.parentElement.addClass("qwebirc-"+d);this.firstClient=!1;this.commandhistory=new qwebirc.irc.CommandHistory;this.windowFocused=!0;Browser.Engine.trident?function(){var a=document.hasFocus();a!=this.windowFocused&&(this.windowFocused=a,this.focusChange(a))}.periodical(100,this):(a=function(){this.windowFocused&&(this.windowFocused=
!1,this.focusChange(!1))}.bind(this),b=function(){this.windowFocused||(this.windowFocused=!0,this.focusChange(!0))}.bind(this),document.addEvent("blur",a),window.addEvent("blur",a),document.addEvent("focus",b),window.addEvent("focus",b));this.postInitialize()},newClient:function(){var a=this.newWindow(qwebirc.ui.WINDOW_STATUS,"Status");this.selectWindow(a);this.firstClient||(this.firstClient=!0,a.addLine("","qwebirc v"+qwebirc.VERSION),a.addLine("","Copyright (C) 2008-2010 Chris Porter and the qwebirc project."),
a.addLine("","http://www.qwebirc.org"),a.addLine("","Licensed under the GNU General Public License, Version 2."));return a},getWindowIdentifier:function(a,b){return a==qwebirc.ui.WINDOW_MESSAGES?"-M":a==qwebirc.ui.WINDOW_STATUS?"":a==qwebirc.ui.WINDOW_CUSTOM?"internal_"+qwebirc.irc.ASCIItoIRCLower(b):"_"+this.session.irc.toIRCLower(b)},newWindow:function(a,b){var c=this.getWindow(a,b);if($defined(c))return c;c=this.getWindowIdentifier(a,b);c=this.session.windows[c]=new this.windowClass(this.session,
a,b,c);this.windowArray.push(c);return c},getWindow:function(a,b){return this.session.windows[this.getWindowIdentifier(a,b)]},getActiveWindow:function(){return this.active},getActiveIRCWindow:function(){return this.active&&this.active.type!=qwebirc.ui.WINDOW_CUSTOM?this.active:this.session.windows[this.getWindowIdentifier(qwebirc.ui.WINDOW_STATUS)]},__setActiveWindow:function(a){this.active=a},selectWindow:function(a){this.active&&this.active.deselect();a.select();this.updateTitle(a.name+" - "+conf.frontend.app_title)},
updateTitle:function(a){document.title=a},nextWindow:function(a){if(0!=this.windowArray.length&&this.active){a||(a=1);var b=this.windowArray.indexOf(this.active);-1!=b&&(b+=a,0>b?b=this.windowArray.length-1:b>=this.windowArray.length&&(b=0),this.selectWindow(this.windowArray[b]))}},prevWindow:function(){this.nextWindow(-1)},closeWindow:function(a){a.closed=!0;$defined(a.scrolltimer)&&($clear(a.scrolltimer),a.scrolltimer=null);if(a.active)if(this.active=void 0,1==this.windowArray.length)this.windowArray=
[];else{var b=this.windowArray.indexOf(a);if(-1==b)return;0==b?this.selectWindow(this.windowArray[1]):this.selectWindow(this.windowArray[b-1])}delete a.session.windows[a.identifier];this.windowArray=this.windowArray.erase(a)},focusChange:function(a){var b=this.getActiveWindow();$defined(b)&&b.focusChange(a)}});
qwebirc.ui.StandardUI=new Class({Extends:qwebirc.ui.BaseUI,initialize:function(a,b,c,d){this.parent(a,b,c,d);this.tabCompleter=new qwebirc.ui.TabCompleterFactory(this);document.addEvent(Browser.Engine.trident?"keydown":"keypress",this.__handleHotkey.bind(this))},__handleHotkey:function(a){if(!a.alt||a.control){if("backspace"==a.key||"/"==a.key)this.getInputFocused(a)||(new Event(a)).stop()}else{var b=!1;if("a"==a.key||"A"==a.key){var c=0,d=-1,b=!0;(new Event(a)).stop();for(var e=0;e<this.windowArray.length;e++){var g=
this.windowArray[e].hilighted;g>c&&(d=e,c=g)}-1<d&&this.selectWindow(this.windowArray[d])}else if("0"<=a.key&&"9">=a.key){b=!0;number=a.key-0;0==number&&(number=10);number-=1;if(number>=this.windowArray.length)return;this.selectWindow(this.windowArray[number])}else"left"==a.key?(this.prevWindow(),b=!0):"right"==a.key&&(this.nextWindow(),b=!0);b&&(new Event(a)).stop()}},getInputFocused:function(a){return-1==$$("input").indexOf(a.target)&&-1==$$("textarea").indexOf(a.target)?!1:!0},newCustomWindow:function(a,
b,c){c||(c=qwebirc.ui.WINDOW_CUSTOM);a=this.newWindow(c,a);b&&this.selectWindow(a);return a},addPane:function(a){var b=qwebirc.ui.Panes[a].title,c=this.getWindowIdentifier(qwebirc.ui.WINDOW_CUSTOM,b);if(this.session.windows[c])this.selectWindow(this.session.windows[c]);else return b=this.newCustomWindow(b,!0),b.lines.addClass("qwebirc-pane"+a),a=new qwebirc.ui.Panes[a].pclass(this.session,b),b.setSubWindow(a),b},connectWindow:function(a){var b=this.addPane("Connect");b.subWindow.connectCallback=function(c){ui.closeWindow(b);
a(c)}},urlDispatcher:function(a){return"embedded"==a?["a",this.embeddedWindow.bind(this)]:"options"==a?["a",this.optionsWindow.bind(this)]:"whois"==a?["span",function(a){conf.ui.nick_click_query?this.session.irc.exec("/QUERY "+a):this.session.irc.exec("/WHOIS "+a)}.bind(this)]:"accinfo"==a?["span",function(a){this.session.irc.exec("/MSG NickServ INFO "+a)}.bind(this)]:null},tabComplete:function(a){this.tabCompleter.tabComplete(a)},resetTabComplete:function(){this.tabCompleter.reset()},setModifiableStylesheet:function(a){this.__styleSheet=
new qwebirc.ui.style.ModifiableStylesheet(conf.frontend.static_base_url+"css/"+a+qwebirc.FILE_SUFFIX+".mcss");this.setModifiableStylesheetValues(conf.ui.fg_color,conf.ui.fg_sec_color,conf.ui.bg_color)},setModifiableStylesheetValues:function(a,b,c){var d=new Color(a),e=new Color(b),g=new Color(c),f=1;d.hsb[2]>g.hsb[2]&&(f=-1);$defined(this.__styleSheet)&&this.__styleSheet.set(function(a){return a.setHue(-180+a.hsb[0]+d.hsb[0]).setSaturation(d.hsb[1]+(a.hsb[1]-50)*f).setBrightness(d.hsb[2]+(a.hsb[2]-
50)*f)},function(a){return a.setHue(-180+a.hsb[0]+e.hsb[0]).setSaturation(e.hsb[1]+(a.hsb[1]-50)*f).setBrightness(e.hsb[2]+(a.hsb[2]-50)*f)},function(a){return a.setHue(-180+a.hsb[0]+g.hsb[0]).setSaturation(g.hsb[1]+(a.hsb[1]-50)*f).setBrightness(g.hsb[2]+(a.hsb[2]-50)*f)})}});
qwebirc.ui.NotificationUI=new Class({Extends:qwebirc.ui.StandardUI,initialize:function(a,b,c,d){this.parent(a,b,c,d);this.__beeper=new qwebirc.ui.Beeper(a);this.__flasher=new qwebirc.ui.Flasher(a);this.beep=this.__beeper.beep.bind(this.__beeper);this.flash=this.__flasher.flash.bind(this.__flasher);this.cancelFlash=this.__flasher.cancelFlash.bind(this.__flasher)},setBeepOnMention:function(a){a&&this.__beeper.soundInit()},updateTitle:function(a){this.__flasher.updateTitle(a)&&this.parent(a)},focusChange:function(a){this.parent(a);
this.__flasher.focusChange(a)}});qwebirc.ui.RootUI=qwebirc.ui.NotificationUI;
qwebirc.ui.RequestTransformHTML=function(a,b){var c={IMG:1},d=b.update,e=b.onSuccess,g=function(a){if(1==a.nodeType){var b=a.nodeName.toUpperCase();if(c[b]){var b=a.getAttribute("transform_attr"),d=a.getAttribute("transform_value");$defined(b)&&$defined(d)&&(a.removeAttribute("transform_attr"),a.removeAttribute("transform_value"),a.setAttribute(b,conf.frontend.static_base_url+d))}for(b=0;b<a.childNodes.length;b++)g(a.childNodes[b])}};delete b.update;b.onSuccess=function(a,b,c,m){a=new Element("div");
a.set("html",c);g(a);for(d.empty();0<a.childNodes.length;)c=a.firstChild,a.removeChild(c),d.appendChild(c);e()};return new Request.HTML(b)};qwebirc.ui.HILIGHT_NONE=0;qwebirc.ui.HILIGHT_ACTIVITY=1;qwebirc.ui.HILIGHT_SPEECH=2;qwebirc.ui.HILIGHT_US=3;qwebirc.ui.WINDOW_LASTLINE=qwebirc.ui.WINDOW_QUERY|qwebirc.ui.WINDOW_MESSAGES|qwebirc.ui.WINDOW_CHANNEL|qwebirc.ui.WINDOW_STATUS;
qwebirc.ui.Window=new Class({Implements:[Events],initialize:function(a,b,c,d){this.session=a;this.type=b;this.name=c;this.active=!1;this.identifier=d;this.hilighted=qwebirc.ui.HILIGHT_NONE;this.scrolltimer=null;this.commandhistory=ui.commandhistory;this.scrolleddown=!0;this.scrollpos=null;this.lastNickHash={};this.subWindow=this.lastSelected=null;this.closed=!1;this.type&qwebirc.ui.WINDOW_LASTLINE&&(this.lastPositionLine=new Element("hr"),this.lastPositionLine.addClass("lastpos"),this.lastPositionLineInserted=
!1)},updateTopic:function(a,b){qwebirc.ui.Colourise(this.session,"["+a+"]",b)},subEvent:function(a){$defined(this.subWindow)&&this.subWindow.fireEvent(a)},setSubWindow:function(a){this.subWindow=a},select:function(){this.lastPositionLineInserted&&!conf.ui.lastpos_line&&(this.lines.removeChild(this.lastPositionLine),this.lastPositionLineInserted=!1);this.active=!0;ui.__setActiveWindow(this);this.hilighted&&this.setHilighted(qwebirc.ui.HILIGHT_NONE);this.subEvent("select");this.resetScrollPos();this.lastSelected=
new Date},deselect:function(){this.subEvent("deselect");this.setScrollPos();$defined(this.scrolltimer)&&($clear(this.scrolltimer),this.scrolltimer=null);this.type&qwebirc.ui.WINDOW_LASTLINE&&this.replaceLastPositionLine();this.active=!1},resetScrollPos:function(){this.scrolleddown?this.scrollToBottom():$defined(this.scrollpos)&&this.getScrollParent().scrollTo(this.scrollpos.x,this.scrollpos.y)},setScrollPos:function(){ui.singleWindow||(this.scrolleddown=this.scrolledDown(),this.scrollpos=this.lines.getScroll())},
addLine:function(a,b,c,d){c=qwebirc.ui.HILIGHT_NONE;var e=!1;if(a&&(c=qwebirc.ui.HILIGHT_ACTIVITY,a.match(/(NOTICE|ACTION|MSG)$/))){if(this.type==qwebirc.ui.WINDOW_QUERY||this.type==qwebirc.ui.WINDOW_MESSAGES)a.match(/^OUR/)||a.match(/NOTICE$/)?c=qwebirc.ui.HILIGHT_ACTIVITY:(c=qwebirc.ui.HILIGHT_US,ui.beep(),ui.flash());!a.match(/^OUR/)&&this.session.irc.hilightController.match(b.m)?(e=!0,c=qwebirc.ui.HILIGHT_US,ui.beep(),ui.flash()):c!=qwebirc.ui.HILIGHT_US&&(c=qwebirc.ui.HILIGHT_SPEECH)}this.active||
c==qwebirc.ui.HILIGHT_NONE||this.setHilighted(c);a&&(b=ui.theme.message(a,b,e));qwebirc.ui.Colourise(this.session,qwebirc.irc.IRCTimestamp(new Date)+" "+b,d);this.scrollAdd(d)},errorMessage:function(a){this.addLine("",a,"warncolour")},infoMessage:function(a){this.addLine("",a,"infocolour")},setHilighted:function(a){if(a==qwebirc.ui.HILIGHT_NONE||a>=this.hilighted)this.hilighted=a},scrolledDown:function(){if(this.scrolltimer)return!0;var a=this.lines,b=a.getScroll(),c=a.getScrollSize().y,a=a.clientHeight;
c<a&&(c=a);return b.y+a==c},getScrollParent:function(){var a=this.lines;$defined(this.scroller)&&(a=this.scroller);return a},scrollToBottom:function(){if(this.type!=qwebirc.ui.WINDOW_CUSTOM){var a=this.lines;this.getScrollParent().scrollTo(a.getScroll().x,a.getScrollSize().y)}},scrollAdd:function(a){var b=this.lines;if($defined(a)){var c=this.scrolledDown();b.appendChild(a);c&&(this.scrolltimer&&$clear(this.scrolltimer),this.scrolltimer=this.scrollAdd.delay(50,this,[null]))}else this.scrollToBottom(),
this.scrolltimer=null},updateNickList:function(a){for(var b={},c={},d=this.lastNickHash,e=0;e<a.length;e++)c[a[e]]=1;for(var g in d)c[g]||this.nickListRemove(g,d[g]);for(e=0;e<a.length;e++)c=a[e],g=d[c],g||(g=this.nickListAdd(c,e))||(g=1),b[c]=g;this.lastNickHash=b},nickListAdd:function(a,b){},nickListRemove:function(a,b){},historyExec:function(a){this.commandhistory.addLine(a);this.session.irc.exec(a)},focusChange:function(a){!0!=a&&this.type&qwebirc.ui.WINDOW_LASTLINE&&this.replaceLastPositionLine()},
replaceLastPositionLine:function(){if(conf.ui.lastpos_line)if(!this.lastPositionLineInserted)this.scrollAdd(this.lastPositionLine);else{if(this.lines.lastChild!=this.lastPositionLine){try{this.lines.removeChild(this.lastPositionLine)}catch(a){}this.scrollAdd(this.lastPositionLine)}}else this.lastPositionLineInserted&&this.lines.removeChild(this.lastPositionLine);this.lastPositionLineInserted=conf.ui.lastpos_line}});qwebirc.ui.Colourise=function(a,b,c){function d(a,b){if(!("0"<=a[b+1]&&"9">=a[b+1]))return h=f=void 0,b;b++;"0"<=a[b+1]&&"9">=a[b+1]?(f=parseInt(a[b]+a[b+1]),b++):f=parseInt(a[b]);if(","!=a[b+1]||!("0"<=a[b+2]&&"9">=a[b+2]))return b;b+=2;"0"<=a[b+1]&&"9">=a[b+1]?(h=parseInt(a[b]+a[b+1]),b++):h=parseInt(a[b]);return b}function e(){var b="";0<n.length&&(b=qwebirc.ui.urlificate(a,p,n.join("")),c.appendChild(p),n=[]);p=document.createElement("span");return b}function g(){if(l)return p;var a=[];void 0!=
f&&a.push("Xc"+f);void 0!=h&&a.push("Xbc"+h);m&&a.push("Xb");k&&a.push("Xu");p.className=a.join(" ")}var f,h,k=!1,m=!1,l=!1,n=[];b=b.split("");var p=document.createElement("span");c.addClass("colourline");for(var t=conf.ui.nick_colors,y=!1,v=0;v<b.length;v++){var u=b[v];if(t)if(y){"\x00"!=u?n.push(u):(l=!0,y=g(),u=e().toHSBColour(a),$defined(u)&&(y.style.color=u.rgbToHex()),y=l=!1);continue}else{if("\x00"==u){y=!0;e();continue}}else if("\x00"==u)continue;"\u0002"==u?(e(),m=!m,g()):"\u001f"==u?(e(),
k=!k,g()):"\u000f"==u?(e(),h=f=void 0,m=k=!1):"\u0003"==u?(e(),v=d(b,v),15<h&&(h=void 0),15<f&&(f=void 0),g()):n.push(u)}e()};String.prototype.toHSBColour=function(a){var b=a.irc.toIRCLower(a.irc.stripPrefix(this));if(b==a.irc.lowerNickname)return null;for(var c=a=0;c<b.length;c++)a=31*a+b.charCodeAt(c);b=Math.abs(a)%360;return new Color([b,70,60],"hsb")};qwebirc.ui.create=function(a,b){session=new qwebirc.session;window.addEvent("domready",function(){ui=new b(this.session,$(a));ui.connectWindow(function(a){session.irc=new qwebirc.irc.IRCClient(session,a);session.irc.connect();window.onbeforeunload=qwebirc.ui.onbeforeunload;window.addEvent("unload",function(){session.irc.quit("Web client closed")})});conf.atheme.chan_list_on_start&&qwebirc.ui.Panes.List&&ui.addPane("List")})};
qwebirc.ui.onbeforeunload=function(a){if(qwebirc.connected){if(a=a||window.event)a.returnValue="This action will close all active IRC connections.";return"This action will close all active IRC connections."}};qwebirc.ui.MENU_ITEMS=function(){var a=function(a){return this.session.irc.nickOnChanHasAtLeastPrefix(this.session.irc.nickname,this.name,"+",!0)},b=function(a){return this.session.irc.nickOnChanHasAtLeastPrefix(this.session.irc.nickname,this.name,"@",!1)},c=function(a){return this.session.irc.nickOnChanHasPrefix(a,this.name,"@")},d=function(a){return this.session.irc.nickOnChanHasPrefix(a,this.name,"+")},e=qwebirc.util.invertFn,g=qwebirc.util.composeAnd,f=function(a){return function(b){this.session.irc.exec("/"+
a+" "+b)}};return[{text:"PM",fn:f("query"),predicate:!0},{text:"whois",fn:f("whois"),predicate:!0},{text:"kick",fn:function(a){this.session.irc.exec("/KICK "+a+" wibble")},predicate:a},{text:"op",fn:f("op"),predicate:g(b,e(c))},{text:"deop",fn:f("deop"),predicate:g(b,c)},{text:"voice",fn:f("voice"),predicate:g(a,e(d))},{text:"devoice",fn:f("devoice"),predicate:g(a,d)}]};qwebirc.ui.HilightController=new Class({initialize:function(a){this.session=a;this.prevnick=this.regex=null},match:function(a){var b=this.session.irc.nickname;b!=this.prevnick&&(this.regex=RegExp("(^|[\\s\\.,;:])"+RegExp.escape(b)+"([\\s\\.,;:]|$)","i"));return a.match(this.regex)?!0:!1}});
qwebirc.ui.Beeper=new Class({initialize:function(a){this.session=a;this.soundReady=this.soundInited=!1;conf.ui.beep_on_mention&&this.soundInit()},soundInit:function(){this.soundInited||!$defined(Browser.Plugins.Flash)||8>Browser.Plugins.Flash.version||(this.soundInited=!0,this.soundPlayer=new qwebirc.sound.SoundPlayer(this.session),this.soundPlayer.addEvent("ready",function(){this.soundReady=!0}.bind(this)),this.soundPlayer.go())},beep:function(){this.soundReady&&conf.ui.beep_on_mention&&this.soundPlayer.beep()}});
qwebirc.ui.Flasher=new Class({initialize:function(a){this.session=a;this.windowFocused=!1;this.canUpdateTitle=!0;this.titleText=document.title;a=this._getFavIcon();$defined(a)?(this.favIcon=a,this.favIconParent=a.parentNode,this.favIconVisible=!0,this.emptyFavIcon=new Element("link"),this.emptyFavIcon.rel="shortcut icon",this.emptyFavIcon.href=conf.frontend.static_base_url+"images/empty_favicon.ico",this.emptyFavIcon.type="image/x-icon",this.flashing=!1,this.canFlash=!0,document.addEvent("mousedown",
this.cancelFlash.bind(this)),document.addEvent("keydown",this.cancelFlash.bind(this))):this.canFlash=!1},_getFavIcon:function(){for(var a=$$("head link"),b=0;b<a.length;b++)if("shortcut icon"==a[b].getAttribute("rel"))return a[b]},flash:function(){if(conf.ui.flash_on_mention&&!this.windowFocused&&this.canFlash&&!this.flashing){this.titleText=document.title;var a=function(){this.hideFavIcon();this.canUpdateTitle=!1;document.title="Activity!";this.flasher=b.delay(500)}.bind(this),b=function(){this.showFavIcon();
this.canUpdateTitle=!0;document.title=this.titleText;this.flasher=a.delay(500)}.bind(this);this.flashing=!0;a()}},cancelFlash:function(){this.canFlash&&$defined(this.flasher)&&(this.flashing=!1,$clear(this.flasher),this.flasher=null,this.showFavIcon(),document.title=this.titleText,this.canUpdateTitle=!0)},hideFavIcon:function(){this.favIconVisible&&(this.favIconVisible=!1,this.favIconParent.removeChild(this.favIcon),this.favIconParent.appendChild(this.emptyFavIcon))},showFavIcon:function(){this.favIconVisible||
(this.favIconVisible=!0,this.favIconParent.removeChild(this.emptyFavIcon),this.favIconParent.appendChild(this.favIcon))},updateTitle:function(a){this.titleText=a;return this.canUpdateTitle},focusChange:function(a){(this.windowFocused=a)&&this.cancelFlash()}});qwebirc.ui.supportsFocus=function(a){a=navigator.userAgent;return $defined(a)?Browser.Engine.ipod||-1!=a.indexOf("Konqueror")?!1:!0:!0};
qwebirc.options.Input=new Class({initialize:function(a,b,c,d,e){this.session=a;this.options=b;this.option=d;this.value=conf[d.category][d.option];this.enabled=!0;this.position=e;this.parentElement=c;this.id=qwebirc.util.generateID();$defined(this.option.isEnabled)&&(this.enabled=this.option.isEnabled(a));this.render()},createInput:function(a,b,c,d){$defined(b)||(b=this.parentElement);return qwebirc.util.createInput(a,b,c,d,this.id)},FE:function(a,b){var c=new Element(a);$defined(b)||(b=this.parentElement);
b.appendChild(c);return c},focus:function(){this.mainElement.focus()},onChange:function(){if($defined(this.option.onChange))this.option.onChange(this.session,this.options,this.get())}});qwebirc.options.TextInput=new Class({Extends:qwebirc.options.Input,render:function(){var a=this.createInput("text");a.addEvent("change",function(a){this.value=a;this.onChange()}.bind(this));this.mainElement=a;a.value=this.value;a.disabled=!this.enabled},get:function(){return this.mainElement.value}});
qwebirc.options.ColorInput=new Class({Extends:qwebirc.options.Input,render:function(){this.hexbox=null;"#"!=this.value[0]&&(this.value="#"+this.value);var a=new Element("div");a.addClass("qwebirc-optionspane");a.addClass("hue-slider");this.parentElement.appendChild(a);var b=new Element("div");b.addClass("qwebirc-optionspane");b.addClass("sat-slider");var c=new Element("div");c.addClass("qwebirc-optionspane");c.addClass("light-slider");var d=new Element("form",{"class":"hexform"});this.hexbox=new Element("input",
{value:this.value});d.appendChild(this.hexbox);var e=new Element("input",{type:"button",value:"Reset to Default"});conf.ui.simple_color||(this.parentElement.appendChild(b),this.parentElement.appendChild(c),this.parentElement.appendChild(d),this.parentElement.appendChild(e));var g=new Color(this.value),f=new Element("div");f.addClass("knob");Browser.Engine.trident&&(f.setStyle("top","0px"),f.setStyle("background-color","black"));a.appendChild(f);var h=new Slider(a,f,{steps:36,range:[0,369],wheel:!0});
h.set(g.hsb[0]);f=new Element("div");f.addClass("knob");Browser.Engine.trident&&(f.setStyle("top","0px"),f.setStyle("background-color","black"));b.appendChild(f);var k=new Slider(b,f,{steps:50,range:[0,100],wheel:!0});k.set(g.hsb[1]);f=new Element("div");f.addClass("knob");Browser.Engine.trident&&(f.setStyle("top","0px"),f.setStyle("background-color","black"));c.appendChild(f);var m=new Slider(c,f,{steps:50,range:[0,100],wheel:!0});m.set(g.hsb[2]);b=function(a){this.value=$HSB(h.step,k.step,m.step).rgb.rgbToHex();
this.onChange()}.bind(this);this.enabled&&(h.addEvent("change",b),k.addEvent("change",b),m.addEvent("change",b),d.addEvent("submit",function(a){(new Event(a)).stop();a=new Color(this.hexbox.value);h.set(a.hsb[0]);k.set(a.hsb[1]);m.set(a.hsb[2])}.bind(this)),e.addEvent("click",function(a){(new Event(a)).stop();this.value=conf[this.option.category][this.option.option+"_default"];a=new Color(this.value);h.set(a.hsb[0]);k.set(a.hsb[1]);m.set(a.hsb[2])}.bind(this)));this.mainElement=a;this.startValue=
this.value},onChange:function(){this.hexbox.value=this.get();if($defined(this.option.onChange))this.option.onChange(this.session,this.options,this.get())},get:function(){return this.value},cancel:function(){this.value=this.startValue;this.get()}});
qwebirc.options.CheckInput=new Class({Extends:qwebirc.options.Input,render:function(){var a=this.createInput("checkbox");a.addEvent("change",function(a){this.value=a;this.onChange()}.bind(this));this.mainElement=a;a.checked=this.value;a.disabled=!this.enabled},get:function(){return this.mainElement.checked}});
qwebirc.options.RadioInput=new Class({Extends:qwebirc.options.Input,render:function(){var a=this.option.options;this.elements=[];for(var b=0;b<a.length;b++){var c=this.FE("div"),d=this.createInput("radio",c,"options_radio"+this.position,b==this.option.position);this.elements.push(d);d.disabled=!this.enabled;var e=b;d.addEvent("change",function(a){a&&(this.option.position=e,this.onChange())}.bind(this));0==b&&(this.mainElement=d);c.appendChild(document.createTextNode(a[b][0]))}},get:function(){for(var a=
0;a<this.elements.length;a++)if(this.elements[a].checked)return this.option.position=a,this.option.options[a][1]}});
qwebirc.options.Options=[{category:"ui",option:"beep_on_mention",label:"Beep when nick mentioned or on query activity (requires Flash)",isEnabled:function(a){return!$defined(Browser.Plugins.Flash)||8>Browser.Plugins.Flash.version?!1:!0},onSave:function(a){ui.updateBeepOnMention&&ui.updateBeepOnMention()}},{category:"ui",option:"dedicated_msg_window",label:"Send privmsgs to dedicated messages window"},{category:"ui",option:"dedicated_notice_window",label:"Send notices to dedicated message window"},
{category:"ui",option:"flash_on_mention",label:"Flash titlebar when nick mentioned or on query activity",isEnabled:qwebirc.ui.supportsFocus},{category:"ui",option:"lastpos_line",label:"Show a last position indicator for each window",isEnabled:qwebirc.ui.supportsFocus},{category:"ui",option:"nick_colors",label:"Automatically colour nicknames"},{category:"ui",option:"nick_status",label:"Show status symbol before nicknames in channel lines"},{category:"ui",option:"nick_click_query",label:"Open a PM window on clicking a nickname in channel"},
{category:"ui",option:"hide_joinparts",label:"Hide JOINS/PARTS/QUITS"},{category:"ui",option:"fg_color",type:qwebirc.options.ColorInput,label:"Adjust main foreground color",onChange:function(a,b,c){ui.setModifiableStylesheetValues(c,b["ui.fg_sec_color"].get(),b["ui.bg_color"].get())},isEnabled:function(a){return!conf.ui.simple_color}},{category:"ui",option:"fg_sec_color",type:qwebirc.options.ColorInput,label:"Adjust title/link foreground color",onChange:function(a,b,c){ui.setModifiableStylesheetValues(b["ui.fg_color"].get(),
c,b["ui.bg_color"].get())},isEnabled:function(a){return!conf.ui.simple_color}},{category:"ui",option:"bg_color",type:qwebirc.options.ColorInput,label:"Adjust background color",onChange:function(a,b,c){$defined(b["ui.fg_color"])?ui.setModifiableStylesheetValues(b["ui.fg_color"].get(),b["ui.fg_sec_color"].get(),c):ui.setModifiableStylesheetValues(conf.ui.fg_color,conf.ui.fg_sec_color,c)},onSave:function(a){ui.setModifiableStylesheetValues(conf.ui.fg_color,conf.ui.fg_sec_color,conf.ui.bg_color)},onCancel:function(a){ui.setModifiableStylesheetValues(conf.ui.fg_color,
conf.ui.fg_sec_color,conf.ui.bg_color)}}];qwebirc.ui.Panes={};qwebirc.ui.style.ModifiableStylesheet=new Class({initialize:function(a){a=this.__parseStylesheet(this.__getStylesheet(a));this.__cssText=a.cssText;this.rules=a.rules;this.__tag=this.__createTag()},__createTag:function(){var a=document.createElement("style");a.type="text/css";a.media="all";document.getElementsByTagName("head")[0].appendChild(a);return a},__getStylesheet:function(a){a=new Request({url:a,async:!1});var b;a.addEvent("complete",function(a){b=a});a.get();return b},__setStylesheet:function(a){var b=
this.__tag;if(b.styleSheet)b.styleSheet.cssText=a;else for(a=document.createTextNode(a),b.appendChild(a);1<b.childNodes.length;)b.removeChild(b.firstChild)},__parseStylesheet:function(a){a=a.replace("\r\n","\n").split("\n");var b={},c;for(c=0;c<a.length;c++){var d=a[c];if(""===d.trim())break;d=d.splitMax("=",2);2==d.length&&(b[d[0]]=d[1])}for(d=[];c<a.length;c++)d.push(a[c]);return{cssText:d.join("\n"),rules:b}},set:function(a,b,c){a||(a=function(a){return a});b||(b=a);c||(c=function(a){return a});
var d=this.__cssText,e;for(e in this.rules){var g;g="fg_sec_"==e.substring(7,0)?b(new Color(this.rules[e])):"fg_"==e.substring(3,0)?a(new Color(this.rules[e])):c(new Color(this.rules[e]));"255,255,255"==g&&(g="255,255,254");d=d.replaceAll("$("+e+")","rgb("+g+")")}this.__setStylesheet(d)}});qwebirc.ui.TabCompleterFactory=new Class({initialize:function(a){this.session=a;this.reset()},tabComplete:function(a){var b=a.value;if(!$defined(this.obj)){this.incr=1;var c=ui.getActiveWindow();if(!c)return;var d=qwebirc.util.getEnclosedWord(b,qwebirc.util.getCaretPos(a)),e="",g="",f="";$defined(d)&&(e=b.substring(0,d[0]),g=d[1],f=b.substring(d[0]+g.length));d=b.toLowerCase();if(""==b)e="/msg ",obj=qwebirc.ui.QueryTabCompleter;else if(session.irc.isChannel(g))obj=qwebirc.ui.ChannelNameTabCompleter;
else if(d.match(/^\/(q|query|msg) /i))obj=qwebirc.ui.QueryTabCompleter;else if(c.type==qwebirc.ui.WINDOW_QUERY)obj=qwebirc.ui.QueryNickTabCompleter;else if(c.type==qwebirc.ui.WINDOW_CHANNEL)""==e&&(f=""!=f&&" "==f.charAt(0)?":"+f:": "+f,this.incr++),obj=qwebirc.ui.ChannelUsersTabCompleter;else return;""==f&&(f=" ");this.obj=new obj(session,e,g,f,c);if(!$defined(this.obj))return}b=this.obj.get();$defined(b)&&(a.value=b[1],qwebirc.util.setCaretPos(a,b[0]+this.incr))},reset:function(){this.obj=null}});
qwebirc.ui.TabIterator=new Class({initialize:function(a,b,c){this.prefix=b;if($defined(c)&&0!=c.length){var d=[];b=qwebirc.irc.toIRCCompletion(a,b);for(var e=0;e<c.length;e++)qwebirc.irc.toIRCCompletion(a,c[e]).startsWith(b)&&d.push(c[e]);this.list=d}else this.list=null;this.pos=-1},next:function(){if(!$defined(this.list))return null;this.pos+=1;this.pos>=this.list.length&&(this.pos=0);return this.list[this.pos]}});
qwebirc.ui.BaseTabCompleter=new Class({initialize:function(a,b,c,d,e){this.existingNick=c;this.prefix=b;this.suffix=d;this.iterator=new qwebirc.ui.TabIterator(a,c,e)},get:function(){var a=this.iterator.next();if(!$defined(a))return null;a=this.prefix+a;return[a.length,a+this.suffix]}});qwebirc.ui.QueryTabCompleter=new Class({Extends:qwebirc.ui.BaseTabCompleter,initialize:function(a,b,c,d){this.parent(a,b,c,d,a.irc.lastNicks)}});
qwebirc.ui.QueryNickTabCompleter=new Class({Extends:qwebirc.ui.BaseTabCompleter,initialize:function(a,b,c,d){this.parent(a,b,c,d,[window.name])}});qwebirc.ui.ChannelNameTabCompleter=new Class({Extends:qwebirc.ui.BaseTabCompleter,initialize:function(a,b,c,d){var e=[],g;for(g in a.irc.channels){var f=a.windows[g];$defined(f)&&(f=f.lastSelected);e.push([f,g])}e.sort(function(a,b){return b[0]-a[0]});g=[];for(f=0;f<e.length;f++)g.push(e[f][1]);this.parent(a,b,c,d,g)}});
qwebirc.ui.ChannelUsersTabCompleter=new Class({Extends:qwebirc.ui.BaseTabCompleter,initialize:function(a,b,c,d,e){e=a.irc.tracker.getSortedByLastSpoke(ui.getActiveWindow().name);this.parent(a,b,c,d,e)}});qwebirc.ui.themes.ThemeControlCodeMap={C:"\u0003",B:"\u0002",U:"\u001f",O:"\u000f","{":"\x00","}":"\x00","[":"qwebirc://whois/","]":"/",$:"$"};
qwebirc.ui.themes.Default={PREFIX:["$C4==$O "],SIGNON:["Signed on!",!0],CONNECT:["Connected to server.",!0],RAW:["$m",!0],DISCONNECT:["Disconnected from server: $m",!0],ERROR:["ERROR: $m",!0],SERVERNOTICE:["$m",!0],JOIN:["${$N$} [$h] has joined $c",!0],OURJOIN:["${$N$} [$h] has joined $c",!0],PART:["${$N$} [$h] has left $c [$m]",!0],KICK:["${$v$} was kicked from $c by ${$N$} [$m]",!0],MODE:["mode/$c [$m] by ${$N$}",!0],QUIT:["${$N$} [$h] has quit [$m]",!0],NICK:["${$n$} has changed nick to ${$[$w$]$}",
!0],TOPIC:["${$N$} changed the topic of $c to: $m",!0],UMODE:["Usermode change: $m",!0],INVITE:["$N invites you to join $c",!0],HILIGHT:["$C4"],HILIGHTEND:["$O"],CHANMSG:["<${$@$($N$)$}> $m"],PRIVMSG:["<$($N$)> $m"],CHANNOTICE:["-${$($N$)$}:$c- $m"],PRIVNOTICE:["-$($N$)- $m"],OURCHANMSG:["<$@$N> $m"],OURPRIVMSG:["<$N> $m"],OURTARGETEDMSG:["*$[$t$]* $m"],OURTARGETEDNOTICE:["[notice($[$t$])] $m"],OURCHANNOTICE:["-$N:$t- $m"],OURPRIVNOTICE:["-$N- $m"],OURCHANACTION:[" * $N $m"],OURPRIVACTION:[" * $N $m"],
CHANACTION:[" * ${$($N$)$} $m"],PRIVACTION:[" * $($N$) $m"],CHANCTCP:["$N [$h] requested CTCP $x from $c: $m"],PRIVCTCP:["$N [$h] requested CTCP $x from $-: $m"],CTCPREPLY:["CTCP $x reply from $N: $m"],OURCHANCTCP:["[ctcp($t)] $x $m"],OURPRIVCTCP:["[ctcp($t)] $x $m"],OURTARGETEDCTCP:["[ctcp($t)] $x $m"],WHOISUSER:["$B$N$B [$h]",!0],WHOISREALNAME:[" realname : $m",!0],WHOISCHANNELS:[" channels : $m",!0],WHOISSERVER:[" server   : $x [$m]",!0],WHOISACCOUNT:[" account  : qwebirc://accinfo/$m",!0],WHOISIDLE:[" idle     : $x [connected: $m]",
!0],WHOISAWAY:[" away     : $m",!0],WHOISOPER:[" oper     : $BIRC Operator$B",!0],WHOISOPERNAME:[" operedas : $m",!0],WHOISACTUALLY:[" realhost : $m [ip: $x]",!0],WHOISAVAILHELP:[" oper     : is available for help.",!0],WHOISREGGED:[" regged   : has a registered nick.",!0],WHOISMODES:[" modes    : $m",!0],WHOISREALHOST:[" realhost : $m ($x)",!0],WHOISGENERICTEXT:[" info     : $m",!0],WHOISEND:["End of WHOIS",!0],AWAY:["$N is away: $m",!0],GENERICERROR:["$m: $t",!0],GENERICMESSAGE:["$m",!0],WALLOPS:["WALLOP $n: $t",
!0],CHANNELCREATIONTIME:["Channel $c was created at: $m",!0],CHANNELMODEIS:["Channel modes on $c are: $m",!0]};
qwebirc.ui.Theme=new Class({initialize:function(a){this.__theme=qwebirc.util.dictCopy(qwebirc.ui.themes.Default);if(a)for(var b in a)this.__theme[b]=a[b];for(b in this.__theme)"PREFIX"!=b&&(a=this.__theme[b],this.__theme[b]=a[1]?this.__theme.PREFIX+a[0]:a[0]);this.__ccmap=qwebirc.util.dictCopy(qwebirc.ui.themes.ThemeControlCodeMap);this.__ccmaph=qwebirc.util.dictCopy(this.__ccmap);this.__ccmaph["("]=this.message("HILIGHT",{},this.__ccmap);this.__ccmaph[")"]=this.message("HILIGHTEND",{},this.__ccmap);
this.__ccmaph["{"]=this.__ccmaph["}"]=""},__dollarSubstitute:function(a,b,c){var d=[];a=a.split("");for(var e=0;e<a.length;e++){var g=a[e];if("$"==g&&e<=a.length-1){var g=a[++e],f=c[g];f||(f=b[g]);f&&d.push(f)}else d.push(g)}return d.join("")},message:function(a,b,c){c=c?this.__ccmaph:this.__ccmap;b&&b.n&&(b.N="qwebirc://whois/"+b.n+"/");return this.__dollarSubstitute(this.__theme[a],b,c)}});qwebirc.ui.urlificate=function(a,b,c){var d=/[[\)|\]]?(\.*|[\,;])$/,e=[],g=function(a,b,c,d){for(;;){var e=a.search(b);if(-1==e){c(a);break}var f=a.match(b),g=a.substring(0,e),f=f[0];a=a.substring(e+f.length);c(g);(g=d(f,c))||(g="");a=g+a}},f=function(a){var c={":)":"twilightsmile.gif",";)":"raritywink.gif",":D":"rainbowlaugh.gif",":P":"derpytongue2.gif",":(":"fluttershysad.gif",":$":"twilightblush.gif",":O":"pinkiegasp.gif",":|":"trixieshiftleft.gif",":'(":"fluttercry.gif",":S":"unsuresweetie.gif",
":[":"flutterrage.gif","<3":"heart.gif","6_9":"derpyderp1.gif",">_>":"aj-lie-1.gif","<_<":"aj-lie-2.gif"};a=a.split(/(:\)|;\)|:D|:P|:\(|:\$|:O|:\||:'\(|:S|:\[|<3|6_9|>_>|<_<|  )/);for(var d=0;d<a.length;d++){if("  "==a[d]){var e=new Element("span");e.set("html","&nbsp;&nbsp;")}else c[a[d]]?(e=document.createElement("img"),e.setAttribute("src","https://d1zza4deob1qzz.cloudfront.net/themes/ponychat/images/emoticons/pony/"+c[a[d]]),e.setAttribute("alt",a[d]),e.setAttribute("title",a[d])):e=document.createTextNode(a[d]);
b.appendChild(e)}},h=function(c){var f=c.replace(d,"");e.push(f);c=c.substring(f.length);var g=new Element("span");g.href="#";g.addClass("hyperlink-channel");g.addEvent("click",function(b){(new Event(b)).stop();a.irc?a.irc.exec("/JOIN "+f):(b=ui.getWindow(qwebirc.ui.WINDOW_CUSTOM,"Connect"))&&!b.subWindow.connectChannel(f)&&(ui.selectWindow(b),b.subWindow.nickBox.focus())});g.appendChild(document.createTextNode(f));b.appendChild(g);return c};g(c,/\b((https?|ftp|qwebirc):\/\/|www\.)[^ ]+/,function(a){g(a,
/\B#[^ ,]+/,f,h)},function(a,c){var f=a.replace(d,""),g=a.substring(f.length),h=null,t="_blank",y=f,v="a",u,z=f.match(/^qwebirc:\/\/(.*)$/);if(z){z=z[1].match(/^([^\/]+)\/([^\/]+)\/?(.*)$/);if(!z){c(a);return}if(t=ui.urlDispatcher(z[1]))u=z[1],v=t[0],f="a"!=t[0]?null:"#",h=t[1],y=unescape(z[2]),t=null;else{c(a);return}z[3]&&(g=z[3]+g)}else f.match(/^www\./)&&(f="http://"+f);v=new Element(v);u&&v.addClass("hyperlink-"+u);f&&(v.href=f,t&&(v.target=t));e.push(y);v.appendChild(document.createTextNode(y));
b.appendChild(v);$defined(h)?v.addEvent("click",function(a){(new Event(a)).stop();h(y)}):v.addEvent("click",function(a){(new Event(a)).stopPropagation()});return g});return e.join("")};qwebirc.ui.Panes.About={title:"About",command:function(a){return"ABOUT"},menuitem:function(a){return"About Iris"},menupos:600};
qwebirc.ui.Panes.About.pclass=new Class({Implements:[Events],session:null,initialize:function(a,b){this.session=a;var c=function(){b.lines.set("html",'<div class="loading">Loading. . .</div>')}.delay(500);qwebirc.ui.RequestTransformHTML(a,{url:conf.frontend.static_base_url+"panes/about.html",update:b.lines,onSuccess:function(){$clear(c);b.lines.getElement("input[class=close]").addEvent("click",function(){ui.closeWindow(b)});b.lines.getElement("span[class=version]").set("text","v"+qwebirc.VERSION)}}).get()}});qwebirc.ui.Panes.Connect={title:"Connect",command:function(a){return null},menuitem:function(a){return null}};
qwebirc.ui.Panes.Connect.pclass=new Class({Implements:[Events],session:null,parent:null,connectCallback:null,nickBox:null,chanBox:null,initialize:function(a,b){this.session=a;this.parent=b.lines;!conf.frontend.prompt&&conf.frontend.initial_nick&&conf.frontend.initial_chans?this.createConfirmBox():this.createLoginBox(null)},connectChannel:function(a){if(conf.frontend.chan_autoconnect&&(conf.frontend.initial_nick||this.nickBox&&this.nickBox.value))return this.connect(a),!0;null!=this.chanBox?this.chanBox.set("value",
a):this.createLoginBox(a);return!1},connect:function(a){for(;0<this.parent.childNodes.length;)this.parent.removeChild(this.parent.firstChild);var b={};b.nickname=null!=this.nickBox?this.nickBox.value:conf.frontend.initial_nick;b.autojoin=null!=a?a:null!=this.chanBox?this.chanBox.value:conf.frontend.initial_chans;this.session.atheme.state&&(b.authUser=this.session.atheme.user,b.authSecret=this.session.atheme.secret);this.connectCallback(b)},autoFocus:function(a){try{window.self===window.top&&a.focus()}catch(b){}},
createConfirmBox:function(){for(;0<this.parent.childNodes.length;)this.parent.removeChild(this.parent.firstChild);var a=new Element("table");a.addClass("qwebirc-centrebox");this.parent.appendChild(a);var b=new Element("tbody");a.appendChild(b);var c=new Element("tr");b.appendChild(c);b=new Element("td");c.appendChild(b);a=new Element("table");a.addClass("qwebirc-confirmbox");b.appendChild(a);b=new Element("tbody");a.appendChild(b);c=new Element("tr");b.appendChild(c);c.addClass("tr1");a=new Element("td");
c.appendChild(a);c=new Element("b");c.set("text",conf.frontend.initial_nick);var d=conf.frontend.initial_chans.split(" ")[0].split(",");a.appendChild(document.createTextNode("To connect to "+conf.frontend.network_name+" IRC and join channel"+(1<d.length?"s":"")+" "));for(var e=0;e<d.length;e++)1<d.length&&e==d.length-1?a.appendChild(document.createTextNode(" and ")):0<e&&a.appendChild(document.createTextNode(", ")),a.appendChild((new Element("b")).set("text",d[e]));conf.frontend.initial_nick_rand||
(a.appendChild(document.createTextNode(" as ")),a.appendChild(c));a.appendChild(document.createTextNode(" click 'Connect'."));a.appendChild(new Element("br"));c=new Element("tr");b.appendChild(c);c.addClass("tr2");b=new Element("td");c.appendChild(b);a=new Element("form");b.appendChild(a);b=new Element("input",{type:"submit",value:"Connect"});a.appendChild(b);this.autoFocus(b);a.addEvent("submit",function(a){(new Event(a)).stop();this.connect(null)}.bind(this))},createLoginBox:function(a){function b(a,
b,c){var e=new Element("tr");d.appendChild(e);var f=new Element("td");a&&f.set("text",a);e.appendChild(f);a=new Element("td");e.appendChild(a);$defined(b)&&a.appendChild(b);return $defined(c)?(e.setStyles(c),[e,a]):a}for(;0<this.parent.childNodes.length;)this.parent.removeChild(this.parent.firstChild);var c=new Element("table");c.addClass("qwebirc-centrebox");this.parent.appendChild(c);var d=new Element("tbody");c.appendChild(d);c=new Element("tr");d.appendChild(c);var e=new Element("td");c.appendChild(e);
c=new Element("table");c.addClass("qwebirc-loginbox");e.appendChild(c);d=new Element("tbody");c.appendChild(d);c=new Element("tr");d.appendChild(c);c.addClass("tr1");e=new Element("td");c.appendChild(e);e.set("html","<h1>Connect to "+conf.frontend.network_name+" IRC</h1>");c=new Element("tr");d.appendChild(c);c.addClass("tr2");e=new Element("td");c.appendChild(e);c=new Element("form");e.appendChild(c);e=new Element("table");c.appendChild(e);d=new Element("tbody");e.appendChild(d);this.nickBox=new Element("input");
b("Nickname:",this.nickBox);if(conf.atheme.sso_login)(e=JSON.decode(atob(window.location.hash.substr(1))))&&e.user&&(this.session.atheme.state=!0,this.session.atheme.user=e.user,this.session.atheme.secret=e.secret);else if(conf.atheme.nickserv_login){var g=new Element("input");g.set("type","checkbox");g.set("checked",!1);b("Login to Services:",g);var f=new Element("input"),h=b("Username:",f,{})[0];h.setStyle("display","none");var k=new Element("input");k.set("type","password");var m=b("Password:",
k,{})[0];m.setStyle("display","none");var l=function(a){f.value=this.nickBox.value}.bind(this);f.addEvent("input",function(a){this.nickBox.removeEvent("input",l,!1)}.bind(this),!1);g.addEvent("click",function(a){var b=(a=g.checked)?null:"none";h.setStyle("display",b);m.setStyle("display",b);a?(this.nickBox.addEvent("input",l,!1),f.focus(),f.value=this.nickBox.value):(this.nickBox.removeEvent("input",l,!1),this.nickBox.focus())}.bind(this))}if(a||conf.frontend.chan_prompt||!conf.frontend.initial_chans)this.chanBox=
new Element("input"),b("Channels:",this.chanBox);e=new Element("input",{type:"submit"});e.set("value","Connect");b(void 0,e);c.addEvent("submit",function(a){(new Event(a)).stop();if(this.nickBox.value)if(this.nickBox.value.match(/^[a-zA-Z0-9`^\-_\[\]{}|\\]+$/))if(this.nickBox.value.match(/^\d/)||"-"==this.nickBox.value[0])alert("Invalid nickname entered; nicknames may not start with - or a number."),this.nickBox.focus();else if(Cookie.write("iris-nick",this.nickBox.value,{duration:3650}),conf.atheme.nickserv_login&&
!conf.atheme.sso_login){if(g.checked){if(!f.value){alert("You must supply a username.");f.focus();return}if(!k.value){alert("You must supply a password.");k.focus();return}}g.checked&&"AUTHCOOKIE"==conf.atheme.sasl_type?qwebirc.irc.AthemeQuery.login(function(a){null==a?alert("Authentication failed"):qwebirc.ui.Atheme.handleLogin(this.session,f.value,a);this.connect(null)}.bind(this),f.value,k.value):(g.checked&&"PLAIN"==conf.atheme.sasl_type?(this.session.atheme.state=!0,this.session.atheme.user=
f.value,this.session.atheme.secret=k.value):qwebirc.ui.Atheme.handleLogout(this.session),this.connect(null))}else this.connect(null);else alert('Invalid nickname entered; only characters in the list "A-Z a-z 0-9 ` ^ - \\ [ ] { } |" are allowed.'),this.nickBox.focus();else alert("You must supply a nickname."),this.nickBox.focus()}.bind(this));null!=Cookie.read("iris-nick")?this.nickBox.set("value",Cookie.read("iris-nick")):conf.frontend.initial_nick&&this.nickBox.set("value",conf.frontend.initial_nick);
null!=this.chanBox&&a?this.chanBox.set("value",a):null!=this.chanBox&&this.chanBox.set("value",conf.frontend.initial_chans);this.autoFocus(this.nickBox)}});qwebirc.ui.Panes.Embed.pclass=new Class({Implements:[Events],parent:null,session:null,initialize:function(a,b){this.session=a;this.window=b;this.parent=b.lines;this.create();this.addSteps()},create:function(){this.t=this.parent;var a=this.newRow();this.title=new Element("h2");this.title.setStyle("margin-top","0px");this.title.setStyle("margin-bottom","5px");a.appendChild(this.title);this.firstRow=this.newRow();this.middleRow=this.newRow();a=this.newRow();this.hint=new Element("div");this.hint.setStyle("font-size",
"0.8em");this.hint.setStyle("font-style","italic");a.appendChild(this.hint);a=this.newRow();this.example=new Element("pre");a.appendChild(this.example);a=this.newRow();a.addClass("wizardcontrols");var b=new Element("input");b.type="submit";b.value="< Back";b.addEvent("click",this.back.bind(this));a.appendChild(b);var c=new Element("input");c.type="submit";c.value="Next >";a.appendChild(c);c.addEvent("click",this.next.bind(this));this.nextBtn=c;this.backBtn=b},newRow:function(){var a=new Element("div");
this.t.appendChild(a);return a},newStep:function(a){return new qwebirc.ui.Panes.Embed.Step(this,a)},newRadio:function(a,b,c,d){var e=new Element("div");a.appendChild(e);a=qwebirc.util.generateID();c=qwebirc.util.createInput("radio",e,c,d,a);d=new Element("label",{"for":a});d.appendChild(document.createTextNode(b));e.appendChild(d);return c},addSteps:function(){var a=function(a){Browser.Engine.trident?function(){this.focus();a&&this.select()}.delay(100,this,[]):(this.focus(),this.select())};this.welcome=
this.newStep({title:"Add webchat to your site!",first:"This wizard will help you create an embedded client by asking you questions then giving you the code to add to your website.<br/><br/>You can use the <b>Next</b> and <b>Back</b> buttons to navigate through the wizard; click <b>Next</b> to continue."});var b=conf.frontend.initial_nick_default;this.nicknameBox=new Element("input");this.nicknameBox.addClass("text");this.nicknameBox.set("value",b);this.nickname=this.newStep({title:"Set nickname",
first:"Enter the nickname you would like the client to use by default. Leave it blank for users to be forced to enter a nick themselves:",hint:"You can use a random nick by ending the nick in a series of '.' characters, each of which will be replaced by a random digit.",middle:this.nicknameBox}).addEvent("show",a.bind(this.nicknameBox));b=conf.frontend.initial_chans_default;this.chanBox=new Element("input");this.chanBox.addClass("text");this.chanBox.set("value",b);this.chans=this.newStep({title:"Set channels",
first:"Enter the channels you would like the client to join on startup:",hint:"You can supply multiple channels by seperating them with a comma, e.g.:",example:"#rogue,#eu-mage",middle:this.chanBox}).addEvent("show",a.bind(this.chanBox));var b=conf.frontend.prompt_default,c=new Element("form");this.connectdialog=this.newStep({title:"Display connect dialog?",first:"Do you want the user to be shown the connect dialog (with the values you have supplied pre-entered) or just a connect confirmation?",middle:c,
hint:"You need to display the dialog if you want the user to be able to edit their nickname before connecting."});this.connectdialogr=this.newRadio(c,"Show the connect dialog.","prompt",b);this.newRadio(c,"Connect without displaying the dialog.","prompt",!b);b=new Element("form");this.choosecolor=this.newStep({title:"Customize color?",first:"Would you like to customize the colors used by the widget?",middle:b,hint:"Color customization can be used to make the widget match the rest of your site."});
this.newRadio(b,"Use the default colors.","colors",!0);this.coloroptr=this.newRadio(b,"Choose custom widget colors.","colors",!1);this.fgColor=new Element("input");this.fgColor.addClass("text");this.fgColor.set("value",conf.ui.fg_color);this.foregroundcolor=this.newStep({title:"Set foreground color",first:"Set the widget's foreground (text) color:",middle:this.fgColor,hint:"Enter a hexadecimal color specification, e.g.:",example:"#0A0A0A"}).addEvent("show",a.bind(this.fgColor));this.secColor=new Element("input");
this.secColor.addClass("text");this.secColor.set("value",conf.ui.fg_sec_color);this.secondarycolor=this.newStep({title:"Set secondary color",first:"Set the widget's secondary foreground (heading) color:",middle:this.secColor,hint:"Enter a hexadecimal color specification, e.g.:",example:"#1A1A1A"}).addEvent("show",a.bind(this.secColor));this.bgColor=new Element("input");this.bgColor.addClass("text");this.bgColor.set("value",conf.ui.bg_color);this.backgroundcolor=this.newStep({title:"Set background color",
first:"Set the widget's background color:",middle:this.bgColor,hint:"Enter a hexadecimal color specification, e.g.:",example:"#FFFFFF"}).addEvent("show",a.bind(this.bgColor));var d=new Element("div");this.finish=this.newStep({title:"Finished!",first:"Your custom link is:",middle:d}).addEvent("show",function(){var b=new Element("a"),c=new Element("input");c.addClass("iframetext");var f=this.generateURL(!1);b.href=f;b.target="_blank";b.appendChild(document.createTextNode(f));c.value='<iframe src="'+
f+'" width="647" height="400"></iframe>';for(b=[b,new Element("br"),new Element("br"),document.createTextNode("You can embed this into your page with the following code:"),new Element("br"),c];0<d.childNodes.length;)d.removeChild(d.childNodes[0]);b.forEach(function(a){d.appendChild(a)});a.bind(c)(!0);c.addEvent("click",function(){this.select()}.bind(c))}.bind(this));this.updateSteps();this.step=0;this.showStep()},updateSteps:function(){this.steps=[this.welcome,this.nickname,this.chans];""!=this.chanBox.value&&
""!=this.nicknameBox.value&&this.steps.push(this.connectdialog);this.steps.push(this.choosecolor);!0==this.coloroptr.checked&&(this.steps.push(this.foregroundcolor),this.steps.push(this.secondarycolor),this.steps.push(this.backgroundcolor));this.steps.push(this.finish)},showStep:function(){this.backBtn.disabled=!(0<this.step);this.nextBtn.value=this.step>=this.steps.length-1?"Close":"Next >";this.steps[this.step].show()},next:function(){var a=this.steps[this.step].options.premove;if(!a||a())this.updateSteps(),
this.step>=this.steps.length-1?this.close():(this.step+=1,this.showStep())},close:function(){ui.closeWindow(this.window)},back:function(){0>=this.step||(this.step-=1,this.showStep())},generateURL:function(){var a=this.chanBox.value,b=this.nicknameBox.value,c=this.connectdialogr.checked&&""!=a&&""!=b,d=this.coloroptr.checked,e=this.fgColor.value,g=this.secColor.value,f=this.bgColor.value,h=[];h.push("nick="+escape(b));if(a){var k=[];a.split(",").forEach(function(a){"#"==a.charAt(0)&&(a=a.substring(1));
k.push(a)});h.push("channels="+escape(k.join(",")))}else h.push("channels=");d&&(h.push("fg_color="+e.replace("#","")),h.push("fg_sec_color="+g.replace("#","")),h.push("bg_color="+f.replace("#","")));c?h.push("prompt=1"):""!=a&&""!=b&&h.push("prompt=0");return conf.frontend.base_url+(0<h.length?"?":"")+h.join("&")}});
qwebirc.ui.Panes.Embed.Step=new Class({Implements:[Options,Events],options:{title:"",first:"",hint:"",middle:null,premove:null,example:""},initialize:function(a,b){this.setOptions(b);this.parent=a},show:function(){this.parent.title.set("html",this.options.title);this.parent.firstRow.set("html",this.options.first);this.parent.hint.set("html",this.options.hint);for(this.parent.example.set("text",this.options.example);0<this.parent.middleRow.childNodes.length;)this.parent.middleRow.removeChild(this.parent.middleRow.childNodes[0]);
$defined(this.options.middle)&&this.parent.middleRow.appendChild(this.options.middle);this.fireEvent("show")}});qwebirc.ui.Panes.FAQ={title:"FAQ",command:function(a){return"FAQ"},menuitem:function(a){return"Frequently asked questions"},menupos:400};
qwebirc.ui.Panes.FAQ.pclass=new Class({Implements:[Events],session:null,initialize:function(a,b){this.session=a;var c=function(){b.lines.set("html",'<div class="loading">Loading. . .</div>')}.delay(500);qwebirc.ui.RequestTransformHTML(a,{url:conf.frontend.static_base_url+"panes/faq.html",update:b.lines,onSuccess:function(){$clear(c);b.lines.getElement("input[class=close]").addEvent("click",function(){ui.closeWindow(b)}.bind(this))}.bind(this)}).get()}});qwebirc.ui.Panes.Feedback={title:"Feedback",command:function(a){return"FEEDBACK"},menuitem:function(a){return"Feedback"},menupos:500};
qwebirc.ui.Panes.Feedback.pclass=new Class({Implements:[Events],session:null,initialize:function(a,b){this.session=a;this.textboxVisible=!1;var c=function(){b.lines.set("html",'<div class="loading">Loading. . .</div>')}.delay(500);this.addEvent("select",this.onSelect);qwebirc.ui.RequestTransformHTML(a,{url:conf.frontend.static_base_url+"panes/feedback.html",update:b.lines,onSuccess:function(){$clear(c);b.lines.getElement("input[class=close]").addEvent("click",function(){ui.closeWindow(b)}.bind(this));
b.lines.getElement("input[class=close2]").addEvent("click",function(){ui.closeWindow(b)}.bind(this));var a=b.lines.getElement("textarea");this.textbox=a;b.lines.getElement("input[class=submitfeedback]").addEvent("click",function(){this.sendFeedback(b.lines,a,a.value)}.bind(this));this.textboxVisible=!0;this.onSelect()}.bind(this)}).get()},onSelect:function(){this.textboxVisible&&this.textbox.focus()},sendFeedback:function(a,b,c){c=c.replace(/^\s*/,"").replace(/\s*$/,"");var d=a.getElement("p[class=maintext]");
if(25>c.length)d.set("text","I don't suppose you could enter a little bit more? Thanks!"),b.focus();else{this.textboxVisible=!1;var e=w.lines.getElement("div[class=enterarea]");e.setStyle("display","none");var g=w.lines.getElement("div[class=messagearea]"),f=w.lines.getElement("p[class=messagetext]"),h=w.lines.getElement("input[class=close2]");f.set("text","Submitting. . .");g.setStyle("display","");a=0;encodeURIComponent(c);for(b=0;b<c.length;b++)a=(a+1)%256^c.charCodeAt(b)%256;(new Request({url:conf.frontend.dynamic_base_url+
"feedback",onSuccess:function(){f.set("text","Submitted successfully, thanks for the feedback!");h.setStyle("display","")},onFailure:function(){this.textboxVisible=!0;g.setStyle("display","none");e.setStyle("display","");d.set("text","Looks like something went wrong submitting :(")}.bind(this)})).send("feedback="+c+"&c="+a)}}});qwebirc.ui.Panes.List={title:"Channels",command:function(a){if(conf.atheme.chan_list)return"LIST"},menuitem:function(a){if(conf.atheme.chan_list)return"Channel list"},menupos:100};
qwebirc.ui.Panes.List.pclass=new Class({Implements:[Events],session:null,parent:null,cloud:!0,loading:null,timestamp:0,page:1,namefilter:"",topicfilter:"",filterBox:null,viewBox:null,chanBox:null,pageBox:null,viewChange:null,pageText:null,prev:null,next:null,initialize:function(a,b){this.session=a;this.parent=b.lines;this.cloud=conf.atheme.chan_list_cloud_view;var c=new Element("table"),d=new Element("tbody");c.appendChild(d);this.viewChange=new Element("a",{"class":"",href:"#"});this.viewChange.addEvent("click",
function(a){this.cloud?this.createListView():this.createCloudView()}.bind(this));var e=new Element("td",{"class":"viewchange"});e.appendChild(this.viewChange);d.appendChild(e);var g=new Element("form",{"class":"filterbox"}),e=new Element("span",{"class":"inputbox"});e.appendText("Filter by Name:");var f=new Element("input");e.appendChild(f);g.appendChild(e);e=new Element("span",{"class":"inputbox"});e.appendText("Filter by Topic:");var h=new Element("input");e.appendChild(h);g.appendChild(e);e=new Element("input",
{type:"submit",value:"Refresh and Apply Filters"});e.addEvent("click",function(a){(new Event(a)).stop();if(f.value!=this.namefilter||h.value!=this.topicfilter)this.namefilter=f.value,this.topicfilter=h.value,this.page=1;this.timestamp=0;this.update()}.bind(this));g.appendChild(e);e=new Element("td");e.appendChild(g);d.appendChild(e);this.parent.appendChild(c);this.viewBox=new Element("div");this.parent.appendChild(this.viewBox);this.cloud?this.createCloudView():this.createListView()},createListView:function(){for(this.cloud=
!1;0<this.viewBox.childNodes.length;)this.viewBox.removeChild(this.viewBox.firstChild);this.viewChange.set("text","Switch to cloud view...");var a=new Element("table",{"class":"listbox",cellspacing:"0"});this.chanBox=new Element("tbody");a.appendChild(this.chanBox);this.viewBox.appendChild(a);this.pageBox=new Element("div",{"class":"pagebox"});this.pageBox.style.display="none";this.prev=new Element("span");this.pageText=new Element("span");this.next=new Element("span");this.pageBox.appendChild(this.prev);
this.pageBox.appendText(" - ");this.pageBox.appendChild(this.pageText);this.pageBox.appendText(" - ");this.pageBox.appendChild(this.next);this.viewBox.appendChild(this.pageBox);this.loading=function(){this.chanBox.set("html",'<tr><td class="loading">Loading. . .</td></tr>')}.bind(this).delay(500);this.update()},createCloudView:function(){this.cloud=!0;for(this.page=1;0<this.viewBox.childNodes.length;)this.viewBox.removeChild(this.viewBox.firstChild);this.viewChange.set("text","Switch to list view...");
var a=new Element("div",{"class":"hoverhint"});a.appendText("Hover over a channel to view its topic!");this.viewBox.appendChild(a);this.chanBox=new Element("div",{"class":"tagbox"});this.viewBox.appendChild(this.chanBox);this.update()},update:function(){qwebirc.irc.AthemeQuery.channelList(function(a,b,c){this.timestamp=b;null!=this.loading&&(clearTimeout(this.loading),this.loading=null);if(this.chanBox.hasChildNodes())for(;1<=this.chanBox.childNodes.length;)this.chanBox.removeChild(this.chanBox.firstChild);
if(null==a)this.cloud?this.chanBox.set("html",'<span class="loading">Unable to load channel list, please try reopening the channel list later.</span>'):this.chanBox.set("html",'<tr><td class="loading">Unable to load channel list, please try refreshing again later.</td></tr>');else if(0==a.length)this.cloud?this.chanBox.set("html",'<span class="loading">No channels currently exist, please try refreshing again later.</span>'):this.chanBox.set("html",'<tr><td class="loading">No channels currently exist, please try refreshing again later.</td></tr>');
else{b=a[a.length-1].users;c=a[0].users-b;if(!this.cloud){var d=new Element("tr"),e=new Element("th",{"class":"name"});e.appendText("Channel");d.appendChild(e);e=new Element("th",{"class":"users"});e.appendText("Users");d.appendChild(e);e=new Element("th",{"class":"chantopic"});e.appendText("Topic");d.appendChild(e);this.chanBox.appendChild(d)}this.cloud&&a.sort(function(a,b){an=a.name.toLowerCase();bn=b.name.toLowerCase();return an<bn?-1:an>bn?1:0});for(d=0;d<a.length;d++)e=this.cloud?new Element("span",
{"class":"chantag",style:"font-size: "+(1+2*(a[d].users-b)/(c+1))+"em;"}):new Element("tr"),this.makeChannel(e,a[d],d%2+1),this.chanBox.appendChild(e),this.cloud&&this.chanBox.appendText(" ")}}.bind(this),this.timestamp,"100",this.page,this.namefilter,this.topicfilter)},updatePaging:function(a){if(this.pageText){for(var b=Math.ceil(a/100);1<=this.pageText.childNodes.length;)this.pageText.removeChild(this.pageText.firstChild);this.pageText.appendText("Page "+this.page+" of "+b)}if(this.prev&&this.next){for(;1<=
this.prev.childNodes.length;)this.prev.removeChild(this.prev.firstChild);if(1<this.page){var c=new Element("a",{href:"#"});c.appendText("Prev Page");c.addEvent("click",function(a){this.page--;c.removeEvents();this.update()}.bind(this));this.prev.appendChild(c)}else this.prev.appendText("Prev Page");for(;1<=this.next.childNodes.length;)this.next.removeChild(this.next.firstChild);if(this.page<b){var d=new Element("a",{href:"#"});d.appendText("Next Page");d.addEvent("click",function(a){this.page++;d.removeEvents();
this.update()}.bind(this));this.next.appendChild(d)}else this.next.appendText("Next Page")}this.PageBox&&(this.pageBox.style.display=1!=this.page||1<b?"block":"none")},makeChannel:function(a,b,c){var d;d=this.cloud?a:new Element("td",{"class":"name chan"+c});(function(){var c=b.name;a.addEvent("click",function(a){(new Event(a)).stop();this.session.irc?this.session.irc.exec("/JOIN "+c):(a=ui.getWindow(qwebirc.ui.WINDOW_CUSTOM,"Connect"))&&!a.subWindow.connectChannel(c)&&(ui.selectWindow(a),a.subWindow.nickBox.focus())}.bind(this))}).call(this);
d.appendText(b.name);this.cloud?a.setProperty("title",b.topic):(a.appendChild(d),d=new Element("td",{"class":"users chan"+c}),d.appendText(b.users),a.appendChild(d),c=new Element("td",{"class":"chantopic chan"+c}),qwebirc.ui.Colourise(this.session,b.topic,c),a.appendChild(c))}});qwebirc.ui.Panes.Options={title:"Options",command:function(a){return"OPTIONS"},menuitem:function(a){return"Options"},menupos:300};
qwebirc.ui.Panes.Options.pclass=new Class({Implements:[Events],session:null,initialize:function(a,b){this.session=a;this.window=b;this.parent=b.lines;this.createElements()},createElements:function(){var a=function(a,b){var c=new Element(a);b.appendChild(c);return c};this.boxList=[];this.options={};for(var b,c,d=0;d<qwebirc.options.Options.length;d++){var e=qwebirc.options.Options[d],g=qwebirc.options.CheckInput;$defined(e.type)&&(g=e.type);if(g!=qwebirc.options.ColorInput||!$defined(e.isEnabled)||
e.isEnabled(this.session)){g!=b&&(c=a("table",this.parent),tb=a("tbody",c),b=g);var f=a("tr",tb);c=a("td",f);f=a("td",f);g=new g(this.session,this.options,f,e,d);f=new Element("label",{"for":g.id});f.set("text",e.label+":");c.appendChild(f);this.boxList.push([e,g]);this.options[e.category+"."+e.option]=g}}d=a("tr",tb);c=a("td",d);f=a("td",d);a=qwebirc.util.createInput("submit",f);a.value="Save";a.addEvent("click",function(){this.save();ui.closeWindow(this.window)}.bind(this));a=qwebirc.util.createInput("submit",
f);a.value="Cancel";a.addEvent("click",function(){this.cancel();ui.closeWindow(this.window)}.bind(this))},save:function(){this.boxList.forEach(function(a){var b=a[0];conf[b.category][b.option]=a[1].get();if(b.onSave)b.onSave(this.session)}.bind(this));qwebirc.config.saveUserSettings(conf)},cancel:function(){this.boxList.forEach(function(a){if(a[0].onCancel)a[0].onCancel(this.session)}.bind(this))}});qwebirc.ui.Panes.PrivacyPolicy={title:"Privacy Policy",command:function(a){return conf.ui.privacy?"PRIVACYPOLICY":null},menuitem:function(a){return conf.ui.privacy?"Privacy policy":null},menupos:700};
qwebirc.ui.Panes.PrivacyPolicy.pclass=new Class({Implements:[Events],session:null,initialize:function(a,b){this.session=a;var c=function(){b.lines.set("html",'<div class="loading">Loading. . .</div>')}.delay(500);qwebirc.ui.RequestTransformHTML(a,{url:conf.frontend.static_base_url+"panes/privacypolicy.html",update:b.lines,onSuccess:function(){$clear(c);b.lines.getElement("input[class=close]").addEvent("click",function(){ui.closeWindow(b)}.bind(this))}.bind(this)}).get()}});qwebirc.ui.QUI=new Class({Extends:qwebirc.ui.RootUI,initialize:function(a,b){this.parent(a,b,qwebirc.ui.QUI.Window,"qui");this.theme=new qwebirc.ui.Theme(null);this.setModifiableStylesheet("qui")},postInitialize:function(){this.qjsui=new qwebirc.ui.QUI.JSUI("qwebirc-qui",this.parentElement);this.qjsui.addEvent("reflow",function(){var a=this.getActiveWindow();if($defined(a))a.onResize()}.bind(this));this.qjsui.top.addClass("outertabbar");this.qjsui.bottom.addClass("input");this.qjsui.right.addClass("nicklist");
this.qjsui.topic.addClass("topic");this.qjsui.middle.addClass("lines");this.outerTabs=this.qjsui.top;this.tabs=new Element("div",{"class":"tabbar"});this.__createDropdownMenu();this.outerTabs.appendChild(this.tabs);this.origtopic=this.topic=this.qjsui.topic;this.origlines=this.lines=this.qjsui.middle;this.orignicklist=this.nicklist=this.qjsui.right;this.input=this.qjsui.bottom;this.reflow=this.qjsui.reflow.bind(this.qjsui);this.tabs.addEvent("mousewheel",function(a){a=new Event(a);0<a.wheel?this.nextWindow():
0>a.wheel&&this.prevWindow();a.stop()}.bind(this));this.createInput();this.reflow();this.reflow.delay(100)},__createDropdownMenu:function(){var a=new Element("span");a.addClass("dropdownmenu");a.hide=function(){a.setStyle("display","none");a.visible=!1;document.removeEvent("mousedown",b)}.bind(this);var b=function(){a.hide()};a.hide();this.parentElement.appendChild(a);var c=[],d=0;$each(qwebirc.ui.Panes,function(a,b,e){if(e=a.menuitem(this.session))c[d]={},c[d].text=e,c[d].name=b,c[d].pos=a.menupos,
d++}.bind(this));c.sort(function(a,b){return a.pos-b.pos});c.forEach(function(b){var c=new Element("a");c.addEvent("mousedown",function(a){(new Event(a)).stop()});c.addEvent("click",function(){a.hide();ui.addPane(b.name)}.bind(this));c.set("text",b.text);a.appendChild(c)}.bind(this));var e=new Element("div");e.addClass("dropdown-tab");e.appendChild(new Element("img",{src:conf.frontend.static_base_url+"images/menu.png",title:"menu",alt:"menu"}));this.outerTabs.appendChild(e);a.show=function(c){(new Event(c)).stop();
a.visible?a.hide():(c=this.outerTabs.getSize().y,a.setStyle("left",0),a.setStyle("top",c-1),a.setStyle("display","inline-block"),a.visible=!0,document.addEvent("mousedown",b))}.bind(this);e.addEvent("mousedown",function(a){(new Event(a)).stop()});e.addEvent("click",a.show)},createInput:function(){var a=new Element("form");this.input.appendChild(a);a.addClass("input");var b=new Element("input");a.appendChild(b);this.inputbox=b;this.inputbox.maxLength=512;var c=function(){""!=b.value&&(this.resetTabComplete(),
this.getActiveWindow().historyExec(b.value),b.value="")}.bind(this);if(qwebirc.util.deviceHasKeyboard())b.addClass("keyboard-input");else{b.addClass("mobile-input");var d=new Element("input",{type:"button"});d.addClass("mobile-button");d.addEvent("click",function(){c();b.focus()});d.value=">";this.input.appendChild(d);var e=function(){var a=this.input.getSize(),c=d.getSize(),c=a.x-c.x-5;d.setStyle("left",c);b.setStyle("width",c-5);d.setStyle("height",a.y)}.bind(this);this.qjsui.addEvent("reflow",
e)}a.addEvent("submit",function(a){(new Event(a)).stop();c()});b.addEvent("focus",this.resetTabComplete.bind(this));b.addEvent("mousedown",this.resetTabComplete.bind(this));b.addEvent("keydown",function(a){var c,d=b.value;if("up"==a.key)c=this.commandhistory.upLine;else if("down"==a.key)c=this.commandhistory.downLine;else{"tab"==a.key?((new Event(a)).stop(),this.tabComplete(b)):this.resetTabComplete();return}this.resetTabComplete();""!=d&&this.lastcvalue!=d&&this.commandhistory.addLine(d,!0);c=c.bind(this.commandhistory)();
(new Event(a)).stop();c||(c="");this.lastcvalue=c;b.value=c;qwebirc.util.setAtEnd(b)}.bind(this))},setLines:function(a){this.lines.parentNode.replaceChild(a,this.lines);this.qjsui.middle=this.lines=a},setChannelItems:function(a,b){$defined(a)||(a=this.orignicklist,b=this.origtopic);this.nicklist.parentNode.replaceChild(a,this.nicklist);this.qjsui.right=this.nicklist=a;this.topic.parentNode.replaceChild(b,this.topic);this.qjsui.topic=this.topic=b},closeWindow:function(a){this.parent(a);this.tabs.removeChild(a.tab);
this.tabs.removeChild(a.spaceNode);this.reflow()}});
qwebirc.ui.QUI.JSUI=new Class({Implements:[Events],initialize:function(a,b,c){this.parent=b;this.sizer=$defined(c)?c:b;this.class_=a;this.create();this.reflowevent=null;window.addEvent("resize",function(){this.reflow(100)}.bind(this))},applyClasses:function(a,b){b.addClass("dynamicpanel");b.addClass(this.class_);"middle"==a?b.addClass("leftboundpanel"):"top"==a?(b.addClass("topboundpanel"),b.addClass("widepanel")):"topic"==a?b.addClass("widepanel"):"right"==a?b.addClass("rightboundpanel"):"bottom"==
a&&(b.addClass("bottomboundpanel"),b.addClass("widepanel"))},create:function(){var a=function(a){var c=new Element("div");this.applyClasses(a,c);this.parent.appendChild(c);return c}.bind(this);this.top=a("top");this.topic=a("topic");this.middle=a("middle");this.right=a("right");this.bottom=a("bottom")},reflow:function(a){a||(a=1);this.reflowevent&&$clear(this.reflowevent);this.__reflow();this.reflowevent=this.__reflow.delay(a,this)},__reflow:function(){var a=this.bottom,b=this.middle,c=this.right,
d=this.topic,e=this.top,g=d.getSize(),e=e.getSize(),f=c.getSize(),h=a.getSize(),k=this.sizer.getSize(),m=k.y-e.y-h.y-g.y,f=k.x-f.x;d.setStyle("top",e.y);b.setStyle("top",e.y+g.y);0<m&&(b.setStyle("height",m),c.setStyle("height",m));0<f&&b.setStyle("width",f);c.setStyle("top",e.y+g.y);c.setStyle("left",f);a.setStyle("top",k.y-h.y);this.fireEvent("reflow")},showChannel:function(a){var b="none";a&&(b="block");this.right.setStyle("display",b);this.topic.setStyle("display",b)},showInput:function(a){this.bottom.isVisible=
a;this.bottom.setStyle("display",a?"block":"none")}});
qwebirc.ui.QUI.Window=new Class({Extends:qwebirc.ui.Window,initialize:function(a,b,c,d){this.parent(a,b,c,d);this.tab=new Element("a",{href:"#"});this.tab.addClass("tab");this.tab.addEvent("focus",function(){this.blur()}.bind(this.tab));this.spaceNode=document.createTextNode(" ");ui.tabs.hasChildNodes()?b==qwebirc.ui.WINDOW_STATUS?(ui.tabs.insertBefore(this.tab,ui.tabs.firstChild),ui.tabs.insertBefore(this.spaceNode,this.tab.nextSibling)):b==qwebirc.ui.WINDOW_CUSTOM&&"Connect"==c?(ui.tabs.insertBefore(this.tab,
ui.tabs.firstChild),ui.tabs.insertBefore(this.spaceNode,this.tab.nextSibling)):(ui.tabs.appendChild(this.tab),ui.tabs.appendChild(this.spaceNode)):(ui.tabs.appendChild(this.tab),ui.tabs.appendChild(this.spaceNode));this.tab.appendText(c);this.tab.addEvent("click",function(a){(new Event(a)).stop();this.closed||ui.selectWindow(this)}.bind(this));if(b!=qwebirc.ui.WINDOW_STATUS&&(b!=qwebirc.ui.WINDOW_CUSTOM||"Connect"!=c)){a=new Element("span");a.set("text","X");a.addClass("tabclose");var e=function(a){(new Event(a)).stop();
this.closed||(b==qwebirc.ui.WINDOW_CHANNEL&&this.session.irc.exec("/PART "+c),ui.closeWindow(this))}.bind(this);a.addEvent("click",e);this.tab.addEvent("mouseup",function(a){var b=1;Browser.Engine.trident&&(b=4);a.event.button==b&&e()}.bind(this));this.tab.appendChild(a)}this.lines=new Element("div");ui.qjsui.applyClasses("middle",this.lines);this.lines.addClass("lines");b!=qwebirc.ui.WINDOW_CUSTOM&&this.lines.addClass("ircwindow");this.lines.addEvent("scroll",function(){this.scrolleddown=this.scrolledDown();
this.scrollpos=this.getScrollParent().getScroll()}.bind(this));b==qwebirc.ui.WINDOW_CHANNEL&&(this.topic=new Element("div"),this.topic.addClass("topic"),this.topic.addClass("tab-invisible"),this.topic.set("html","&nbsp;"),this.topic.addEvent("dblclick",this.editTopic.bind(this)),ui.qjsui.applyClasses("topic",this.topic),this.prevNick=null,this.nicklist=new Element("div"),this.nicklist.addClass("nicklist"),this.nicklist.addClass("tab-invisible"),this.nicklist.addEvent("click",this.removePrevMenu.bind(this)),
ui.qjsui.applyClasses("nicklist",this.nicklist));b==qwebirc.ui.WINDOW_CHANNEL&&this.updateTopic("");this.nicksColoured=conf.ui.nick_colors;this.reflow()},editTopic:function(){if(this.session.irc.nickOnChanHasAtLeastPrefix(this.session.irc.nickname,this.name,"+",!0)){var a=prompt("Change topic of "+this.name+" to:",this.topic.topicText);null!==a&&this.session.irc.exec("/TOPIC "+a)}else alert("Sorry, you need to be a channel operator to change the topic!")},reflow:function(){ui.reflow()},onResize:function(){this.scrolleddown?
Browser.Engine.trident?this.scrollToBottom.delay(5,this):this.scrollToBottom():$defined(this.scrollpos)&&(Browser.Engine.trident?this.getScrollParent().scrollTo(this.scrollpos.x,this.scrollpos.y):this.getScrollParent().scrollTo.delay(5,this,[this.scrollpos.x,this.scrollpos.y]))},createMenu:function(a,b){var c=new Element("div");b.appendChild(c);c.addClass("menu");var d=[a];qwebirc.ui.MENU_ITEMS().forEach(function(a){if(a.predicate&&(!0===a.predicate||a.predicate.apply(this,d))){var b=new Element("a");
c.appendChild(b);b.href="#";b.set("text","- "+a.text);b.addEvent("focus",function(){this.blur()}.bind(b));b.addEvent("click",function(b){new Event(b.stop());this.menuClick(a.fn)}.bind(this))}}.bind(this));return c},menuClick:function(a){a.bind(this)(this.prevNick.realNick);this.removePrevMenu()},moveMenuClass:function(){this.prevNick&&(this.nicklist.firstChild==this.prevNick?this.prevNick.removeClass("selected-middle"):this.prevNick.addClass("selected-middle"))},removePrevMenu:function(){this.prevNick&&
(this.prevNick.removeClass("selected"),this.prevNick.removeClass("selected-middle"),this.prevNick.menu&&this.prevNick.removeChild(this.prevNick.menu),this.prevNick=null)},nickListAdd:function(a,b){var c=this.session.irc.stripPrefix(a),d=new Element("a");qwebirc.ui.insertAt(b,this.nicklist,d);d.href="#";var e=new Element("span");if(conf.ui.nick_colors){var g=c.toHSBColour(this.session);$defined(g)&&e.setStyle("color",g.rgbToHex())}e.set("text",a);d.appendChild(e);d.realNick=c;d.addEvent("click",function(a){this.prevNick==
d?this.removePrevMenu():(this.removePrevMenu(),this.prevNick=d,d.addClass("selected"),this.moveMenuClass(),d.menu=this.createMenu(d.realNick,d),(new Event(a)).stop())}.bind(this));d.addEvent("focus",function(){this.blur()}.bind(d));this.moveMenuClass();return d},nickListRemove:function(a,b){this.nicklist.removeChild(b);this.moveMenuClass()},updateTopic:function(a){for(var b=this.topic;b.firstChild;)b.removeChild(b.firstChild);a?(b.topicText=a,this.parent(a,b)):(b.topicText=a,a=new Element("div"),
a.set("text","(no topic set)"),a.addClass("emptytopic"),b.appendChild(a));this.reflow()},select:function(){var a=this.type!=qwebirc.ui.WINDOW_CUSTOM;this.tab.removeClass("tab-unselected");this.tab.addClass("tab-selected");ui.setLines(this.lines);ui.setChannelItems(this.nicklist,this.topic);ui.qjsui.showInput(a);ui.qjsui.showChannel($defined(this.nicklist));this.reflow();this.parent();a&&ui.inputbox.focus();if(this.type==qwebirc.ui.WINDOW_CHANNEL&&this.nicksColoured!=conf.ui.nick_colors)if(this.nicksColoured=
conf.ui.nick_colors,a=this.nicklist.childNodes,conf.ui.nick_colors)for(var b=0;b<a.length;b++){var c=a[b],d=c.firstChild,c=c.realNick.toHSBColour(this.session);$defined(c)&&d.setStyle("color",c.rgbToHex())}else for(b=0;b<a.length;b++)d=a[b].firstChild,d.setStyle("color",null)},deselect:function(){this.parent();this.tab.removeClass("tab-selected");this.tab.addClass("tab-unselected")},addLine:function(a,b,c){var d=new Element("div");c?d.addClass(c):this.lastcolour?d.addClass("linestyle1"):d.addClass("linestyle2");
this.lastcolour=!this.lastcolour;this.parent(a,b,c,d)},setHilighted:function(a){var b=this.hilighted;this.parent(a);if(a!=b)switch(this.tab.removeClass("tab-hilight-activity"),this.tab.removeClass("tab-hilight-us"),this.tab.removeClass("tab-hilight-speech"),this.hilighted){case qwebirc.ui.HILIGHT_US:this.tab.addClass("tab-hilight-us");break;case qwebirc.ui.HILIGHT_SPEECH:this.tab.addClass("tab-hilight-speech");break;case qwebirc.ui.HILIGHT_ACTIVITY:this.tab.addClass("tab-hilight-activity")}}});
//# sourceMappingURL=qui-490a0c5.js.map
